{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./node_modules/@skpm/promise/index.js","webpack://exports/./node_modules/chroma-js/chroma.js","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/browser-api.js","webpack://exports/./node_modules/sketch-module-web-view/lib/constants.js","webpack://exports/./node_modules/sketch-module-web-view/lib/dispatch-first-click.js","webpack://exports/./node_modules/sketch-module-web-view/lib/execute-javascript.js","webpack://exports/./node_modules/sketch-module-web-view/lib/fitSubview.js","webpack://exports/./node_modules/sketch-module-web-view/lib/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/inject-client-messaging.js","webpack://exports/./node_modules/sketch-module-web-view/lib/movable-area.js","webpack://exports/./node_modules/sketch-module-web-view/lib/parseWebArguments.js","webpack://exports/./node_modules/sketch-module-web-view/lib/set-delegates.js","webpack://exports/./node_modules/sketch-module-web-view/lib/webview-api.js","webpack://exports/./node_modules/sketch-module-web-view/remote.js","webpack://exports/./resources/export/index.js","webpack://exports/./resources/store/artboard.js","webpack://exports/./resources/store/assets.js","webpack://exports/./resources/store/index.js","webpack://exports/./resources/ui/index.html","webpack://exports/./resources/ui/loading.html","webpack://exports/./resources/ui/spec.html","webpack://exports/./resources/ui/style.css","webpack://exports/./src/export.js","webpack://exports/external \"events\"","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/ui\""],"names":["getSystemFontsLocation","systemLibrary","NSFileManager","defaultManager","URLsForDirectory_inDomains","NSLibraryDirectory","systemLibraryPath","absoluteString","replace","systemFonts","fileExistsAtPath","getUserFontsLocation","userLibrary","userLibraryPath","userFonts","getSupplementalFontsLocation","getUserFonts","userFontsLoc","contentsOfDirectoryAtPath_error","nil","Array","from","item","String","getSystemFonts","systemFontsLoc","getSupplimentalFonts","supplementalFontsLoc","supplementalFonts","getAllFonts","fontLocations","fontLocationContents","availableFontLocations","filter","fontDir","length","allFonts","map","fontLocation","index","location","contents","getRoot","context","scriptPath","stringByDeletingLastPathComponent","getFileContent","filePath","NSString","stringWithContentsOfFile_encoding_error","getSavePath","document","fileURL","path","fileName","displayName","stringByDeletingPathExtension","savePanel","NSSavePanel","setTitle","setNameFieldLabel","setPrompt","setCanCreateDirectories","setNameFieldStringValue","runModal","NSOKButton","URL","writeFile","options","content","stringWithString","savePathName","createDirectoryAtPath_withIntermediateDirectories_attributes_error","push","join","writeToFile_atomically_encoding_error","moveImages","images","savePath","imagesPath","createDirectoryAtPath_attributes","forEach","image","moveItemAtPath_toPath_error","src","id","moveSVGs","svgs","svgsPath","svg","getFontNameVariations","font","noSpace","hyphenCase","containsFontNameVariation","fontFileName","fontNameVariations","contains","normalizedFileName","toUpperCase","variation","normalizedNameVariant","indexOf","copyFonts","fonts","fontsSavePath","fontFiles","fontFile","copyItemAtPath_toPath_error","getFinalStore","store","finalStore","Object","assign","JSON","stringify","checkIfRelevant","layer","callback","type","remove","checkIfHidden","isHidden","hidden","checkIfSymbol","detach","recursively","createMaskLayer","sketch","duplicate","activeFills","style","fills","fill","enabled","topFill","color","chroma","alpha","fillType","frame","x","y","borders","shadows","innerShadows","opacity","shapeBuffer","formats","output","shapeGroup","createLayerFromData","maskShape","layers","name","getMaskShape","lastLayer","checkIfMask","sketchObject","hasClippingMask","maskIndex","maskParent","parent","flatMaskShape","maskGroupOffset","width","maskGroup","Group","splice","maskedLayer","roundFrameDimensions","Math","round","height","processLayer","rLayer","hLayer","sLayer","mLayer","fLayer","processLayers","getArtboard","selectedArtboard","artboard","background","includedInExport","createSvgFromLayer","page","borderSize","activeBorders","border","thickness","layerDuplicate","transform","rotation","flippedHorizontally","flippedVertically","NSTemporaryDirectory","createShapeFromLayer","shapeReplacement","Shape","createShapeFromGroup","prefix","newName","substr","trim","createImageLayerImage","scales","createGradientFillImage","activeGradients","topGradient","gradientImage","ShapePath","createImageFillImage","nsimage","size","fillImage","Image","processLayerFills","fillImages","pattern","find","isComplexShapePath","hasOpenPath","closed","notRectangle","shapeType","notOval","isOddShape","hasDashPattern","borderOptions","dashPattern","processShapePath","isComplex","shapePathFillImages","processShape","shapeFillImages","processImage","processGroup","startsWith","processText","fontFamily","availableFamilies","NSFontManager","sharedFontManager","availableFontFamilies","availableFamiliesArray","fontAvailable","includes","shapeImages","shapeSvg","shapePathImages","shapePathSvg","groupSvg","newAssets","createArtboardImage","buffer","bufferImg","base64","nsdata","base64EncodedStringWithOptions","getAssets","artboardAssets","artboardImage","getStore","assets","notes","appWindowIdentifier","loadingWindowIdentifier","existingAppWindow","getWebview","existingLoadingWindow","close","getSelectedDocument","selectedPage","selectedLayers","selected","theme","ui","getTheme","loadingWindow","BrowserWindow","identifier","modal","show","appWindow","fullscreenable","loadURL","require","loadingWebContents","webContents","on","executeJavaScript","then","appWebContents","isLoading","appStore","maximize","center","alert","params","saveStore","saveParams","parse","pluginExport","pluginRoot","scriptSourceMapPath","stylesPath","templatePath","styleName","template","styles","script","scriptWithGlobals","scriptSourceMap","onShutdown"],"mappings":";;;;;;;;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,SAAS;AACtB;AACA,aAAa,kBAAkB;AAC/B;AACA,aAAa,kBAAkB;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;AC9QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mEAAmE;AACnE,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAI,KAA4D;AAChE,IAAI,SAC2B;AAC/B,CAAC,qBAAqB;;AAEtB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB,MAAM;AAC3B;AACA,iDAAiD,qBAAqB;AACtE;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uHAAuH,iBAAiB;AACxI;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,+BAA+B,yCAAyC;AACxE;AACA;AACA;AACA;AACA,6BAA6B,iCAAiC,EAAE;AAChE,0BAA0B,mBAAmB,EAAE;AAC/C;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA8B,aAAa;AAC3C;AACA,wCAAwC,8BAA8B;AACtE;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,yEAAyE,kBAAkB,EAAE;AAC7F;AACA;AACA;AACA,oDAAoD,iBAAiB;AACrE;;AAEA;AACA,2BAA2B,OAAO;AAClC;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA,mCAAmC,iBAAiB;AACpD;;AAEA;AACA,6CAA6C,mBAAmB;AAChE;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,sBAAsB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,4BAA4B,8BAA8B;;AAE1D;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,QAAQ;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,QAAQ;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,uBAAuB,2BAA2B;AAClD,4BAA4B,+BAA+B;AAC3D,4BAA4B,+BAA+B;;AAE3D;AACA,oBAAoB,UAAU;AAC9B,mDAAmD,wBAAwB;AAC3E;AACA;;AAEA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,QAAQ;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,KAAK;AAC9B,gCAAgC,YAAY;AAC5C,gCAAgC,YAAY;AAC5C;AACA,qBAAqB,mCAAmC;AACxD;AACA,qBAAqB,WAAW;AAChC;AACA,qBAAqB,+CAA+C;AACpE;AACA,qBAAqB,WAAW;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA,yBAAyB,KAAK;AAC9B;AACA;AACA,uBAAuB;AACvB;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA,yBAAyB;AACzB;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;AAKA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,4BAA4B,qBAAqB;AACjD,4BAA4B,uBAAuB;AACnD,4BAA4B,uBAAuB;AACnD;AACA,wBAAwB,UAAU;AAClC;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,4BAA4B,OAAO;AACnC,0BAA0B,UAAU;AACpC,wBAAwB,UAAU;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F;AAC1F,kGAAkG;AAClG,kGAAkG;AAClG,kGAAkG;AAClG,kGAAkG;AAClG,kGAAkG;AAClG;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;AAOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,OAAO;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,kCAAkC,EAAE,aAAa,EAAE;AACnD,mCAAmC,EAAE,aAAa,EAAE;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;;;;AAKA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,OAAO;AAC9B,uBAAuB,OAAO;AAC9B;AACA,sBAAsB,UAAU;AAChC,oBAAoB,UAAU;AAC9B;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;AAOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;;;;;;AAOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAkB,MAAM;AACxB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,6BAA6B,qBAAqB;AAClD,6BAA6B,uBAAuB;AACpD,6BAA6B,uBAAuB;AACpD;AACA,wBAAwB,UAAU;AAClC;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,4BAA4B,OAAO;AACnC,0BAA0B,UAAU;AACpC,wBAAwB,UAAU;AAClC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,0FAA0F;AAC1F,kGAAkG;AAClG,kGAAkG;AAClG,kGAAkG;AAClG,kGAAkG;AAClG,kGAAkG;AAClG;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;AAOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oCAAoC,kBAAkB;AACtD;AACA;;AAEA;AACA,kCAAkC,sBAAsB;AACxD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,mEAAmE;AACnE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;AAOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,gBAAgB;AACrD;AACA;;AAEA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;;AAEA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;AAOA,wCAAwC,6BAA6B;AACrE,wCAAwC,uCAAuC;;AAE/E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,wCAAwC;AACxC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK,EAAE,EAAE;;AAET;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;;AAMA;AACA;AACA,qDAAqD,iBAAiB;AACtE;;AAEA,sCAAsC,wBAAwB;AAC9D;AACA;AACA;;AAEA;AACA;AACA,6BAA6B,kCAAkC;AAC/D;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA,4BAA4B,6BAA6B;AACzD;AACA;;AAEA;AACA;;AAEA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,eAAe;AACxC;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,0BAA0B;AAClE,wCAAwC,0BAA0B;AAClE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,sBAAsB,YAAY;AAClC;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD,mDAAmD;AACnD,+DAA+D;AAC/D,+DAA+D;AAC/D;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;AACT;AACA,yDAAyD,YAAY;AACrE,SAAS;AACT;AACA,yDAAyD,YAAY;AACrE,SAAS;AACT;AACA;;AAEA,gCAAgC,gCAAgC;AAChE;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,uBAAuB,qDAAqD,UAAU,EAAE,EAAE;AAC1F;AACA,mDAAmD,cAAc,EAAE;AACnE,wCAAwC,iBAAiB,EAAE;AAC3D;AACA,0CAA0C,uBAAuB,EAAE;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,cAAc;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yBAAyB,cAAc;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,SAAS;;AAET,uBAAuB,gBAAgB;AACvC;AACA;AACA,iCAAiC,YAAY;AAC7C,oCAAoC,YAAY;AAChD;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,qBAAqB,mBAAmB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,YAAY;AAC7C;AACA;;AAEA;;AAEA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,iBAAiB;AAC9C;AACA;AACA;AACA;AACA,+BAA+B,mBAAmB;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0CAA0C,UAAU;AACpD,uCAAuC,UAAU;;AAEjD;AACA;AACA;AACA;AACA;AACA,kGAAkG;AAClG,sGAAsG;AACtG;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,mBAAmB;AACvD,+CAA+C,eAAe;AAC9D;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;AAEA;AACA,qCAAqC;AACrC;;AAEA,+BAA+B,sBAAsB;;AAErD;;AAEA;;AAEA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA,iCAAiC,eAAe;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,gCAAgC,sBAAsB;AACtD;AACA;AACA;;AAEA,sCAAsC,yBAAyB;;AAE/D;;AAEA;;AAEA;AACA;AACA,kCAAkC,kBAAkB,EAAE,OAAO,UAAU;AACvE;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,iBAAiB;AAC3E;;AAEA;AACA;AACA,aAAa;AACb,6BAA6B,KAAK;AAClC;AACA;AACA;AACA;AACA,0DAA0D,4BAA4B,EAAE;AACxF,2DAA2D,mCAAmC,EAAE;AAChG,0DAA0D,wBAAwB,EAAE;AACpF;AACA,mDAAmD,UAAU;AAC7D;AACA,uDAAuD,KAAK;AAC5D;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,UAAU;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,cAAc;AACpD;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,aAAa;AACb,8CAA8C,UAAU;AACxD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA,uCAAuC,aAAa;AACpD;;AAEA;AACA;;AAEA,aAAa;AACb;;AAEA,aAAa;AACb;AACA;AACA,0EAA0E,2CAA2C,EAAE;;AAEvH,aAAa,OAAO;AACpB;AACA;AACA;AACA,0EAA0E,yBAAyB;AACnG;AACA;AACA,iBAAiB;AACjB;AACA;AACA,mDAAmD,aAAa,EAAE;AAClE;;AAEA;AACA,kDAAkD,iBAAiB,EAAE;AACrE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAwB,+BAA+B;AACvD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;AAKA;AACA;;AAEA;AACA,0CAA0C,uBAAuB,EAAE;AACnE;AACA;AACA,+CAA+C,gBAAgB,EAAE;AACjE;AACA,uDAAuD,4CAA4C,EAAE;AACrG;AACA;AACA,SAAS;AACT;AACA,iDAAiD,gBAAgB,EAAE;AACnE;AACA,uDAAuD,gFAAgF,EAAE;AACzI;AACA;AACA,SAAS;AACT;AACA;AACA,iDAAiD,gBAAgB,EAAE;AACnE;AACA,uDAAuD,8HAA8H,EAAE;AACvL;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,iBAAiB;AAChD;AACA;;AAEA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;;AAEA,gCAAgC;AAChC;AACA;AACA;AACA,UAAU;;AAEV,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA,UAAU;;AAEV,+BAA+B,UAAU;AACzC,mCAAmC,oBAAoB;AACvD,mCAAmC,sBAAsB;AACzD,kCAAkC,sBAAsB;AACxD,iCAAiC,0CAA0C;AAC3E,kCAAkC,qFAAqF;AACvH,+BAA+B,4CAA4C;AAC3E;AACA,wBAAwB,YAAY;AACpC;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA8B,cAAc;AAC5C;AACA;AACA;;AAEA;AACA,8BAA8B,kBAAkB;AAChD;AACA;AACA;;AAEA;AACA,8BAA8B,cAAc;AAC5C;AACA;AACA;;AAEA;AACA,8BAA8B,YAAY;AAC1C;AACA;AACA;AACA,+BAA+B,cAAc;AAC7C,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA,8BAA8B,kBAAkB;AAChD;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,0BAA0B;;AAEzD;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,qBAAqB,KAAK;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,gBAAgB;AAChE;AACA;AACA;AACA,kCAAkC,aAAa;AAC/C,kCAAkC,aAAa;AAC/C;AACA;AACA,SAAS;;AAET;;AAEA,yCAAyC,6BAA6B;;AAEtE;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sDAAsD,YAAY,EAAE;;AAEpE,wBAAwB,kBAAkB;;AAE1C;;AAEA,uCAAuC;AACvC;AACA;AACA;;AAEA,uCAAuC;AACvC;AACA,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;;AAEA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,SAAS;AACpC;AACA;AACA;AACA;;AAEA,4CAA4C;AAC5C;AACA,2BAA2B,SAAS;AACpC;AACA;AACA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;;AAEA;;AAEA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,SAAS;AACpC;AACA;AACA;;AAEA;AACA;AACA,6BAA6B,OAAO;AACpC;AACA;AACA,+BAA+B,OAAO;AACtC;AACA;AACA;AACA,mCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,SAAS;AACxC;AACA;AACA,+BAA+B,OAAO;AACtC;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,+BAA+B,SAAS;AACxC;AACA;;AAEA;AACA;AACA,+BAA+B,SAAS;AACxC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,SAAS;AACpC;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA,2BAA2B,SAAS;AACpC;AACA;AACA;AACA,kEAAkE,YAAY,EAAE;AAChF;AACA,2BAA2B,8BAA8B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB;;AAErB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,WAAW;AACnC,2BAA2B,WAAW;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;;;;;AAKA;AACA,4BAA4B,kEAAkE;AAC9F,0BAA0B;AAC1B;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wDAAwD,qBAAqB;AAC7E;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;;;;;;;;;;AAgBA;;;;;;;;;;;AAWA;;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA,CAAC;;;;;;;;;;;;ACxpGD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,wDAAwD,EAAE;AACxE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC;AACvC;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,+BAA+B;AACnE;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,+BAA+B;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,yCAAyC;AACzC,uDAAuD;AACvD,6DAA6D;AAC7D,+BAA+B;AAC/B,MAAM;AACN;AACA;AACA;AACA,QAAQ;AACR,gBAAgB;AAChB,MAAM,eAAe;AACrB,0CAA0C,cAAc;AACxD,MAAM;AACN;AACA;;;;;;;;;;;;ACzBA,+DAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,YAAY;AACZ,gCAAgC;AAChC,wFAAwF;AACxF,qCAAqC;AACrC;AACA;AACA,mBAAmB;AACnB,YAAY;AACZ,kCAAkC;AAClC;AACA;AACA,kBAAkB;AAClB,YAAY;AACZ,UAAU,OAAO;AACjB;AACA;AACA,kBAAkB;AAClB,UAAU;AACV,QAAQ,cAAc;AACtB;AACA;AACA,kBAAkB;AAClB,QAAQ;AACR,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA;AACA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,sBAAsB,mBAAO,CAAC,+EAAe;AAC7C,kBAAkB,mBAAO,CAAC,+EAAe;AACzC,uBAAuB,mBAAO,CAAC,6EAAc;AAC7C,yBAAyB,mBAAO,CAAC,iGAAwB;AACzD,4BAA4B,mBAAO,CAAC,uGAA2B;AAC/D,kBAAkB,mBAAO,CAAC,iFAAgB;AAC1C,wBAAwB,mBAAO,CAAC,6FAAsB;AACtD,mBAAmB,mBAAO,CAAC,mFAAiB;;AAE5C;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACxWA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,qDAAqD;AACrD,gDAAgD;AAChD,yBAAyB;AACzB;AACA,QAAQ;AACR,uDAAuD;AACvD,6CAA6C;AAC7C,0BAA0B;AAC1B,sDAAsD;AACtD;AACA;AACA,uBAAuB;AACvB;AACA;AACA,sBAAsB;AACtB;AACA;AACA,wCAAwC;AACxC,QAAQ,EAAE;AACV,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,mBAAmB;AACnB,yDAAyD;AACzD;AACA,kCAAkC;AAClC,2CAA2C,4BAA4B,eAAe;AACtF,gCAAgC,yBAAyB,cAAc;AACvE;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B,qDAAqD,SAAS;AAC9D;AACA;AACA,QAAQ;AACR,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;;;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClBA,+DAAgB,mBAAO,CAAC,oEAAmB;AAC3C,wBAAwB,mBAAO,CAAC,2FAAqB;AACrD,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,2CAA2C;AAC3C,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;;AAEH;AACA,+DAA+D;AAC/D;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,sBAAsB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,OAAO;AACP;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;;;AChZA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,wBAAwB,mBAAO,CAAC,6FAAsB;;AAEtD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,QAAQ,kCAAkC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;ACrOA;AACA;;AAEA;AACA,SAAS,mBAAO,CAAC,iEAAO;AACxB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClCO,IAAMA,sBAAsB,GAAG,SAAzBA,sBAAyB,GAAM;AACxC;AACA,MAAMC,aAAa,GAAGC,aAAa,CAACC,cAAd,GA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","file":"__export.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/export.js\");\n","/* from https://github.com/taylorhakes/promise-polyfill */\n\nfunction promiseFinally(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nfunction noop() {}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError(\"Promises must be constructed via new\");\n  if (typeof fn !== \"function\") throw new TypeError(\"not a function\");\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError(\"A promise cannot be resolved with itself.\");\n    if (\n      newValue &&\n      (typeof newValue === \"object\" || typeof newValue === \"function\")\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === \"function\") {\n        doResolve(then.bind(newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value, self);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : null;\n  this.onRejected = typeof onRejected === \"function\" ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) {\n          Promise._multipleResolvesFn(\"resolve\", self, value);\n          return;\n        }\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) {\n          Promise._multipleResolvesFn(\"reject\", self, reason);\n          return;\n        }\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) {\n      Promise._multipleResolvesFn(\"reject\", self, ex);\n      return;\n    }\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype[\"catch\"] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype[\"finally\"] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.all accepts an array\"));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === \"object\" || typeof val === \"function\")) {\n          var then = val.then;\n          if (typeof then === \"function\") {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === \"object\" && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.race accepts an array\"));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn = setImmediate;\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err, promise) {\n  if (\n    typeof process !== \"undefined\" &&\n    process.listenerCount &&\n    (process.listenerCount(\"unhandledRejection\") ||\n      process.listenerCount(\"uncaughtException\"))\n  ) {\n    process.emit(\"unhandledRejection\", err, promise);\n    process.emit(\"uncaughtException\", err, \"unhandledRejection\");\n  } else if (typeof console !== \"undefined\" && console) {\n    console.warn(\"Possible Unhandled Promise Rejection:\", err);\n  }\n};\n\nPromise._multipleResolvesFn = function _multipleResolvesFn(\n  type,\n  promise,\n  value\n) {\n  if (typeof process !== \"undefined\" && process.emit) {\n    process.emit(\"multipleResolves\", type, promise, value);\n  }\n};\n\nmodule.exports = Promise;\n","/**\n * chroma.js - JavaScript library for color conversions\n *\n * Copyright (c) 2011-2019, Gregor Aisch\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n * list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. The name Gregor Aisch may not be used to endorse or promote products\n * derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * -------------------------------------------------------\n *\n * chroma.js includes colors from colorbrewer2.org, which are released under\n * the following license:\n *\n * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,\n * and The Pennsylvania State University.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n * either express or implied. See the License for the specific\n * language governing permissions and limitations under the License.\n *\n * ------------------------------------------------------\n *\n * Named colors are taken from X11 Color Names.\n * http://www.w3.org/TR/css3-color/#svg-color\n *\n * @preserve\n */\n\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global.chroma = factory());\n}(this, (function () { 'use strict';\n\n    var limit = function (x, min, max) {\n        if ( min === void 0 ) min=0;\n        if ( max === void 0 ) max=1;\n\n        return x < min ? min : x > max ? max : x;\n    };\n\n    var clip_rgb = function (rgb) {\n        rgb._clipped = false;\n        rgb._unclipped = rgb.slice(0);\n        for (var i=0; i<=3; i++) {\n            if (i < 3) {\n                if (rgb[i] < 0 || rgb[i] > 255) { rgb._clipped = true; }\n                rgb[i] = limit(rgb[i], 0, 255);\n            } else if (i === 3) {\n                rgb[i] = limit(rgb[i], 0, 1);\n            }\n        }\n        return rgb;\n    };\n\n    // ported from jQuery's $.type\n    var classToType = {};\n    for (var i = 0, list = ['Boolean', 'Number', 'String', 'Function', 'Array', 'Date', 'RegExp', 'Undefined', 'Null']; i < list.length; i += 1) {\n        var name = list[i];\n\n        classToType[(\"[object \" + name + \"]\")] = name.toLowerCase();\n    }\n    var type = function(obj) {\n        return classToType[Object.prototype.toString.call(obj)] || \"object\";\n    };\n\n    var unpack = function (args, keyOrder) {\n        if ( keyOrder === void 0 ) keyOrder=null;\n\n    \t// if called with more than 3 arguments, we return the arguments\n        if (args.length >= 3) { return Array.prototype.slice.call(args); }\n        // with less than 3 args we check if first arg is object\n        // and use the keyOrder string to extract and sort properties\n    \tif (type(args[0]) == 'object' && keyOrder) {\n    \t\treturn keyOrder.split('')\n    \t\t\t.filter(function (k) { return args[0][k] !== undefined; })\n    \t\t\t.map(function (k) { return args[0][k]; });\n    \t}\n    \t// otherwise we just return the first argument\n    \t// (which we suppose is an array of args)\n        return args[0];\n    };\n\n    var last = function (args) {\n        if (args.length < 2) { return null; }\n        var l = args.length-1;\n        if (type(args[l]) == 'string') { return args[l].toLowerCase(); }\n        return null;\n    };\n\n    var PI = Math.PI;\n\n    var utils = {\n    \tclip_rgb: clip_rgb,\n    \tlimit: limit,\n    \ttype: type,\n    \tunpack: unpack,\n    \tlast: last,\n    \tPI: PI,\n    \tTWOPI: PI*2,\n    \tPITHIRD: PI/3,\n    \tDEG2RAD: PI / 180,\n    \tRAD2DEG: 180 / PI\n    };\n\n    var input = {\n    \tformat: {},\n    \tautodetect: []\n    };\n\n    var last$1 = utils.last;\n    var clip_rgb$1 = utils.clip_rgb;\n    var type$1 = utils.type;\n\n\n    var Color = function Color() {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var me = this;\n        if (type$1(args[0]) === 'object' &&\n            args[0].constructor &&\n            args[0].constructor === this.constructor) {\n            // the argument is already a Color instance\n            return args[0];\n        }\n\n        // last argument could be the mode\n        var mode = last$1(args);\n        var autodetect = false;\n\n        if (!mode) {\n            autodetect = true;\n            if (!input.sorted) {\n                input.autodetect = input.autodetect.sort(function (a,b) { return b.p - a.p; });\n                input.sorted = true;\n            }\n            // auto-detect format\n            for (var i = 0, list = input.autodetect; i < list.length; i += 1) {\n                var chk = list[i];\n\n                mode = chk.test.apply(chk, args);\n                if (mode) { break; }\n            }\n        }\n\n        if (input.format[mode]) {\n            var rgb = input.format[mode].apply(null, autodetect ? args : args.slice(0,-1));\n            me._rgb = clip_rgb$1(rgb);\n        } else {\n            throw new Error('unknown format: '+args);\n        }\n\n        // add alpha channel\n        if (me._rgb.length === 3) { me._rgb.push(1); }\n    };\n\n    Color.prototype.toString = function toString () {\n        if (type$1(this.hex) == 'function') { return this.hex(); }\n        return (\"[\" + (this._rgb.join(',')) + \"]\");\n    };\n\n    var Color_1 = Color;\n\n    var chroma = function () {\n    \tvar args = [], len = arguments.length;\n    \twhile ( len-- ) args[ len ] = arguments[ len ];\n\n    \treturn new (Function.prototype.bind.apply( chroma.Color, [ null ].concat( args) ));\n    };\n\n    chroma.Color = Color_1;\n    chroma.version = '2.1.0';\n\n    var chroma_1 = chroma;\n\n    var unpack$1 = utils.unpack;\n    var max = Math.max;\n\n    var rgb2cmyk = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$1(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        r = r / 255;\n        g = g / 255;\n        b = b / 255;\n        var k = 1 - max(r,max(g,b));\n        var f = k < 1 ? 1 / (1-k) : 0;\n        var c = (1-r-k) * f;\n        var m = (1-g-k) * f;\n        var y = (1-b-k) * f;\n        return [c,m,y,k];\n    };\n\n    var rgb2cmyk_1 = rgb2cmyk;\n\n    var unpack$2 = utils.unpack;\n\n    var cmyk2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$2(args, 'cmyk');\n        var c = args[0];\n        var m = args[1];\n        var y = args[2];\n        var k = args[3];\n        var alpha = args.length > 4 ? args[4] : 1;\n        if (k === 1) { return [0,0,0,alpha]; }\n        return [\n            c >= 1 ? 0 : 255 * (1-c) * (1-k), // r\n            m >= 1 ? 0 : 255 * (1-m) * (1-k), // g\n            y >= 1 ? 0 : 255 * (1-y) * (1-k), // b\n            alpha\n        ];\n    };\n\n    var cmyk2rgb_1 = cmyk2rgb;\n\n    var unpack$3 = utils.unpack;\n    var type$2 = utils.type;\n\n\n\n    Color_1.prototype.cmyk = function() {\n        return rgb2cmyk_1(this._rgb);\n    };\n\n    chroma_1.cmyk = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['cmyk']) ));\n    };\n\n    input.format.cmyk = cmyk2rgb_1;\n\n    input.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$3(args, 'cmyk');\n            if (type$2(args) === 'array' && args.length === 4) {\n                return 'cmyk';\n            }\n        }\n    });\n\n    var unpack$4 = utils.unpack;\n    var last$2 = utils.last;\n    var rnd = function (a) { return Math.round(a*100)/100; };\n\n    /*\n     * supported arguments:\n     * - hsl2css(h,s,l)\n     * - hsl2css(h,s,l,a)\n     * - hsl2css([h,s,l], mode)\n     * - hsl2css([h,s,l,a], mode)\n     * - hsl2css({h,s,l,a}, mode)\n     */\n    var hsl2css = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var hsla = unpack$4(args, 'hsla');\n        var mode = last$2(args) || 'lsa';\n        hsla[0] = rnd(hsla[0] || 0);\n        hsla[1] = rnd(hsla[1]*100) + '%';\n        hsla[2] = rnd(hsla[2]*100) + '%';\n        if (mode === 'hsla' || (hsla.length > 3 && hsla[3]<1)) {\n            hsla[3] = hsla.length > 3 ? hsla[3] : 1;\n            mode = 'hsla';\n        } else {\n            hsla.length = 3;\n        }\n        return (mode + \"(\" + (hsla.join(',')) + \")\");\n    };\n\n    var hsl2css_1 = hsl2css;\n\n    var unpack$5 = utils.unpack;\n\n    /*\n     * supported arguments:\n     * - rgb2hsl(r,g,b)\n     * - rgb2hsl(r,g,b,a)\n     * - rgb2hsl([r,g,b])\n     * - rgb2hsl([r,g,b,a])\n     * - rgb2hsl({r,g,b,a})\n     */\n    var rgb2hsl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$5(args, 'rgba');\n        var r = args[0];\n        var g = args[1];\n        var b = args[2];\n\n        r /= 255;\n        g /= 255;\n        b /= 255;\n\n        var min = Math.min(r, g, b);\n        var max = Math.max(r, g, b);\n\n        var l = (max + min) / 2;\n        var s, h;\n\n        if (max === min){\n            s = 0;\n            h = Number.NaN;\n        } else {\n            s = l < 0.5 ? (max - min) / (max + min) : (max - min) / (2 - max - min);\n        }\n\n        if (r == max) { h = (g - b) / (max - min); }\n        else if (g == max) { h = 2 + (b - r) / (max - min); }\n        else if (b == max) { h = 4 + (r - g) / (max - min); }\n\n        h *= 60;\n        if (h < 0) { h += 360; }\n        if (args.length>3 && args[3]!==undefined) { return [h,s,l,args[3]]; }\n        return [h,s,l];\n    };\n\n    var rgb2hsl_1 = rgb2hsl;\n\n    var unpack$6 = utils.unpack;\n    var last$3 = utils.last;\n\n\n    var round = Math.round;\n\n    /*\n     * supported arguments:\n     * - rgb2css(r,g,b)\n     * - rgb2css(r,g,b,a)\n     * - rgb2css([r,g,b], mode)\n     * - rgb2css([r,g,b,a], mode)\n     * - rgb2css({r,g,b,a}, mode)\n     */\n    var rgb2css = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgba = unpack$6(args, 'rgba');\n        var mode = last$3(args) || 'rgb';\n        if (mode.substr(0,3) == 'hsl') {\n            return hsl2css_1(rgb2hsl_1(rgba), mode);\n        }\n        rgba[0] = round(rgba[0]);\n        rgba[1] = round(rgba[1]);\n        rgba[2] = round(rgba[2]);\n        if (mode === 'rgba' || (rgba.length > 3 && rgba[3]<1)) {\n            rgba[3] = rgba.length > 3 ? rgba[3] : 1;\n            mode = 'rgba';\n        }\n        return (mode + \"(\" + (rgba.slice(0,mode==='rgb'?3:4).join(',')) + \")\");\n    };\n\n    var rgb2css_1 = rgb2css;\n\n    var unpack$7 = utils.unpack;\n    var round$1 = Math.round;\n\n    var hsl2rgb = function () {\n        var assign;\n\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n        args = unpack$7(args, 'hsl');\n        var h = args[0];\n        var s = args[1];\n        var l = args[2];\n        var r,g,b;\n        if (s === 0) {\n            r = g = b = l*255;\n        } else {\n            var t3 = [0,0,0];\n            var c = [0,0,0];\n            var t2 = l < 0.5 ? l * (1+s) : l+s-l*s;\n            var t1 = 2 * l - t2;\n            var h_ = h / 360;\n            t3[0] = h_ + 1/3;\n            t3[1] = h_;\n            t3[2] = h_ - 1/3;\n            for (var i=0; i<3; i++) {\n                if (t3[i] < 0) { t3[i] += 1; }\n                if (t3[i] > 1) { t3[i] -= 1; }\n                if (6 * t3[i] < 1)\n                    { c[i] = t1 + (t2 - t1) * 6 * t3[i]; }\n                else if (2 * t3[i] < 1)\n                    { c[i] = t2; }\n                else if (3 * t3[i] < 2)\n                    { c[i] = t1 + (t2 - t1) * ((2 / 3) - t3[i]) * 6; }\n                else\n                    { c[i] = t1; }\n            }\n            (assign = [round$1(c[0]*255),round$1(c[1]*255),round$1(c[2]*255)], r = assign[0], g = assign[1], b = assign[2]);\n        }\n        if (args.length > 3) {\n            // keep alpha channel\n            return [r,g,b,args[3]];\n        }\n        return [r,g,b,1];\n    };\n\n    var hsl2rgb_1 = hsl2rgb;\n\n    var RE_RGB = /^rgb\\(\\s*(-?\\d+),\\s*(-?\\d+)\\s*,\\s*(-?\\d+)\\s*\\)$/;\n    var RE_RGBA = /^rgba\\(\\s*(-?\\d+),\\s*(-?\\d+)\\s*,\\s*(-?\\d+)\\s*,\\s*([01]|[01]?\\.\\d+)\\)$/;\n    var RE_RGB_PCT = /^rgb\\(\\s*(-?\\d+(?:\\.\\d+)?)%,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*\\)$/;\n    var RE_RGBA_PCT = /^rgba\\(\\s*(-?\\d+(?:\\.\\d+)?)%,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)$/;\n    var RE_HSL = /^hsl\\(\\s*(-?\\d+(?:\\.\\d+)?),\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*\\)$/;\n    var RE_HSLA = /^hsla\\(\\s*(-?\\d+(?:\\.\\d+)?),\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)$/;\n\n    var round$2 = Math.round;\n\n    var css2rgb = function (css) {\n        css = css.toLowerCase().trim();\n        var m;\n\n        if (input.format.named) {\n            try {\n                return input.format.named(css);\n            } catch (e) {\n                // eslint-disable-next-line\n            }\n        }\n\n        // rgb(250,20,0)\n        if ((m = css.match(RE_RGB))) {\n            var rgb = m.slice(1,4);\n            for (var i=0; i<3; i++) {\n                rgb[i] = +rgb[i];\n            }\n            rgb[3] = 1;  // default alpha\n            return rgb;\n        }\n\n        // rgba(250,20,0,0.4)\n        if ((m = css.match(RE_RGBA))) {\n            var rgb$1 = m.slice(1,5);\n            for (var i$1=0; i$1<4; i$1++) {\n                rgb$1[i$1] = +rgb$1[i$1];\n            }\n            return rgb$1;\n        }\n\n        // rgb(100%,0%,0%)\n        if ((m = css.match(RE_RGB_PCT))) {\n            var rgb$2 = m.slice(1,4);\n            for (var i$2=0; i$2<3; i$2++) {\n                rgb$2[i$2] = round$2(rgb$2[i$2] * 2.55);\n            }\n            rgb$2[3] = 1;  // default alpha\n            return rgb$2;\n        }\n\n        // rgba(100%,0%,0%,0.4)\n        if ((m = css.match(RE_RGBA_PCT))) {\n            var rgb$3 = m.slice(1,5);\n            for (var i$3=0; i$3<3; i$3++) {\n                rgb$3[i$3] = round$2(rgb$3[i$3] * 2.55);\n            }\n            rgb$3[3] = +rgb$3[3];\n            return rgb$3;\n        }\n\n        // hsl(0,100%,50%)\n        if ((m = css.match(RE_HSL))) {\n            var hsl = m.slice(1,4);\n            hsl[1] *= 0.01;\n            hsl[2] *= 0.01;\n            var rgb$4 = hsl2rgb_1(hsl);\n            rgb$4[3] = 1;\n            return rgb$4;\n        }\n\n        // hsla(0,100%,50%,0.5)\n        if ((m = css.match(RE_HSLA))) {\n            var hsl$1 = m.slice(1,4);\n            hsl$1[1] *= 0.01;\n            hsl$1[2] *= 0.01;\n            var rgb$5 = hsl2rgb_1(hsl$1);\n            rgb$5[3] = +m[4];  // default alpha = 1\n            return rgb$5;\n        }\n    };\n\n    css2rgb.test = function (s) {\n        return RE_RGB.test(s) ||\n            RE_RGBA.test(s) ||\n            RE_RGB_PCT.test(s) ||\n            RE_RGBA_PCT.test(s) ||\n            RE_HSL.test(s) ||\n            RE_HSLA.test(s);\n    };\n\n    var css2rgb_1 = css2rgb;\n\n    var type$3 = utils.type;\n\n\n\n\n    Color_1.prototype.css = function(mode) {\n        return rgb2css_1(this._rgb, mode);\n    };\n\n    chroma_1.css = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['css']) ));\n    };\n\n    input.format.css = css2rgb_1;\n\n    input.autodetect.push({\n        p: 5,\n        test: function (h) {\n            var rest = [], len = arguments.length - 1;\n            while ( len-- > 0 ) rest[ len ] = arguments[ len + 1 ];\n\n            if (!rest.length && type$3(h) === 'string' && css2rgb_1.test(h)) {\n                return 'css';\n            }\n        }\n    });\n\n    var unpack$8 = utils.unpack;\n\n    input.format.gl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgb = unpack$8(args, 'rgba');\n        rgb[0] *= 255;\n        rgb[1] *= 255;\n        rgb[2] *= 255;\n        return rgb;\n    };\n\n    chroma_1.gl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['gl']) ));\n    };\n\n    Color_1.prototype.gl = function() {\n        var rgb = this._rgb;\n        return [rgb[0]/255, rgb[1]/255, rgb[2]/255, rgb[3]];\n    };\n\n    var unpack$9 = utils.unpack;\n\n    var rgb2hcg = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$9(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var min = Math.min(r, g, b);\n        var max = Math.max(r, g, b);\n        var delta = max - min;\n        var c = delta * 100 / 255;\n        var _g = min / (255 - delta) * 100;\n        var h;\n        if (delta === 0) {\n            h = Number.NaN;\n        } else {\n            if (r === max) { h = (g - b) / delta; }\n            if (g === max) { h = 2+(b - r) / delta; }\n            if (b === max) { h = 4+(r - g) / delta; }\n            h *= 60;\n            if (h < 0) { h += 360; }\n        }\n        return [h, c, _g];\n    };\n\n    var rgb2hcg_1 = rgb2hcg;\n\n    var unpack$a = utils.unpack;\n    var floor = Math.floor;\n\n    /*\n     * this is basically just HSV with some minor tweaks\n     *\n     * hue.. [0..360]\n     * chroma .. [0..1]\n     * grayness .. [0..1]\n     */\n\n    var hcg2rgb = function () {\n        var assign, assign$1, assign$2, assign$3, assign$4, assign$5;\n\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n        args = unpack$a(args, 'hcg');\n        var h = args[0];\n        var c = args[1];\n        var _g = args[2];\n        var r,g,b;\n        _g = _g * 255;\n        var _c = c * 255;\n        if (c === 0) {\n            r = g = b = _g;\n        } else {\n            if (h === 360) { h = 0; }\n            if (h > 360) { h -= 360; }\n            if (h < 0) { h += 360; }\n            h /= 60;\n            var i = floor(h);\n            var f = h - i;\n            var p = _g * (1 - c);\n            var q = p + _c * (1 - f);\n            var t = p + _c * f;\n            var v = p + _c;\n            switch (i) {\n                case 0: (assign = [v, t, p], r = assign[0], g = assign[1], b = assign[2]); break\n                case 1: (assign$1 = [q, v, p], r = assign$1[0], g = assign$1[1], b = assign$1[2]); break\n                case 2: (assign$2 = [p, v, t], r = assign$2[0], g = assign$2[1], b = assign$2[2]); break\n                case 3: (assign$3 = [p, q, v], r = assign$3[0], g = assign$3[1], b = assign$3[2]); break\n                case 4: (assign$4 = [t, p, v], r = assign$4[0], g = assign$4[1], b = assign$4[2]); break\n                case 5: (assign$5 = [v, p, q], r = assign$5[0], g = assign$5[1], b = assign$5[2]); break\n            }\n        }\n        return [r, g, b, args.length > 3 ? args[3] : 1];\n    };\n\n    var hcg2rgb_1 = hcg2rgb;\n\n    var unpack$b = utils.unpack;\n    var type$4 = utils.type;\n\n\n\n\n\n\n    Color_1.prototype.hcg = function() {\n        return rgb2hcg_1(this._rgb);\n    };\n\n    chroma_1.hcg = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['hcg']) ));\n    };\n\n    input.format.hcg = hcg2rgb_1;\n\n    input.autodetect.push({\n        p: 1,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$b(args, 'hcg');\n            if (type$4(args) === 'array' && args.length === 3) {\n                return 'hcg';\n            }\n        }\n    });\n\n    var unpack$c = utils.unpack;\n    var last$4 = utils.last;\n    var round$3 = Math.round;\n\n    var rgb2hex = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$c(args, 'rgba');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var a = ref[3];\n        var mode = last$4(args) || 'auto';\n        if (a === undefined) { a = 1; }\n        if (mode === 'auto') {\n            mode = a < 1 ? 'rgba' : 'rgb';\n        }\n        r = round$3(r);\n        g = round$3(g);\n        b = round$3(b);\n        var u = r << 16 | g << 8 | b;\n        var str = \"000000\" + u.toString(16); //#.toUpperCase();\n        str = str.substr(str.length - 6);\n        var hxa = '0' + round$3(a * 255).toString(16);\n        hxa = hxa.substr(hxa.length - 2);\n        switch (mode.toLowerCase()) {\n            case 'rgba': return (\"#\" + str + hxa);\n            case 'argb': return (\"#\" + hxa + str);\n            default: return (\"#\" + str);\n        }\n    };\n\n    var rgb2hex_1 = rgb2hex;\n\n    var RE_HEX = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\n    var RE_HEXA = /^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/;\n\n    var hex2rgb = function (hex) {\n        if (hex.match(RE_HEX)) {\n            // remove optional leading #\n            if (hex.length === 4 || hex.length === 7) {\n                hex = hex.substr(1);\n            }\n            // expand short-notation to full six-digit\n            if (hex.length === 3) {\n                hex = hex.split('');\n                hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];\n            }\n            var u = parseInt(hex, 16);\n            var r = u >> 16;\n            var g = u >> 8 & 0xFF;\n            var b = u & 0xFF;\n            return [r,g,b,1];\n        }\n\n        // match rgba hex format, eg #FF000077\n        if (hex.match(RE_HEXA)) {\n            if (hex.length === 5 || hex.length === 9) {\n                // remove optional leading #\n                hex = hex.substr(1);\n            }\n            // expand short-notation to full eight-digit\n            if (hex.length === 4) {\n                hex = hex.split('');\n                hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];\n            }\n            var u$1 = parseInt(hex, 16);\n            var r$1 = u$1 >> 24 & 0xFF;\n            var g$1 = u$1 >> 16 & 0xFF;\n            var b$1 = u$1 >> 8 & 0xFF;\n            var a = Math.round((u$1 & 0xFF) / 0xFF * 100) / 100;\n            return [r$1,g$1,b$1,a];\n        }\n\n        // we used to check for css colors here\n        // if _input.css? and rgb = _input.css hex\n        //     return rgb\n\n        throw new Error((\"unknown hex color: \" + hex));\n    };\n\n    var hex2rgb_1 = hex2rgb;\n\n    var type$5 = utils.type;\n\n\n\n\n    Color_1.prototype.hex = function(mode) {\n        return rgb2hex_1(this._rgb, mode);\n    };\n\n    chroma_1.hex = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['hex']) ));\n    };\n\n    input.format.hex = hex2rgb_1;\n    input.autodetect.push({\n        p: 4,\n        test: function (h) {\n            var rest = [], len = arguments.length - 1;\n            while ( len-- > 0 ) rest[ len ] = arguments[ len + 1 ];\n\n            if (!rest.length && type$5(h) === 'string' && [3,4,5,6,7,8,9].indexOf(h.length) >= 0) {\n                return 'hex';\n            }\n        }\n    });\n\n    var unpack$d = utils.unpack;\n    var TWOPI = utils.TWOPI;\n    var min = Math.min;\n    var sqrt = Math.sqrt;\n    var acos = Math.acos;\n\n    var rgb2hsi = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        /*\n        borrowed from here:\n        http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/rgb2hsi.cpp\n        */\n        var ref = unpack$d(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        r /= 255;\n        g /= 255;\n        b /= 255;\n        var h;\n        var min_ = min(r,g,b);\n        var i = (r+g+b) / 3;\n        var s = i > 0 ? 1 - min_/i : 0;\n        if (s === 0) {\n            h = NaN;\n        } else {\n            h = ((r-g)+(r-b)) / 2;\n            h /= sqrt((r-g)*(r-g) + (r-b)*(g-b));\n            h = acos(h);\n            if (b > g) {\n                h = TWOPI - h;\n            }\n            h /= TWOPI;\n        }\n        return [h*360,s,i];\n    };\n\n    var rgb2hsi_1 = rgb2hsi;\n\n    var unpack$e = utils.unpack;\n    var limit$1 = utils.limit;\n    var TWOPI$1 = utils.TWOPI;\n    var PITHIRD = utils.PITHIRD;\n    var cos = Math.cos;\n\n    /*\n     * hue [0..360]\n     * saturation [0..1]\n     * intensity [0..1]\n     */\n    var hsi2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        /*\n        borrowed from here:\n        http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/hsi2rgb.cpp\n        */\n        args = unpack$e(args, 'hsi');\n        var h = args[0];\n        var s = args[1];\n        var i = args[2];\n        var r,g,b;\n\n        if (isNaN(h)) { h = 0; }\n        if (isNaN(s)) { s = 0; }\n        // normalize hue\n        if (h > 360) { h -= 360; }\n        if (h < 0) { h += 360; }\n        h /= 360;\n        if (h < 1/3) {\n            b = (1-s)/3;\n            r = (1+s*cos(TWOPI$1*h)/cos(PITHIRD-TWOPI$1*h))/3;\n            g = 1 - (b+r);\n        } else if (h < 2/3) {\n            h -= 1/3;\n            r = (1-s)/3;\n            g = (1+s*cos(TWOPI$1*h)/cos(PITHIRD-TWOPI$1*h))/3;\n            b = 1 - (r+g);\n        } else {\n            h -= 2/3;\n            g = (1-s)/3;\n            b = (1+s*cos(TWOPI$1*h)/cos(PITHIRD-TWOPI$1*h))/3;\n            r = 1 - (g+b);\n        }\n        r = limit$1(i*r*3);\n        g = limit$1(i*g*3);\n        b = limit$1(i*b*3);\n        return [r*255, g*255, b*255, args.length > 3 ? args[3] : 1];\n    };\n\n    var hsi2rgb_1 = hsi2rgb;\n\n    var unpack$f = utils.unpack;\n    var type$6 = utils.type;\n\n\n\n\n\n\n    Color_1.prototype.hsi = function() {\n        return rgb2hsi_1(this._rgb);\n    };\n\n    chroma_1.hsi = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['hsi']) ));\n    };\n\n    input.format.hsi = hsi2rgb_1;\n\n    input.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$f(args, 'hsi');\n            if (type$6(args) === 'array' && args.length === 3) {\n                return 'hsi';\n            }\n        }\n    });\n\n    var unpack$g = utils.unpack;\n    var type$7 = utils.type;\n\n\n\n\n\n\n    Color_1.prototype.hsl = function() {\n        return rgb2hsl_1(this._rgb);\n    };\n\n    chroma_1.hsl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['hsl']) ));\n    };\n\n    input.format.hsl = hsl2rgb_1;\n\n    input.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$g(args, 'hsl');\n            if (type$7(args) === 'array' && args.length === 3) {\n                return 'hsl';\n            }\n        }\n    });\n\n    var unpack$h = utils.unpack;\n    var min$1 = Math.min;\n    var max$1 = Math.max;\n\n    /*\n     * supported arguments:\n     * - rgb2hsv(r,g,b)\n     * - rgb2hsv([r,g,b])\n     * - rgb2hsv({r,g,b})\n     */\n    var rgb2hsl$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$h(args, 'rgb');\n        var r = args[0];\n        var g = args[1];\n        var b = args[2];\n        var min_ = min$1(r, g, b);\n        var max_ = max$1(r, g, b);\n        var delta = max_ - min_;\n        var h,s,v;\n        v = max_ / 255.0;\n        if (max_ === 0) {\n            h = Number.NaN;\n            s = 0;\n        } else {\n            s = delta / max_;\n            if (r === max_) { h = (g - b) / delta; }\n            if (g === max_) { h = 2+(b - r) / delta; }\n            if (b === max_) { h = 4+(r - g) / delta; }\n            h *= 60;\n            if (h < 0) { h += 360; }\n        }\n        return [h, s, v]\n    };\n\n    var rgb2hsv = rgb2hsl$1;\n\n    var unpack$i = utils.unpack;\n    var floor$1 = Math.floor;\n\n    var hsv2rgb = function () {\n        var assign, assign$1, assign$2, assign$3, assign$4, assign$5;\n\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n        args = unpack$i(args, 'hsv');\n        var h = args[0];\n        var s = args[1];\n        var v = args[2];\n        var r,g,b;\n        v *= 255;\n        if (s === 0) {\n            r = g = b = v;\n        } else {\n            if (h === 360) { h = 0; }\n            if (h > 360) { h -= 360; }\n            if (h < 0) { h += 360; }\n            h /= 60;\n\n            var i = floor$1(h);\n            var f = h - i;\n            var p = v * (1 - s);\n            var q = v * (1 - s * f);\n            var t = v * (1 - s * (1 - f));\n\n            switch (i) {\n                case 0: (assign = [v, t, p], r = assign[0], g = assign[1], b = assign[2]); break\n                case 1: (assign$1 = [q, v, p], r = assign$1[0], g = assign$1[1], b = assign$1[2]); break\n                case 2: (assign$2 = [p, v, t], r = assign$2[0], g = assign$2[1], b = assign$2[2]); break\n                case 3: (assign$3 = [p, q, v], r = assign$3[0], g = assign$3[1], b = assign$3[2]); break\n                case 4: (assign$4 = [t, p, v], r = assign$4[0], g = assign$4[1], b = assign$4[2]); break\n                case 5: (assign$5 = [v, p, q], r = assign$5[0], g = assign$5[1], b = assign$5[2]); break\n            }\n        }\n        return [r,g,b,args.length > 3?args[3]:1];\n    };\n\n    var hsv2rgb_1 = hsv2rgb;\n\n    var unpack$j = utils.unpack;\n    var type$8 = utils.type;\n\n\n\n\n\n\n    Color_1.prototype.hsv = function() {\n        return rgb2hsv(this._rgb);\n    };\n\n    chroma_1.hsv = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['hsv']) ));\n    };\n\n    input.format.hsv = hsv2rgb_1;\n\n    input.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$j(args, 'hsv');\n            if (type$8(args) === 'array' && args.length === 3) {\n                return 'hsv';\n            }\n        }\n    });\n\n    var labConstants = {\n        // Corresponds roughly to RGB brighter/darker\n        Kn: 18,\n\n        // D65 standard referent\n        Xn: 0.950470,\n        Yn: 1,\n        Zn: 1.088830,\n\n        t0: 0.137931034,  // 4 / 29\n        t1: 0.206896552,  // 6 / 29\n        t2: 0.12841855,   // 3 * t1 * t1\n        t3: 0.008856452,  // t1 * t1 * t1\n    };\n\n    var unpack$k = utils.unpack;\n    var pow = Math.pow;\n\n    var rgb2lab = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$k(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var ref$1 = rgb2xyz(r,g,b);\n        var x = ref$1[0];\n        var y = ref$1[1];\n        var z = ref$1[2];\n        var l = 116 * y - 16;\n        return [l < 0 ? 0 : l, 500 * (x - y), 200 * (y - z)];\n    };\n\n    var rgb_xyz = function (r) {\n        if ((r /= 255) <= 0.04045) { return r / 12.92; }\n        return pow((r + 0.055) / 1.055, 2.4);\n    };\n\n    var xyz_lab = function (t) {\n        if (t > labConstants.t3) { return pow(t, 1 / 3); }\n        return t / labConstants.t2 + labConstants.t0;\n    };\n\n    var rgb2xyz = function (r,g,b) {\n        r = rgb_xyz(r);\n        g = rgb_xyz(g);\n        b = rgb_xyz(b);\n        var x = xyz_lab((0.4124564 * r + 0.3575761 * g + 0.1804375 * b) / labConstants.Xn);\n        var y = xyz_lab((0.2126729 * r + 0.7151522 * g + 0.0721750 * b) / labConstants.Yn);\n        var z = xyz_lab((0.0193339 * r + 0.1191920 * g + 0.9503041 * b) / labConstants.Zn);\n        return [x,y,z];\n    };\n\n    var rgb2lab_1 = rgb2lab;\n\n    var unpack$l = utils.unpack;\n    var pow$1 = Math.pow;\n\n    /*\n     * L* [0..100]\n     * a [-100..100]\n     * b [-100..100]\n     */\n    var lab2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$l(args, 'lab');\n        var l = args[0];\n        var a = args[1];\n        var b = args[2];\n        var x,y,z, r,g,b_;\n\n        y = (l + 16) / 116;\n        x = isNaN(a) ? y : y + a / 500;\n        z = isNaN(b) ? y : y - b / 200;\n\n        y = labConstants.Yn * lab_xyz(y);\n        x = labConstants.Xn * lab_xyz(x);\n        z = labConstants.Zn * lab_xyz(z);\n\n        r = xyz_rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z);  // D65 -> sRGB\n        g = xyz_rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z);\n        b_ = xyz_rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z);\n\n        return [r,g,b_,args.length > 3 ? args[3] : 1];\n    };\n\n    var xyz_rgb = function (r) {\n        return 255 * (r <= 0.00304 ? 12.92 * r : 1.055 * pow$1(r, 1 / 2.4) - 0.055)\n    };\n\n    var lab_xyz = function (t) {\n        return t > labConstants.t1 ? t * t * t : labConstants.t2 * (t - labConstants.t0)\n    };\n\n    var lab2rgb_1 = lab2rgb;\n\n    var unpack$m = utils.unpack;\n    var type$9 = utils.type;\n\n\n\n\n\n\n    Color_1.prototype.lab = function() {\n        return rgb2lab_1(this._rgb);\n    };\n\n    chroma_1.lab = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['lab']) ));\n    };\n\n    input.format.lab = lab2rgb_1;\n\n    input.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$m(args, 'lab');\n            if (type$9(args) === 'array' && args.length === 3) {\n                return 'lab';\n            }\n        }\n    });\n\n    var unpack$n = utils.unpack;\n    var RAD2DEG = utils.RAD2DEG;\n    var sqrt$1 = Math.sqrt;\n    var atan2 = Math.atan2;\n    var round$4 = Math.round;\n\n    var lab2lch = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$n(args, 'lab');\n        var l = ref[0];\n        var a = ref[1];\n        var b = ref[2];\n        var c = sqrt$1(a * a + b * b);\n        var h = (atan2(b, a) * RAD2DEG + 360) % 360;\n        if (round$4(c*10000) === 0) { h = Number.NaN; }\n        return [l, c, h];\n    };\n\n    var lab2lch_1 = lab2lch;\n\n    var unpack$o = utils.unpack;\n\n\n\n    var rgb2lch = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$o(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var ref$1 = rgb2lab_1(r,g,b);\n        var l = ref$1[0];\n        var a = ref$1[1];\n        var b_ = ref$1[2];\n        return lab2lch_1(l,a,b_);\n    };\n\n    var rgb2lch_1 = rgb2lch;\n\n    var unpack$p = utils.unpack;\n    var DEG2RAD = utils.DEG2RAD;\n    var sin = Math.sin;\n    var cos$1 = Math.cos;\n\n    var lch2lab = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        /*\n        Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n        These formulas were invented by David Dalrymple to obtain maximum contrast without going\n        out of gamut if the parameters are in the range 0-1.\n\n        A saturation multiplier was added by Gregor Aisch\n        */\n        var ref = unpack$p(args, 'lch');\n        var l = ref[0];\n        var c = ref[1];\n        var h = ref[2];\n        if (isNaN(h)) { h = 0; }\n        h = h * DEG2RAD;\n        return [l, cos$1(h) * c, sin(h) * c]\n    };\n\n    var lch2lab_1 = lch2lab;\n\n    var unpack$q = utils.unpack;\n\n\n\n    var lch2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$q(args, 'lch');\n        var l = args[0];\n        var c = args[1];\n        var h = args[2];\n        var ref = lch2lab_1 (l,c,h);\n        var L = ref[0];\n        var a = ref[1];\n        var b_ = ref[2];\n        var ref$1 = lab2rgb_1 (L,a,b_);\n        var r = ref$1[0];\n        var g = ref$1[1];\n        var b = ref$1[2];\n        return [r, g, b, args.length > 3 ? args[3] : 1];\n    };\n\n    var lch2rgb_1 = lch2rgb;\n\n    var unpack$r = utils.unpack;\n\n\n    var hcl2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var hcl = unpack$r(args, 'hcl').reverse();\n        return lch2rgb_1.apply(void 0, hcl);\n    };\n\n    var hcl2rgb_1 = hcl2rgb;\n\n    var unpack$s = utils.unpack;\n    var type$a = utils.type;\n\n\n\n\n\n\n    Color_1.prototype.lch = function() { return rgb2lch_1(this._rgb); };\n    Color_1.prototype.hcl = function() { return rgb2lch_1(this._rgb).reverse(); };\n\n    chroma_1.lch = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['lch']) ));\n    };\n    chroma_1.hcl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['hcl']) ));\n    };\n\n    input.format.lch = lch2rgb_1;\n    input.format.hcl = hcl2rgb_1;\n\n    ['lch','hcl'].forEach(function (m) { return input.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$s(args, m);\n            if (type$a(args) === 'array' && args.length === 3) {\n                return m;\n            }\n        }\n    }); });\n\n    /**\n    \tX11 color names\n\n    \thttp://www.w3.org/TR/css3-color/#svg-color\n    */\n\n    var w3cx11 = {\n        aliceblue: '#f0f8ff',\n        antiquewhite: '#faebd7',\n        aqua: '#00ffff',\n        aquamarine: '#7fffd4',\n        azure: '#f0ffff',\n        beige: '#f5f5dc',\n        bisque: '#ffe4c4',\n        black: '#000000',\n        blanchedalmond: '#ffebcd',\n        blue: '#0000ff',\n        blueviolet: '#8a2be2',\n        brown: '#a52a2a',\n        burlywood: '#deb887',\n        cadetblue: '#5f9ea0',\n        chartreuse: '#7fff00',\n        chocolate: '#d2691e',\n        coral: '#ff7f50',\n        cornflower: '#6495ed',\n        cornflowerblue: '#6495ed',\n        cornsilk: '#fff8dc',\n        crimson: '#dc143c',\n        cyan: '#00ffff',\n        darkblue: '#00008b',\n        darkcyan: '#008b8b',\n        darkgoldenrod: '#b8860b',\n        darkgray: '#a9a9a9',\n        darkgreen: '#006400',\n        darkgrey: '#a9a9a9',\n        darkkhaki: '#bdb76b',\n        darkmagenta: '#8b008b',\n        darkolivegreen: '#556b2f',\n        darkorange: '#ff8c00',\n        darkorchid: '#9932cc',\n        darkred: '#8b0000',\n        darksalmon: '#e9967a',\n        darkseagreen: '#8fbc8f',\n        darkslateblue: '#483d8b',\n        darkslategray: '#2f4f4f',\n        darkslategrey: '#2f4f4f',\n        darkturquoise: '#00ced1',\n        darkviolet: '#9400d3',\n        deeppink: '#ff1493',\n        deepskyblue: '#00bfff',\n        dimgray: '#696969',\n        dimgrey: '#696969',\n        dodgerblue: '#1e90ff',\n        firebrick: '#b22222',\n        floralwhite: '#fffaf0',\n        forestgreen: '#228b22',\n        fuchsia: '#ff00ff',\n        gainsboro: '#dcdcdc',\n        ghostwhite: '#f8f8ff',\n        gold: '#ffd700',\n        goldenrod: '#daa520',\n        gray: '#808080',\n        green: '#008000',\n        greenyellow: '#adff2f',\n        grey: '#808080',\n        honeydew: '#f0fff0',\n        hotpink: '#ff69b4',\n        indianred: '#cd5c5c',\n        indigo: '#4b0082',\n        ivory: '#fffff0',\n        khaki: '#f0e68c',\n        laserlemon: '#ffff54',\n        lavender: '#e6e6fa',\n        lavenderblush: '#fff0f5',\n        lawngreen: '#7cfc00',\n        lemonchiffon: '#fffacd',\n        lightblue: '#add8e6',\n        lightcoral: '#f08080',\n        lightcyan: '#e0ffff',\n        lightgoldenrod: '#fafad2',\n        lightgoldenrodyellow: '#fafad2',\n        lightgray: '#d3d3d3',\n        lightgreen: '#90ee90',\n        lightgrey: '#d3d3d3',\n        lightpink: '#ffb6c1',\n        lightsalmon: '#ffa07a',\n        lightseagreen: '#20b2aa',\n        lightskyblue: '#87cefa',\n        lightslategray: '#778899',\n        lightslategrey: '#778899',\n        lightsteelblue: '#b0c4de',\n        lightyellow: '#ffffe0',\n        lime: '#00ff00',\n        limegreen: '#32cd32',\n        linen: '#faf0e6',\n        magenta: '#ff00ff',\n        maroon: '#800000',\n        maroon2: '#7f0000',\n        maroon3: '#b03060',\n        mediumaquamarine: '#66cdaa',\n        mediumblue: '#0000cd',\n        mediumorchid: '#ba55d3',\n        mediumpurple: '#9370db',\n        mediumseagreen: '#3cb371',\n        mediumslateblue: '#7b68ee',\n        mediumspringgreen: '#00fa9a',\n        mediumturquoise: '#48d1cc',\n        mediumvioletred: '#c71585',\n        midnightblue: '#191970',\n        mintcream: '#f5fffa',\n        mistyrose: '#ffe4e1',\n        moccasin: '#ffe4b5',\n        navajowhite: '#ffdead',\n        navy: '#000080',\n        oldlace: '#fdf5e6',\n        olive: '#808000',\n        olivedrab: '#6b8e23',\n        orange: '#ffa500',\n        orangered: '#ff4500',\n        orchid: '#da70d6',\n        palegoldenrod: '#eee8aa',\n        palegreen: '#98fb98',\n        paleturquoise: '#afeeee',\n        palevioletred: '#db7093',\n        papayawhip: '#ffefd5',\n        peachpuff: '#ffdab9',\n        peru: '#cd853f',\n        pink: '#ffc0cb',\n        plum: '#dda0dd',\n        powderblue: '#b0e0e6',\n        purple: '#800080',\n        purple2: '#7f007f',\n        purple3: '#a020f0',\n        rebeccapurple: '#663399',\n        red: '#ff0000',\n        rosybrown: '#bc8f8f',\n        royalblue: '#4169e1',\n        saddlebrown: '#8b4513',\n        salmon: '#fa8072',\n        sandybrown: '#f4a460',\n        seagreen: '#2e8b57',\n        seashell: '#fff5ee',\n        sienna: '#a0522d',\n        silver: '#c0c0c0',\n        skyblue: '#87ceeb',\n        slateblue: '#6a5acd',\n        slategray: '#708090',\n        slategrey: '#708090',\n        snow: '#fffafa',\n        springgreen: '#00ff7f',\n        steelblue: '#4682b4',\n        tan: '#d2b48c',\n        teal: '#008080',\n        thistle: '#d8bfd8',\n        tomato: '#ff6347',\n        turquoise: '#40e0d0',\n        violet: '#ee82ee',\n        wheat: '#f5deb3',\n        white: '#ffffff',\n        whitesmoke: '#f5f5f5',\n        yellow: '#ffff00',\n        yellowgreen: '#9acd32'\n    };\n\n    var w3cx11_1 = w3cx11;\n\n    var type$b = utils.type;\n\n\n\n\n\n    Color_1.prototype.name = function() {\n        var hex = rgb2hex_1(this._rgb, 'rgb');\n        for (var i = 0, list = Object.keys(w3cx11_1); i < list.length; i += 1) {\n            var n = list[i];\n\n            if (w3cx11_1[n] === hex) { return n.toLowerCase(); }\n        }\n        return hex;\n    };\n\n    input.format.named = function (name) {\n        name = name.toLowerCase();\n        if (w3cx11_1[name]) { return hex2rgb_1(w3cx11_1[name]); }\n        throw new Error('unknown color name: '+name);\n    };\n\n    input.autodetect.push({\n        p: 5,\n        test: function (h) {\n            var rest = [], len = arguments.length - 1;\n            while ( len-- > 0 ) rest[ len ] = arguments[ len + 1 ];\n\n            if (!rest.length && type$b(h) === 'string' && w3cx11_1[h.toLowerCase()]) {\n                return 'named';\n            }\n        }\n    });\n\n    var unpack$t = utils.unpack;\n\n    var rgb2num = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$t(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        return (r << 16) + (g << 8) + b;\n    };\n\n    var rgb2num_1 = rgb2num;\n\n    var type$c = utils.type;\n\n    var num2rgb = function (num) {\n        if (type$c(num) == \"number\" && num >= 0 && num <= 0xFFFFFF) {\n            var r = num >> 16;\n            var g = (num >> 8) & 0xFF;\n            var b = num & 0xFF;\n            return [r,g,b,1];\n        }\n        throw new Error(\"unknown num color: \"+num);\n    };\n\n    var num2rgb_1 = num2rgb;\n\n    var type$d = utils.type;\n\n\n\n    Color_1.prototype.num = function() {\n        return rgb2num_1(this._rgb);\n    };\n\n    chroma_1.num = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['num']) ));\n    };\n\n    input.format.num = num2rgb_1;\n\n    input.autodetect.push({\n        p: 5,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            if (args.length === 1 && type$d(args[0]) === 'number' && args[0] >= 0 && args[0] <= 0xFFFFFF) {\n                return 'num';\n            }\n        }\n    });\n\n    var unpack$u = utils.unpack;\n    var type$e = utils.type;\n    var round$5 = Math.round;\n\n    Color_1.prototype.rgb = function(rnd) {\n        if ( rnd === void 0 ) rnd=true;\n\n        if (rnd === false) { return this._rgb.slice(0,3); }\n        return this._rgb.slice(0,3).map(round$5);\n    };\n\n    Color_1.prototype.rgba = function(rnd) {\n        if ( rnd === void 0 ) rnd=true;\n\n        return this._rgb.slice(0,4).map(function (v,i) {\n            return i<3 ? (rnd === false ? v : round$5(v)) : v;\n        });\n    };\n\n    chroma_1.rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['rgb']) ));\n    };\n\n    input.format.rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgba = unpack$u(args, 'rgba');\n        if (rgba[3] === undefined) { rgba[3] = 1; }\n        return rgba;\n    };\n\n    input.autodetect.push({\n        p: 3,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$u(args, 'rgba');\n            if (type$e(args) === 'array' && (args.length === 3 ||\n                args.length === 4 && type$e(args[3]) == 'number' && args[3] >= 0 && args[3] <= 1)) {\n                return 'rgb';\n            }\n        }\n    });\n\n    /*\n     * Based on implementation by Neil Bartlett\n     * https://github.com/neilbartlett/color-temperature\n     */\n\n    var log = Math.log;\n\n    var temperature2rgb = function (kelvin) {\n        var temp = kelvin / 100;\n        var r,g,b;\n        if (temp < 66) {\n            r = 255;\n            g = -155.25485562709179 - 0.44596950469579133 * (g = temp-2) + 104.49216199393888 * log(g);\n            b = temp < 20 ? 0 : -254.76935184120902 + 0.8274096064007395 * (b = temp-10) + 115.67994401066147 * log(b);\n        } else {\n            r = 351.97690566805693 + 0.114206453784165 * (r = temp-55) - 40.25366309332127 * log(r);\n            g = 325.4494125711974 + 0.07943456536662342 * (g = temp-50) - 28.0852963507957 * log(g);\n            b = 255;\n        }\n        return [r,g,b,1];\n    };\n\n    var temperature2rgb_1 = temperature2rgb;\n\n    /*\n     * Based on implementation by Neil Bartlett\n     * https://github.com/neilbartlett/color-temperature\n     **/\n\n\n    var unpack$v = utils.unpack;\n    var round$6 = Math.round;\n\n    var rgb2temperature = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgb = unpack$v(args, 'rgb');\n        var r = rgb[0], b = rgb[2];\n        var minTemp = 1000;\n        var maxTemp = 40000;\n        var eps = 0.4;\n        var temp;\n        while (maxTemp - minTemp > eps) {\n            temp = (maxTemp + minTemp) * 0.5;\n            var rgb$1 = temperature2rgb_1(temp);\n            if ((rgb$1[2] / rgb$1[0]) >= (b / r)) {\n                maxTemp = temp;\n            } else {\n                minTemp = temp;\n            }\n        }\n        return round$6(temp);\n    };\n\n    var rgb2temperature_1 = rgb2temperature;\n\n    Color_1.prototype.temp =\n    Color_1.prototype.kelvin =\n    Color_1.prototype.temperature = function() {\n        return rgb2temperature_1(this._rgb);\n    };\n\n    chroma_1.temp =\n    chroma_1.kelvin =\n    chroma_1.temperature = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color_1, [ null ].concat( args, ['temp']) ));\n    };\n\n    input.format.temp =\n    input.format.kelvin =\n    input.format.temperature = temperature2rgb_1;\n\n    var type$f = utils.type;\n\n    Color_1.prototype.alpha = function(a, mutate) {\n        if ( mutate === void 0 ) mutate=false;\n\n        if (a !== undefined && type$f(a) === 'number') {\n            if (mutate) {\n                this._rgb[3] = a;\n                return this;\n            }\n            return new Color_1([this._rgb[0], this._rgb[1], this._rgb[2], a], 'rgb');\n        }\n        return this._rgb[3];\n    };\n\n    Color_1.prototype.clipped = function() {\n        return this._rgb._clipped || false;\n    };\n\n    Color_1.prototype.darken = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \tvar me = this;\n    \tvar lab = me.lab();\n    \tlab[0] -= labConstants.Kn * amount;\n    \treturn new Color_1(lab, 'lab').alpha(me.alpha(), true);\n    };\n\n    Color_1.prototype.brighten = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \treturn this.darken(-amount);\n    };\n\n    Color_1.prototype.darker = Color_1.prototype.darken;\n    Color_1.prototype.brighter = Color_1.prototype.brighten;\n\n    Color_1.prototype.get = function(mc) {\n        var ref = mc.split('.');\n        var mode = ref[0];\n        var channel = ref[1];\n        var src = this[mode]();\n        if (channel) {\n            var i = mode.indexOf(channel);\n            if (i > -1) { return src[i]; }\n            throw new Error((\"unknown channel \" + channel + \" in mode \" + mode));\n        } else {\n            return src;\n        }\n    };\n\n    var type$g = utils.type;\n    var pow$2 = Math.pow;\n\n    var EPS = 1e-7;\n    var MAX_ITER = 20;\n\n    Color_1.prototype.luminance = function(lum) {\n        if (lum !== undefined && type$g(lum) === 'number') {\n            if (lum === 0) {\n                // return pure black\n                return new Color_1([0,0,0,this._rgb[3]], 'rgb');\n            }\n            if (lum === 1) {\n                // return pure white\n                return new Color_1([255,255,255,this._rgb[3]], 'rgb');\n            }\n            // compute new color using...\n            var cur_lum = this.luminance();\n            var mode = 'rgb';\n            var max_iter = MAX_ITER;\n\n            var test = function (low, high) {\n                var mid = low.interpolate(high, 0.5, mode);\n                var lm = mid.luminance();\n                if (Math.abs(lum - lm) < EPS || !max_iter--) {\n                    // close enough\n                    return mid;\n                }\n                return lm > lum ? test(low, mid) : test(mid, high);\n            };\n\n            var rgb = (cur_lum > lum ? test(new Color_1([0,0,0]), this) : test(this, new Color_1([255,255,255]))).rgb();\n            return new Color_1(rgb.concat( [this._rgb[3]]));\n        }\n        return rgb2luminance.apply(void 0, (this._rgb).slice(0,3));\n    };\n\n\n    var rgb2luminance = function (r,g,b) {\n        // relative luminance\n        // see http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\n        r = luminance_x(r);\n        g = luminance_x(g);\n        b = luminance_x(b);\n        return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n    };\n\n    var luminance_x = function (x) {\n        x /= 255;\n        return x <= 0.03928 ? x/12.92 : pow$2((x+0.055)/1.055, 2.4);\n    };\n\n    var interpolator = {};\n\n    var type$h = utils.type;\n\n\n    var mix = function (col1, col2, f) {\n        if ( f === void 0 ) f=0.5;\n        var rest = [], len = arguments.length - 3;\n        while ( len-- > 0 ) rest[ len ] = arguments[ len + 3 ];\n\n        var mode = rest[0] || 'lrgb';\n        if (!interpolator[mode] && !rest.length) {\n            // fall back to the first supported mode\n            mode = Object.keys(interpolator)[0];\n        }\n        if (!interpolator[mode]) {\n            throw new Error((\"interpolation mode \" + mode + \" is not defined\"));\n        }\n        if (type$h(col1) !== 'object') { col1 = new Color_1(col1); }\n        if (type$h(col2) !== 'object') { col2 = new Color_1(col2); }\n        return interpolator[mode](col1, col2, f)\n            .alpha(col1.alpha() + f * (col2.alpha() - col1.alpha()));\n    };\n\n    Color_1.prototype.mix =\n    Color_1.prototype.interpolate = function(col2, f) {\n    \tif ( f === void 0 ) f=0.5;\n    \tvar rest = [], len = arguments.length - 2;\n    \twhile ( len-- > 0 ) rest[ len ] = arguments[ len + 2 ];\n\n    \treturn mix.apply(void 0, [ this, col2, f ].concat( rest ));\n    };\n\n    Color_1.prototype.premultiply = function(mutate) {\n    \tif ( mutate === void 0 ) mutate=false;\n\n    \tvar rgb = this._rgb;\n    \tvar a = rgb[3];\n    \tif (mutate) {\n    \t\tthis._rgb = [rgb[0]*a, rgb[1]*a, rgb[2]*a, a];\n    \t\treturn this;\n    \t} else {\n    \t\treturn new Color_1([rgb[0]*a, rgb[1]*a, rgb[2]*a, a], 'rgb');\n    \t}\n    };\n\n    Color_1.prototype.saturate = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \tvar me = this;\n    \tvar lch = me.lch();\n    \tlch[1] += labConstants.Kn * amount;\n    \tif (lch[1] < 0) { lch[1] = 0; }\n    \treturn new Color_1(lch, 'lch').alpha(me.alpha(), true);\n    };\n\n    Color_1.prototype.desaturate = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \treturn this.saturate(-amount);\n    };\n\n    var type$i = utils.type;\n\n    Color_1.prototype.set = function(mc, value, mutate) {\n        if ( mutate === void 0 ) mutate=false;\n\n        var ref = mc.split('.');\n        var mode = ref[0];\n        var channel = ref[1];\n        var src = this[mode]();\n        if (channel) {\n            var i = mode.indexOf(channel);\n            if (i > -1) {\n                if (type$i(value) == 'string') {\n                    switch(value.charAt(0)) {\n                        case '+': src[i] += +value; break;\n                        case '-': src[i] += +value; break;\n                        case '*': src[i] *= +(value.substr(1)); break;\n                        case '/': src[i] /= +(value.substr(1)); break;\n                        default: src[i] = +value;\n                    }\n                } else if (type$i(value) === 'number') {\n                    src[i] = value;\n                } else {\n                    throw new Error(\"unsupported value for Color.set\");\n                }\n                var out = new Color_1(src, mode);\n                if (mutate) {\n                    this._rgb = out._rgb;\n                    return this;\n                }\n                return out;\n            }\n            throw new Error((\"unknown channel \" + channel + \" in mode \" + mode));\n        } else {\n            return src;\n        }\n    };\n\n    var rgb$1 = function (col1, col2, f) {\n        var xyz0 = col1._rgb;\n        var xyz1 = col2._rgb;\n        return new Color_1(\n            xyz0[0] + f * (xyz1[0]-xyz0[0]),\n            xyz0[1] + f * (xyz1[1]-xyz0[1]),\n            xyz0[2] + f * (xyz1[2]-xyz0[2]),\n            'rgb'\n        )\n    };\n\n    // register interpolator\n    interpolator.rgb = rgb$1;\n\n    var sqrt$2 = Math.sqrt;\n    var pow$3 = Math.pow;\n\n    var lrgb = function (col1, col2, f) {\n        var ref = col1._rgb;\n        var x1 = ref[0];\n        var y1 = ref[1];\n        var z1 = ref[2];\n        var ref$1 = col2._rgb;\n        var x2 = ref$1[0];\n        var y2 = ref$1[1];\n        var z2 = ref$1[2];\n        return new Color_1(\n            sqrt$2(pow$3(x1,2) * (1-f) + pow$3(x2,2) * f),\n            sqrt$2(pow$3(y1,2) * (1-f) + pow$3(y2,2) * f),\n            sqrt$2(pow$3(z1,2) * (1-f) + pow$3(z2,2) * f),\n            'rgb'\n        )\n    };\n\n    // register interpolator\n    interpolator.lrgb = lrgb;\n\n    var lab$1 = function (col1, col2, f) {\n        var xyz0 = col1.lab();\n        var xyz1 = col2.lab();\n        return new Color_1(\n            xyz0[0] + f * (xyz1[0]-xyz0[0]),\n            xyz0[1] + f * (xyz1[1]-xyz0[1]),\n            xyz0[2] + f * (xyz1[2]-xyz0[2]),\n            'lab'\n        )\n    };\n\n    // register interpolator\n    interpolator.lab = lab$1;\n\n    var _hsx = function (col1, col2, f, m) {\n        var assign, assign$1;\n\n        var xyz0, xyz1;\n        if (m === 'hsl') {\n            xyz0 = col1.hsl();\n            xyz1 = col2.hsl();\n        } else if (m === 'hsv') {\n            xyz0 = col1.hsv();\n            xyz1 = col2.hsv();\n        } else if (m === 'hcg') {\n            xyz0 = col1.hcg();\n            xyz1 = col2.hcg();\n        } else if (m === 'hsi') {\n            xyz0 = col1.hsi();\n            xyz1 = col2.hsi();\n        } else if (m === 'lch' || m === 'hcl') {\n            m = 'hcl';\n            xyz0 = col1.hcl();\n            xyz1 = col2.hcl();\n        }\n\n        var hue0, hue1, sat0, sat1, lbv0, lbv1;\n        if (m.substr(0, 1) === 'h') {\n            (assign = xyz0, hue0 = assign[0], sat0 = assign[1], lbv0 = assign[2]);\n            (assign$1 = xyz1, hue1 = assign$1[0], sat1 = assign$1[1], lbv1 = assign$1[2]);\n        }\n\n        var sat, hue, lbv, dh;\n\n        if (!isNaN(hue0) && !isNaN(hue1)) {\n            // both colors have hue\n            if (hue1 > hue0 && hue1 - hue0 > 180) {\n                dh = hue1-(hue0+360);\n            } else if (hue1 < hue0 && hue0 - hue1 > 180) {\n                dh = hue1+360-hue0;\n            } else{\n                dh = hue1 - hue0;\n            }\n            hue = hue0 + f * dh;\n        } else if (!isNaN(hue0)) {\n            hue = hue0;\n            if ((lbv1 == 1 || lbv1 == 0) && m != 'hsv') { sat = sat0; }\n        } else if (!isNaN(hue1)) {\n            hue = hue1;\n            if ((lbv0 == 1 || lbv0 == 0) && m != 'hsv') { sat = sat1; }\n        } else {\n            hue = Number.NaN;\n        }\n\n        if (sat === undefined) { sat = sat0 + f * (sat1 - sat0); }\n        lbv = lbv0 + f * (lbv1-lbv0);\n        return new Color_1([hue, sat, lbv], m);\n    };\n\n    var lch$1 = function (col1, col2, f) {\n    \treturn _hsx(col1, col2, f, 'lch');\n    };\n\n    // register interpolator\n    interpolator.lch = lch$1;\n    interpolator.hcl = lch$1;\n\n    var num$1 = function (col1, col2, f) {\n        var c1 = col1.num();\n        var c2 = col2.num();\n        return new Color_1(c1 + f * (c2-c1), 'num')\n    };\n\n    // register interpolator\n    interpolator.num = num$1;\n\n    var hcg$1 = function (col1, col2, f) {\n    \treturn _hsx(col1, col2, f, 'hcg');\n    };\n\n    // register interpolator\n    interpolator.hcg = hcg$1;\n\n    var hsi$1 = function (col1, col2, f) {\n    \treturn _hsx(col1, col2, f, 'hsi');\n    };\n\n    // register interpolator\n    interpolator.hsi = hsi$1;\n\n    var hsl$1 = function (col1, col2, f) {\n    \treturn _hsx(col1, col2, f, 'hsl');\n    };\n\n    // register interpolator\n    interpolator.hsl = hsl$1;\n\n    var hsv$1 = function (col1, col2, f) {\n    \treturn _hsx(col1, col2, f, 'hsv');\n    };\n\n    // register interpolator\n    interpolator.hsv = hsv$1;\n\n    var clip_rgb$2 = utils.clip_rgb;\n    var pow$4 = Math.pow;\n    var sqrt$3 = Math.sqrt;\n    var PI$1 = Math.PI;\n    var cos$2 = Math.cos;\n    var sin$1 = Math.sin;\n    var atan2$1 = Math.atan2;\n\n    var average = function (colors, mode, weights) {\n        if ( mode === void 0 ) mode='lrgb';\n        if ( weights === void 0 ) weights=null;\n\n        var l = colors.length;\n        if (!weights) { weights = Array.from(new Array(l)).map(function () { return 1; }); }\n        // normalize weights\n        var k = l / weights.reduce(function(a, b) { return a + b; });\n        weights.forEach(function (w,i) { weights[i] *= k; });\n        // convert colors to Color objects\n        colors = colors.map(function (c) { return new Color_1(c); });\n        if (mode === 'lrgb') {\n            return _average_lrgb(colors, weights)\n        }\n        var first = colors.shift();\n        var xyz = first.get(mode);\n        var cnt = [];\n        var dx = 0;\n        var dy = 0;\n        // initial color\n        for (var i=0; i<xyz.length; i++) {\n            xyz[i] = (xyz[i] || 0) * weights[0];\n            cnt.push(isNaN(xyz[i]) ? 0 : weights[0]);\n            if (mode.charAt(i) === 'h' && !isNaN(xyz[i])) {\n                var A = xyz[i] / 180 * PI$1;\n                dx += cos$2(A) * weights[0];\n                dy += sin$1(A) * weights[0];\n            }\n        }\n\n        var alpha = first.alpha() * weights[0];\n        colors.forEach(function (c,ci) {\n            var xyz2 = c.get(mode);\n            alpha += c.alpha() * weights[ci+1];\n            for (var i=0; i<xyz.length; i++) {\n                if (!isNaN(xyz2[i])) {\n                    cnt[i] += weights[ci+1];\n                    if (mode.charAt(i) === 'h') {\n                        var A = xyz2[i] / 180 * PI$1;\n                        dx += cos$2(A) * weights[ci+1];\n                        dy += sin$1(A) * weights[ci+1];\n                    } else {\n                        xyz[i] += xyz2[i] * weights[ci+1];\n                    }\n                }\n            }\n        });\n\n        for (var i$1=0; i$1<xyz.length; i$1++) {\n            if (mode.charAt(i$1) === 'h') {\n                var A$1 = atan2$1(dy / cnt[i$1], dx / cnt[i$1]) / PI$1 * 180;\n                while (A$1 < 0) { A$1 += 360; }\n                while (A$1 >= 360) { A$1 -= 360; }\n                xyz[i$1] = A$1;\n            } else {\n                xyz[i$1] = xyz[i$1]/cnt[i$1];\n            }\n        }\n        alpha /= l;\n        return (new Color_1(xyz, mode)).alpha(alpha > 0.99999 ? 1 : alpha, true);\n    };\n\n\n    var _average_lrgb = function (colors, weights) {\n        var l = colors.length;\n        var xyz = [0,0,0,0];\n        for (var i=0; i < colors.length; i++) {\n            var col = colors[i];\n            var f = weights[i] / l;\n            var rgb = col._rgb;\n            xyz[0] += pow$4(rgb[0],2) * f;\n            xyz[1] += pow$4(rgb[1],2) * f;\n            xyz[2] += pow$4(rgb[2],2) * f;\n            xyz[3] += rgb[3] * f;\n        }\n        xyz[0] = sqrt$3(xyz[0]);\n        xyz[1] = sqrt$3(xyz[1]);\n        xyz[2] = sqrt$3(xyz[2]);\n        if (xyz[3] > 0.9999999) { xyz[3] = 1; }\n        return new Color_1(clip_rgb$2(xyz));\n    };\n\n    // minimal multi-purpose interface\n\n    // @requires utils color analyze\n\n\n    var type$j = utils.type;\n\n    var pow$5 = Math.pow;\n\n    var scale = function(colors) {\n\n        // constructor\n        var _mode = 'rgb';\n        var _nacol = chroma_1('#ccc');\n        var _spread = 0;\n        // const _fixed = false;\n        var _domain = [0, 1];\n        var _pos = [];\n        var _padding = [0,0];\n        var _classes = false;\n        var _colors = [];\n        var _out = false;\n        var _min = 0;\n        var _max = 1;\n        var _correctLightness = false;\n        var _colorCache = {};\n        var _useCache = true;\n        var _gamma = 1;\n\n        // private methods\n\n        var setColors = function(colors) {\n            colors = colors || ['#fff', '#000'];\n            if (colors && type$j(colors) === 'string' && chroma_1.brewer &&\n                chroma_1.brewer[colors.toLowerCase()]) {\n                colors = chroma_1.brewer[colors.toLowerCase()];\n            }\n            if (type$j(colors) === 'array') {\n                // handle single color\n                if (colors.length === 1) {\n                    colors = [colors[0], colors[0]];\n                }\n                // make a copy of the colors\n                colors = colors.slice(0);\n                // convert to chroma classes\n                for (var c=0; c<colors.length; c++) {\n                    colors[c] = chroma_1(colors[c]);\n                }\n                // auto-fill color position\n                _pos.length = 0;\n                for (var c$1=0; c$1<colors.length; c$1++) {\n                    _pos.push(c$1/(colors.length-1));\n                }\n            }\n            resetCache();\n            return _colors = colors;\n        };\n\n        var getClass = function(value) {\n            if (_classes != null) {\n                var n = _classes.length-1;\n                var i = 0;\n                while (i < n && value >= _classes[i]) {\n                    i++;\n                }\n                return i-1;\n            }\n            return 0;\n        };\n\n        var tMapLightness = function (t) { return t; };\n        var tMapDomain = function (t) { return t; };\n\n        // const classifyValue = function(value) {\n        //     let val = value;\n        //     if (_classes.length > 2) {\n        //         const n = _classes.length-1;\n        //         const i = getClass(value);\n        //         const minc = _classes[0] + ((_classes[1]-_classes[0]) * (0 + (_spread * 0.5)));  // center of 1st class\n        //         const maxc = _classes[n-1] + ((_classes[n]-_classes[n-1]) * (1 - (_spread * 0.5)));  // center of last class\n        //         val = _min + ((((_classes[i] + ((_classes[i+1] - _classes[i]) * 0.5)) - minc) / (maxc-minc)) * (_max - _min));\n        //     }\n        //     return val;\n        // };\n\n        var getColor = function(val, bypassMap) {\n            var col, t;\n            if (bypassMap == null) { bypassMap = false; }\n            if (isNaN(val) || (val === null)) { return _nacol; }\n            if (!bypassMap) {\n                if (_classes && (_classes.length > 2)) {\n                    // find the class\n                    var c = getClass(val);\n                    t = c / (_classes.length-2);\n                } else if (_max !== _min) {\n                    // just interpolate between min/max\n                    t = (val - _min) / (_max - _min);\n                } else {\n                    t = 1;\n                }\n            } else {\n                t = val;\n            }\n\n            // domain map\n            t = tMapDomain(t);\n\n            if (!bypassMap) {\n                t = tMapLightness(t);  // lightness correction\n            }\n\n            if (_gamma !== 1) { t = pow$5(t, _gamma); }\n\n            t = _padding[0] + (t * (1 - _padding[0] - _padding[1]));\n\n            t = Math.min(1, Math.max(0, t));\n\n            var k = Math.floor(t * 10000);\n\n            if (_useCache && _colorCache[k]) {\n                col = _colorCache[k];\n            } else {\n                if (type$j(_colors) === 'array') {\n                    //for i in [0.._pos.length-1]\n                    for (var i=0; i<_pos.length; i++) {\n                        var p = _pos[i];\n                        if (t <= p) {\n                            col = _colors[i];\n                            break;\n                        }\n                        if ((t >= p) && (i === (_pos.length-1))) {\n                            col = _colors[i];\n                            break;\n                        }\n                        if (t > p && t < _pos[i+1]) {\n                            t = (t-p)/(_pos[i+1]-p);\n                            col = chroma_1.interpolate(_colors[i], _colors[i+1], t, _mode);\n                            break;\n                        }\n                    }\n                } else if (type$j(_colors) === 'function') {\n                    col = _colors(t);\n                }\n                if (_useCache) { _colorCache[k] = col; }\n            }\n            return col;\n        };\n\n        var resetCache = function () { return _colorCache = {}; };\n\n        setColors(colors);\n\n        // public interface\n\n        var f = function(v) {\n            var c = chroma_1(getColor(v));\n            if (_out && c[_out]) { return c[_out](); } else { return c; }\n        };\n\n        f.classes = function(classes) {\n            if (classes != null) {\n                if (type$j(classes) === 'array') {\n                    _classes = classes;\n                    _domain = [classes[0], classes[classes.length-1]];\n                } else {\n                    var d = chroma_1.analyze(_domain);\n                    if (classes === 0) {\n                        _classes = [d.min, d.max];\n                    } else {\n                        _classes = chroma_1.limits(d, 'e', classes);\n                    }\n                }\n                return f;\n            }\n            return _classes;\n        };\n\n\n        f.domain = function(domain) {\n            if (!arguments.length) {\n                return _domain;\n            }\n            _min = domain[0];\n            _max = domain[domain.length-1];\n            _pos = [];\n            var k = _colors.length;\n            if ((domain.length === k) && (_min !== _max)) {\n                // update positions\n                for (var i = 0, list = Array.from(domain); i < list.length; i += 1) {\n                    var d = list[i];\n\n                  _pos.push((d-_min) / (_max-_min));\n                }\n            } else {\n                for (var c=0; c<k; c++) {\n                    _pos.push(c/(k-1));\n                }\n                if (domain.length > 2) {\n                    // set domain map\n                    var tOut = domain.map(function (d,i) { return i/(domain.length-1); });\n                    var tBreaks = domain.map(function (d) { return (d - _min) / (_max - _min); });\n                    if (!tBreaks.every(function (val, i) { return tOut[i] === val; })) {\n                        tMapDomain = function (t) {\n                            if (t <= 0 || t >= 1) { return t; }\n                            var i = 0;\n                            while (t >= tBreaks[i+1]) { i++; }\n                            var f = (t - tBreaks[i]) / (tBreaks[i+1] - tBreaks[i]);\n                            var out = tOut[i] + f * (tOut[i+1] - tOut[i]);\n                            return out;\n                        };\n                    }\n\n                }\n            }\n            _domain = [_min, _max];\n            return f;\n        };\n\n        f.mode = function(_m) {\n            if (!arguments.length) {\n                return _mode;\n            }\n            _mode = _m;\n            resetCache();\n            return f;\n        };\n\n        f.range = function(colors, _pos) {\n            setColors(colors, _pos);\n            return f;\n        };\n\n        f.out = function(_o) {\n            _out = _o;\n            return f;\n        };\n\n        f.spread = function(val) {\n            if (!arguments.length) {\n                return _spread;\n            }\n            _spread = val;\n            return f;\n        };\n\n        f.correctLightness = function(v) {\n            if (v == null) { v = true; }\n            _correctLightness = v;\n            resetCache();\n            if (_correctLightness) {\n                tMapLightness = function(t) {\n                    var L0 = getColor(0, true).lab()[0];\n                    var L1 = getColor(1, true).lab()[0];\n                    var pol = L0 > L1;\n                    var L_actual = getColor(t, true).lab()[0];\n                    var L_ideal = L0 + ((L1 - L0) * t);\n                    var L_diff = L_actual - L_ideal;\n                    var t0 = 0;\n                    var t1 = 1;\n                    var max_iter = 20;\n                    while ((Math.abs(L_diff) > 1e-2) && (max_iter-- > 0)) {\n                        (function() {\n                            if (pol) { L_diff *= -1; }\n                            if (L_diff < 0) {\n                                t0 = t;\n                                t += (t1 - t) * 0.5;\n                            } else {\n                                t1 = t;\n                                t += (t0 - t) * 0.5;\n                            }\n                            L_actual = getColor(t, true).lab()[0];\n                            return L_diff = L_actual - L_ideal;\n                        })();\n                    }\n                    return t;\n                };\n            } else {\n                tMapLightness = function (t) { return t; };\n            }\n            return f;\n        };\n\n        f.padding = function(p) {\n            if (p != null) {\n                if (type$j(p) === 'number') {\n                    p = [p,p];\n                }\n                _padding = p;\n                return f;\n            } else {\n                return _padding;\n            }\n        };\n\n        f.colors = function(numColors, out) {\n            // If no arguments are given, return the original colors that were provided\n            if (arguments.length < 2) { out = 'hex'; }\n            var result = [];\n\n            if (arguments.length === 0) {\n                result = _colors.slice(0);\n\n            } else if (numColors === 1) {\n                result = [f(0.5)];\n\n            } else if (numColors > 1) {\n                var dm = _domain[0];\n                var dd = _domain[1] - dm;\n                result = __range__(0, numColors, false).map(function (i) { return f( dm + ((i/(numColors-1)) * dd) ); });\n\n            } else { // returns all colors based on the defined classes\n                colors = [];\n                var samples = [];\n                if (_classes && (_classes.length > 2)) {\n                    for (var i = 1, end = _classes.length, asc = 1 <= end; asc ? i < end : i > end; asc ? i++ : i--) {\n                        samples.push((_classes[i-1]+_classes[i])*0.5);\n                    }\n                } else {\n                    samples = _domain;\n                }\n                result = samples.map(function (v) { return f(v); });\n            }\n\n            if (chroma_1[out]) {\n                result = result.map(function (c) { return c[out](); });\n            }\n            return result;\n        };\n\n        f.cache = function(c) {\n            if (c != null) {\n                _useCache = c;\n                return f;\n            } else {\n                return _useCache;\n            }\n        };\n\n        f.gamma = function(g) {\n            if (g != null) {\n                _gamma = g;\n                return f;\n            } else {\n                return _gamma;\n            }\n        };\n\n        f.nodata = function(d) {\n            if (d != null) {\n                _nacol = chroma_1(d);\n                return f;\n            } else {\n                return _nacol;\n            }\n        };\n\n        return f;\n    };\n\n    function __range__(left, right, inclusive) {\n      var range = [];\n      var ascending = left < right;\n      var end = !inclusive ? right : ascending ? right + 1 : right - 1;\n      for (var i = left; ascending ? i < end : i > end; ascending ? i++ : i--) {\n        range.push(i);\n      }\n      return range;\n    }\n\n    //\n    // interpolates between a set of colors uzing a bezier spline\n    //\n\n    // @requires utils lab\n\n\n\n\n    var bezier = function(colors) {\n        var assign, assign$1, assign$2;\n\n        var I, lab0, lab1, lab2;\n        colors = colors.map(function (c) { return new Color_1(c); });\n        if (colors.length === 2) {\n            // linear interpolation\n            (assign = colors.map(function (c) { return c.lab(); }), lab0 = assign[0], lab1 = assign[1]);\n            I = function(t) {\n                var lab = ([0, 1, 2].map(function (i) { return lab0[i] + (t * (lab1[i] - lab0[i])); }));\n                return new Color_1(lab, 'lab');\n            };\n        } else if (colors.length === 3) {\n            // quadratic bezier interpolation\n            (assign$1 = colors.map(function (c) { return c.lab(); }), lab0 = assign$1[0], lab1 = assign$1[1], lab2 = assign$1[2]);\n            I = function(t) {\n                var lab = ([0, 1, 2].map(function (i) { return ((1-t)*(1-t) * lab0[i]) + (2 * (1-t) * t * lab1[i]) + (t * t * lab2[i]); }));\n                return new Color_1(lab, 'lab');\n            };\n        } else if (colors.length === 4) {\n            // cubic bezier interpolation\n            var lab3;\n            (assign$2 = colors.map(function (c) { return c.lab(); }), lab0 = assign$2[0], lab1 = assign$2[1], lab2 = assign$2[2], lab3 = assign$2[3]);\n            I = function(t) {\n                var lab = ([0, 1, 2].map(function (i) { return ((1-t)*(1-t)*(1-t) * lab0[i]) + (3 * (1-t) * (1-t) * t * lab1[i]) + (3 * (1-t) * t * t * lab2[i]) + (t*t*t * lab3[i]); }));\n                return new Color_1(lab, 'lab');\n            };\n        } else if (colors.length === 5) {\n            var I0 = bezier(colors.slice(0, 3));\n            var I1 = bezier(colors.slice(2, 5));\n            I = function(t) {\n                if (t < 0.5) {\n                    return I0(t*2);\n                } else {\n                    return I1((t-0.5)*2);\n                }\n            };\n        }\n        return I;\n    };\n\n    var bezier_1 = function (colors) {\n        var f = bezier(colors);\n        f.scale = function () { return scale(f); };\n        return f;\n    };\n\n    /*\n     * interpolates between a set of colors uzing a bezier spline\n     * blend mode formulas taken from http://www.venture-ware.com/kevin/coding/lets-learn-math-photoshop-blend-modes/\n     */\n\n\n\n\n    var blend = function (bottom, top, mode) {\n        if (!blend[mode]) {\n            throw new Error('unknown blend mode ' + mode);\n        }\n        return blend[mode](bottom, top);\n    };\n\n    var blend_f = function (f) { return function (bottom,top) {\n            var c0 = chroma_1(top).rgb();\n            var c1 = chroma_1(bottom).rgb();\n            return chroma_1.rgb(f(c0, c1));\n        }; };\n\n    var each = function (f) { return function (c0, c1) {\n            var out = [];\n            out[0] = f(c0[0], c1[0]);\n            out[1] = f(c0[1], c1[1]);\n            out[2] = f(c0[2], c1[2]);\n            return out;\n        }; };\n\n    var normal = function (a) { return a; };\n    var multiply = function (a,b) { return a * b / 255; };\n    var darken$1 = function (a,b) { return a > b ? b : a; };\n    var lighten = function (a,b) { return a > b ? a : b; };\n    var screen = function (a,b) { return 255 * (1 - (1-a/255) * (1-b/255)); };\n    var overlay = function (a,b) { return b < 128 ? 2 * a * b / 255 : 255 * (1 - 2 * (1 - a / 255 ) * ( 1 - b / 255 )); };\n    var burn = function (a,b) { return 255 * (1 - (1 - b / 255) / (a/255)); };\n    var dodge = function (a,b) {\n        if (a === 255) { return 255; }\n        a = 255 * (b / 255) / (1 - a / 255);\n        return a > 255 ? 255 : a\n    };\n\n    // # add = (a,b) ->\n    // #     if (a + b > 255) then 255 else a + b\n\n    blend.normal = blend_f(each(normal));\n    blend.multiply = blend_f(each(multiply));\n    blend.screen = blend_f(each(screen));\n    blend.overlay = blend_f(each(overlay));\n    blend.darken = blend_f(each(darken$1));\n    blend.lighten = blend_f(each(lighten));\n    blend.dodge = blend_f(each(dodge));\n    blend.burn = blend_f(each(burn));\n    // blend.add = blend_f(each(add));\n\n    var blend_1 = blend;\n\n    // cubehelix interpolation\n    // based on D.A. Green \"A colour scheme for the display of astronomical intensity images\"\n    // http://astron-soc.in/bulletin/11June/289392011.pdf\n\n    var type$k = utils.type;\n    var clip_rgb$3 = utils.clip_rgb;\n    var TWOPI$2 = utils.TWOPI;\n    var pow$6 = Math.pow;\n    var sin$2 = Math.sin;\n    var cos$3 = Math.cos;\n\n\n    var cubehelix = function(start, rotations, hue, gamma, lightness) {\n        if ( start === void 0 ) start=300;\n        if ( rotations === void 0 ) rotations=-1.5;\n        if ( hue === void 0 ) hue=1;\n        if ( gamma === void 0 ) gamma=1;\n        if ( lightness === void 0 ) lightness=[0,1];\n\n        var dh = 0, dl;\n        if (type$k(lightness) === 'array') {\n            dl = lightness[1] - lightness[0];\n        } else {\n            dl = 0;\n            lightness = [lightness, lightness];\n        }\n\n        var f = function(fract) {\n            var a = TWOPI$2 * (((start+120)/360) + (rotations * fract));\n            var l = pow$6(lightness[0] + (dl * fract), gamma);\n            var h = dh !== 0 ? hue[0] + (fract * dh) : hue;\n            var amp = (h * l * (1-l)) / 2;\n            var cos_a = cos$3(a);\n            var sin_a = sin$2(a);\n            var r = l + (amp * ((-0.14861 * cos_a) + (1.78277* sin_a)));\n            var g = l + (amp * ((-0.29227 * cos_a) - (0.90649* sin_a)));\n            var b = l + (amp * (+1.97294 * cos_a));\n            return chroma_1(clip_rgb$3([r*255,g*255,b*255,1]));\n        };\n\n        f.start = function(s) {\n            if ((s == null)) { return start; }\n            start = s;\n            return f;\n        };\n\n        f.rotations = function(r) {\n            if ((r == null)) { return rotations; }\n            rotations = r;\n            return f;\n        };\n\n        f.gamma = function(g) {\n            if ((g == null)) { return gamma; }\n            gamma = g;\n            return f;\n        };\n\n        f.hue = function(h) {\n            if ((h == null)) { return hue; }\n            hue = h;\n            if (type$k(hue) === 'array') {\n                dh = hue[1] - hue[0];\n                if (dh === 0) { hue = hue[1]; }\n            } else {\n                dh = 0;\n            }\n            return f;\n        };\n\n        f.lightness = function(h) {\n            if ((h == null)) { return lightness; }\n            if (type$k(h) === 'array') {\n                lightness = h;\n                dl = h[1] - h[0];\n            } else {\n                lightness = [h,h];\n                dl = 0;\n            }\n            return f;\n        };\n\n        f.scale = function () { return chroma_1.scale(f); };\n\n        f.hue(hue);\n\n        return f;\n    };\n\n    var digits = '0123456789abcdef';\n\n    var floor$2 = Math.floor;\n    var random = Math.random;\n\n    var random_1 = function () {\n        var code = '#';\n        for (var i=0; i<6; i++) {\n            code += digits.charAt(floor$2(random() * 16));\n        }\n        return new Color_1(code, 'hex');\n    };\n\n    var log$1 = Math.log;\n    var pow$7 = Math.pow;\n    var floor$3 = Math.floor;\n    var abs = Math.abs;\n\n\n    var analyze = function (data, key) {\n        if ( key === void 0 ) key=null;\n\n        var r = {\n            min: Number.MAX_VALUE,\n            max: Number.MAX_VALUE*-1,\n            sum: 0,\n            values: [],\n            count: 0\n        };\n        if (type(data) === 'object') {\n            data = Object.values(data);\n        }\n        data.forEach(function (val) {\n            if (key && type(val) === 'object') { val = val[key]; }\n            if (val !== undefined && val !== null && !isNaN(val)) {\n                r.values.push(val);\n                r.sum += val;\n                if (val < r.min) { r.min = val; }\n                if (val > r.max) { r.max = val; }\n                r.count += 1;\n            }\n        });\n\n        r.domain = [r.min, r.max];\n\n        r.limits = function (mode, num) { return limits(r, mode, num); };\n\n        return r;\n    };\n\n\n    var limits = function (data, mode, num) {\n        if ( mode === void 0 ) mode='equal';\n        if ( num === void 0 ) num=7;\n\n        if (type(data) == 'array') {\n            data = analyze(data);\n        }\n        var min = data.min;\n        var max = data.max;\n        var values = data.values.sort(function (a,b) { return a-b; });\n\n        if (num === 1) { return [min,max]; }\n\n        var limits = [];\n\n        if (mode.substr(0,1) === 'c') { // continuous\n            limits.push(min);\n            limits.push(max);\n        }\n\n        if (mode.substr(0,1) === 'e') { // equal interval\n            limits.push(min);\n            for (var i=1; i<num; i++) {\n                limits.push(min+((i/num)*(max-min)));\n            }\n            limits.push(max);\n        }\n\n        else if (mode.substr(0,1) === 'l') { // log scale\n            if (min <= 0) {\n                throw new Error('Logarithmic scales are only possible for values > 0');\n            }\n            var min_log = Math.LOG10E * log$1(min);\n            var max_log = Math.LOG10E * log$1(max);\n            limits.push(min);\n            for (var i$1=1; i$1<num; i$1++) {\n                limits.push(pow$7(10, min_log + ((i$1/num) * (max_log - min_log))));\n            }\n            limits.push(max);\n        }\n\n        else if (mode.substr(0,1) === 'q') { // quantile scale\n            limits.push(min);\n            for (var i$2=1; i$2<num; i$2++) {\n                var p = ((values.length-1) * i$2)/num;\n                var pb = floor$3(p);\n                if (pb === p) {\n                    limits.push(values[pb]);\n                } else { // p > pb\n                    var pr = p - pb;\n                    limits.push((values[pb]*(1-pr)) + (values[pb+1]*pr));\n                }\n            }\n            limits.push(max);\n\n        }\n\n        else if (mode.substr(0,1) === 'k') { // k-means clustering\n            /*\n            implementation based on\n            http://code.google.com/p/figue/source/browse/trunk/figue.js#336\n            simplified for 1-d input values\n            */\n            var cluster;\n            var n = values.length;\n            var assignments = new Array(n);\n            var clusterSizes = new Array(num);\n            var repeat = true;\n            var nb_iters = 0;\n            var centroids = null;\n\n            // get seed values\n            centroids = [];\n            centroids.push(min);\n            for (var i$3=1; i$3<num; i$3++) {\n                centroids.push(min + ((i$3/num) * (max-min)));\n            }\n            centroids.push(max);\n\n            while (repeat) {\n                // assignment step\n                for (var j=0; j<num; j++) {\n                    clusterSizes[j] = 0;\n                }\n                for (var i$4=0; i$4<n; i$4++) {\n                    var value = values[i$4];\n                    var mindist = Number.MAX_VALUE;\n                    var best = (void 0);\n                    for (var j$1=0; j$1<num; j$1++) {\n                        var dist = abs(centroids[j$1]-value);\n                        if (dist < mindist) {\n                            mindist = dist;\n                            best = j$1;\n                        }\n                        clusterSizes[best]++;\n                        assignments[i$4] = best;\n                    }\n                }\n\n                // update centroids step\n                var newCentroids = new Array(num);\n                for (var j$2=0; j$2<num; j$2++) {\n                    newCentroids[j$2] = null;\n                }\n                for (var i$5=0; i$5<n; i$5++) {\n                    cluster = assignments[i$5];\n                    if (newCentroids[cluster] === null) {\n                        newCentroids[cluster] = values[i$5];\n                    } else {\n                        newCentroids[cluster] += values[i$5];\n                    }\n                }\n                for (var j$3=0; j$3<num; j$3++) {\n                    newCentroids[j$3] *= 1/clusterSizes[j$3];\n                }\n\n                // check convergence\n                repeat = false;\n                for (var j$4=0; j$4<num; j$4++) {\n                    if (newCentroids[j$4] !== centroids[j$4]) {\n                        repeat = true;\n                        break;\n                    }\n                }\n\n                centroids = newCentroids;\n                nb_iters++;\n\n                if (nb_iters > 200) {\n                    repeat = false;\n                }\n            }\n\n            // finished k-means clustering\n            // the next part is borrowed from gabrielflor.it\n            var kClusters = {};\n            for (var j$5=0; j$5<num; j$5++) {\n                kClusters[j$5] = [];\n            }\n            for (var i$6=0; i$6<n; i$6++) {\n                cluster = assignments[i$6];\n                kClusters[cluster].push(values[i$6]);\n            }\n            var tmpKMeansBreaks = [];\n            for (var j$6=0; j$6<num; j$6++) {\n                tmpKMeansBreaks.push(kClusters[j$6][0]);\n                tmpKMeansBreaks.push(kClusters[j$6][kClusters[j$6].length-1]);\n            }\n            tmpKMeansBreaks = tmpKMeansBreaks.sort(function (a,b){ return a-b; });\n            limits.push(tmpKMeansBreaks[0]);\n            for (var i$7=1; i$7 < tmpKMeansBreaks.length; i$7+= 2) {\n                var v = tmpKMeansBreaks[i$7];\n                if (!isNaN(v) && (limits.indexOf(v) === -1)) {\n                    limits.push(v);\n                }\n            }\n        }\n        return limits;\n    };\n\n    var analyze_1 = {analyze: analyze, limits: limits};\n\n    var contrast = function (a, b) {\n        // WCAG contrast ratio\n        // see http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef\n        a = new Color_1(a);\n        b = new Color_1(b);\n        var l1 = a.luminance();\n        var l2 = b.luminance();\n        return l1 > l2 ? (l1 + 0.05) / (l2 + 0.05) : (l2 + 0.05) / (l1 + 0.05);\n    };\n\n    var sqrt$4 = Math.sqrt;\n    var atan2$2 = Math.atan2;\n    var abs$1 = Math.abs;\n    var cos$4 = Math.cos;\n    var PI$2 = Math.PI;\n\n    var deltaE = function(a, b, L, C) {\n        if ( L === void 0 ) L=1;\n        if ( C === void 0 ) C=1;\n\n        // Delta E (CMC)\n        // see http://www.brucelindbloom.com/index.html?Eqn_DeltaE_CMC.html\n        a = new Color_1(a);\n        b = new Color_1(b);\n        var ref = Array.from(a.lab());\n        var L1 = ref[0];\n        var a1 = ref[1];\n        var b1 = ref[2];\n        var ref$1 = Array.from(b.lab());\n        var L2 = ref$1[0];\n        var a2 = ref$1[1];\n        var b2 = ref$1[2];\n        var c1 = sqrt$4((a1 * a1) + (b1 * b1));\n        var c2 = sqrt$4((a2 * a2) + (b2 * b2));\n        var sl = L1 < 16.0 ? 0.511 : (0.040975 * L1) / (1.0 + (0.01765 * L1));\n        var sc = ((0.0638 * c1) / (1.0 + (0.0131 * c1))) + 0.638;\n        var h1 = c1 < 0.000001 ? 0.0 : (atan2$2(b1, a1) * 180.0) / PI$2;\n        while (h1 < 0) { h1 += 360; }\n        while (h1 >= 360) { h1 -= 360; }\n        var t = (h1 >= 164.0) && (h1 <= 345.0) ? (0.56 + abs$1(0.2 * cos$4((PI$2 * (h1 + 168.0)) / 180.0))) : (0.36 + abs$1(0.4 * cos$4((PI$2 * (h1 + 35.0)) / 180.0)));\n        var c4 = c1 * c1 * c1 * c1;\n        var f = sqrt$4(c4 / (c4 + 1900.0));\n        var sh = sc * (((f * t) + 1.0) - f);\n        var delL = L1 - L2;\n        var delC = c1 - c2;\n        var delA = a1 - a2;\n        var delB = b1 - b2;\n        var dH2 = ((delA * delA) + (delB * delB)) - (delC * delC);\n        var v1 = delL / (L * sl);\n        var v2 = delC / (C * sc);\n        var v3 = sh;\n        return sqrt$4((v1 * v1) + (v2 * v2) + (dH2 / (v3 * v3)));\n    };\n\n    // simple Euclidean distance\n    var distance = function(a, b, mode) {\n        if ( mode === void 0 ) mode='lab';\n\n        // Delta E (CIE 1976)\n        // see http://www.brucelindbloom.com/index.html?Equations.html\n        a = new Color_1(a);\n        b = new Color_1(b);\n        var l1 = a.get(mode);\n        var l2 = b.get(mode);\n        var sum_sq = 0;\n        for (var i in l1) {\n            var d = (l1[i] || 0) - (l2[i] || 0);\n            sum_sq += d*d;\n        }\n        return Math.sqrt(sum_sq);\n    };\n\n    var valid = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        try {\n            new (Function.prototype.bind.apply( Color_1, [ null ].concat( args) ));\n            return true;\n        } catch (e) {\n            return false;\n        }\n    };\n\n    // some pre-defined color scales:\n\n\n\n\n    var scales = {\n    \tcool: function cool() { return scale([chroma_1.hsl(180,1,.9), chroma_1.hsl(250,.7,.4)]) },\n    \thot: function hot() { return scale(['#000','#f00','#ff0','#fff'], [0,.25,.75,1]).mode('rgb') }\n    };\n\n    /**\n        ColorBrewer colors for chroma.js\n\n        Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The\n        Pennsylvania State University.\n\n        Licensed under the Apache License, Version 2.0 (the \"License\");\n        you may not use this file except in compliance with the License.\n        You may obtain a copy of the License at\n        http://www.apache.org/licenses/LICENSE-2.0\n\n        Unless required by applicable law or agreed to in writing, software distributed\n        under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n        CONDITIONS OF ANY KIND, either express or implied. See the License for the\n        specific language governing permissions and limitations under the License.\n    */\n\n    var colorbrewer = {\n        // sequential\n        OrRd: ['#fff7ec', '#fee8c8', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#b30000', '#7f0000'],\n        PuBu: ['#fff7fb', '#ece7f2', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#045a8d', '#023858'],\n        BuPu: ['#f7fcfd', '#e0ecf4', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#810f7c', '#4d004b'],\n        Oranges: ['#fff5eb', '#fee6ce', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#a63603', '#7f2704'],\n        BuGn: ['#f7fcfd', '#e5f5f9', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b'],\n        YlOrBr: ['#ffffe5', '#fff7bc', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#993404', '#662506'],\n        YlGn: ['#ffffe5', '#f7fcb9', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#006837', '#004529'],\n        Reds: ['#fff5f0', '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#a50f15', '#67000d'],\n        RdPu: ['#fff7f3', '#fde0dd', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177', '#49006a'],\n        Greens: ['#f7fcf5', '#e5f5e0', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#006d2c', '#00441b'],\n        YlGnBu: ['#ffffd9', '#edf8b1', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#253494', '#081d58'],\n        Purples: ['#fcfbfd', '#efedf5', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#54278f', '#3f007d'],\n        GnBu: ['#f7fcf0', '#e0f3db', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#0868ac', '#084081'],\n        Greys: ['#ffffff', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525', '#000000'],\n        YlOrRd: ['#ffffcc', '#ffeda0', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#bd0026', '#800026'],\n        PuRd: ['#f7f4f9', '#e7e1ef', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#980043', '#67001f'],\n        Blues: ['#f7fbff', '#deebf7', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#08519c', '#08306b'],\n        PuBuGn: ['#fff7fb', '#ece2f0', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016c59', '#014636'],\n        Viridis: ['#440154', '#482777', '#3f4a8a', '#31678e', '#26838f', '#1f9d8a', '#6cce5a', '#b6de2b', '#fee825'],\n\n        // diverging\n\n        Spectral: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#e6f598', '#abdda4', '#66c2a5', '#3288bd', '#5e4fa2'],\n        RdYlGn: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850', '#006837'],\n        RdBu: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#f7f7f7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac', '#053061'],\n        PiYG: ['#8e0152', '#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#f7f7f7', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221', '#276419'],\n        PRGn: ['#40004b', '#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837', '#00441b'],\n        RdYlBu: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee090', '#ffffbf', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695'],\n        BrBG: ['#543005', '#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#f5f5f5', '#c7eae5', '#80cdc1', '#35978f', '#01665e', '#003c30'],\n        RdGy: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#ffffff', '#e0e0e0', '#bababa', '#878787', '#4d4d4d', '#1a1a1a'],\n        PuOr: ['#7f3b08', '#b35806', '#e08214', '#fdb863', '#fee0b6', '#f7f7f7', '#d8daeb', '#b2abd2', '#8073ac', '#542788', '#2d004b'],\n\n        // qualitative\n\n        Set2: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'],\n        Accent: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f', '#bf5b17', '#666666'],\n        Set1: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'],\n        Set3: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5', '#ffed6f'],\n        Dark2: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02', '#a6761d', '#666666'],\n        Paired: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'],\n        Pastel2: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae', '#f1e2cc', '#cccccc'],\n        Pastel1: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd', '#fddaec', '#f2f2f2'],\n    };\n\n    // add lowercase aliases for case-insensitive matches\n    for (var i$1 = 0, list$1 = Object.keys(colorbrewer); i$1 < list$1.length; i$1 += 1) {\n        var key = list$1[i$1];\n\n        colorbrewer[key.toLowerCase()] = colorbrewer[key];\n    }\n\n    var colorbrewer_1 = colorbrewer;\n\n    // feel free to comment out anything to rollup\n    // a smaller chroma.js built\n\n    // io --> convert colors\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    // operators --> modify existing Colors\n\n\n\n\n\n\n\n\n\n\n    // interpolators\n\n\n\n\n\n\n\n\n\n\n    // generators -- > create new colors\n    chroma_1.average = average;\n    chroma_1.bezier = bezier_1;\n    chroma_1.blend = blend_1;\n    chroma_1.cubehelix = cubehelix;\n    chroma_1.mix = chroma_1.interpolate = mix;\n    chroma_1.random = random_1;\n    chroma_1.scale = scale;\n\n    // other utility methods\n    chroma_1.analyze = analyze_1.analyze;\n    chroma_1.contrast = contrast;\n    chroma_1.deltaE = deltaE;\n    chroma_1.distance = distance;\n    chroma_1.limits = analyze_1.limits;\n    chroma_1.valid = valid;\n\n    // scale\n    chroma_1.scales = scales;\n\n    // colors\n    chroma_1.colors = w3cx11_1;\n    chroma_1.brewer = colorbrewer_1;\n\n    var chroma_js = chroma_1;\n\n    return chroma_js;\n\n})));\n","/* globals MOClassDescription, NSObject, NSSelectorFromString, NSClassFromString, MOPropertyDescription */\n\nmodule.exports = function MochaDelegate(definition, superclass) {\n  var uniqueClassName =\n    'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n    uniqueClassName,\n    superclass || NSObject\n  )\n\n  // Storage\n  var handlers = {}\n  var ivars = {}\n\n  // Define an instance method\n  function setHandlerForSelector(selectorString, func) {\n    var handlerHasBeenSet = selectorString in handlers\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      // eslint-disable-next-line no-eval\n      var dynamicFunction = eval(\n        '(function (' +\n          args.join(', ') +\n          ') { return handlers[selectorString].apply(this, arguments); })'\n      )\n\n      delegateClassDesc.addInstanceMethodWithSelector_function(\n        selector,\n        dynamicFunction\n      )\n    }\n  }\n\n  // define a property\n  function setIvar(key, value) {\n    var ivarHasBeenSet = key in handlers\n\n    ivars[key] = value\n\n    if (!ivarHasBeenSet) {\n      delegateClassDesc.addInstanceVariableWithName_typeEncoding(key, '@')\n      var description = MOPropertyDescription.new()\n      description.name = key\n      description.typeEncoding = '@'\n      description.weak = true\n      description.ivarName = key\n      delegateClassDesc.addProperty(description)\n    }\n  }\n\n  this.getClass = function() {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function(instanceVariables) {\n    var instance = NSClassFromString(uniqueClassName).new()\n    Object.keys(ivars).forEach(function(key) {\n      instance[key] = ivars[key]\n    })\n    Object.keys(instanceVariables || {}).forEach(function(key) {\n      instance[key] = instanceVariables[key]\n    })\n    return instance\n  }\n  // alias\n  this.new = this.getClassInstance\n\n  // Convenience\n  if (typeof definition === 'object') {\n    Object.keys(definition).forEach(\n      function(key) {\n        if (typeof definition[key] === 'function') {\n          setHandlerForSelector(key, definition[key])\n        } else {\n          setIvar(key, definition[key])\n        }\n      }\n    )\n  }\n\n  delegateClassDesc.registerClass()\n}\n","function parseHexColor(color) {\n  // Check the string for incorrect formatting.\n  if (!color || color[0] !== '#') {\n    if (\n      color &&\n      typeof color.isKindOfClass === 'function' &&\n      color.isKindOfClass(NSColor)\n    ) {\n      return color\n    }\n    throw new Error(\n      'Incorrect color formating. It should be an hex color: #RRGGBBAA'\n    )\n  }\n\n  // append FF if alpha channel is not specified.\n  var source = color.substr(1)\n  if (source.length === 3) {\n    source += 'F'\n  } else if (source.length === 6) {\n    source += 'FF'\n  }\n  // Convert the string from #FFF format to #FFFFFF format.\n  var hex\n  if (source.length === 4) {\n    for (var i = 0; i < 4; i += 1) {\n      hex += source[i]\n      hex += source[i]\n    }\n  } else if (source.length === 8) {\n    hex = source\n  } else {\n    return NSColor.whiteColor()\n  }\n\n  var r = parseInt(hex.slice(0, 2), 16)\n  var g = parseInt(hex.slice(2, 4), 16)\n  var b = parseInt(hex.slice(4, 6), 16)\n  var a = parseInt(hex.slice(6, 8), 16)\n\n  return NSColor.colorWithSRGBRed_green_blue_alpha(r, g, b, a)\n}\n\nmodule.exports = function(browserWindow, panel, webview) {\n  // keep reference to the subviews\n  browserWindow._panel = panel\n  browserWindow._webview = webview\n  browserWindow._destroyed = false\n\n  browserWindow.destroy = function() {\n    return panel.close()\n  }\n\n  browserWindow.close = function() {\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      var shouldClose = true\n      browserWindow.emit('close', {\n        get defaultPrevented() {\n          return !shouldClose\n        },\n        preventDefault: function() {\n          shouldClose = false\n        },\n      })\n      if (shouldClose) {\n        panel.delegate().utils.parentWindow.endSheet(panel)\n      }\n      return\n    }\n\n    if (!browserWindow.isClosable()) {\n      return\n    }\n\n    panel.performClose(null)\n  }\n\n  function focus(focused) {\n    if (!browserWindow.isVisible()) {\n      return\n    }\n    if (focused) {\n      NSApplication.sharedApplication().activateIgnoringOtherApps(true)\n      panel.makeKeyAndOrderFront(null)\n    } else {\n      panel.orderBack(null)\n      NSApp.mainWindow().makeKeyAndOrderFront(null)\n    }\n  }\n\n  browserWindow.focus = focus.bind(this, true)\n  browserWindow.blur = focus.bind(this, false)\n\n  browserWindow.isFocused = function() {\n    return panel.isKeyWindow()\n  }\n\n  browserWindow.isDestroyed = function() {\n    return browserWindow._destroyed\n  }\n\n  browserWindow.show = function() {\n    // This method is supposed to put focus on window, however if the app does not\n    // have focus then \"makeKeyAndOrderFront\" will only show the window.\n    NSApp.activateIgnoringOtherApps(true)\n\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      return panel.delegate().utils.parentWindow.beginSheet_completionHandler(\n        panel,\n        __mocha__.createBlock_function('v16@?0q8', function() {\n          browserWindow.emit('closed')\n        })\n      )\n    }\n\n    return panel.makeKeyAndOrderFront(null)\n  }\n\n  browserWindow.showInactive = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.hide = function() {\n    return panel.orderOut(null)\n  }\n\n  browserWindow.isVisible = function() {\n    return panel.isVisible()\n  }\n\n  browserWindow.isModal = function() {\n    return false\n  }\n\n  browserWindow.maximize = function() {\n    if (!browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n  browserWindow.unmaximize = function() {\n    if (browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n\n  browserWindow.isMaximized = function() {\n    if ((panel.styleMask() & NSResizableWindowMask) !== 0) {\n      return panel.isZoomed()\n    }\n    var rectScreen = NSScreen.mainScreen().visibleFrame()\n    var rectWindow = panel.frame()\n    return (\n      rectScreen.origin.x == rectWindow.origin.x &&\n      rectScreen.origin.y == rectWindow.origin.y &&\n      rectScreen.size.width == rectWindow.size.width &&\n      rectScreen.size.height == rectWindow.size.height\n    )\n  }\n\n  browserWindow.minimize = function() {\n    return panel.miniaturize(null)\n  }\n\n  browserWindow.restore = function() {\n    return panel.deminiaturize(null)\n  }\n\n  browserWindow.isMinimized = function() {\n    return panel.isMiniaturized()\n  }\n\n  browserWindow.setFullScreen = function(fullscreen) {\n    if (fullscreen !== browserWindow.isFullscreen()) {\n      panel.toggleFullScreen(null)\n    }\n  }\n\n  browserWindow.isFullscreen = function() {\n    return panel.styleMask() & NSFullScreenWindowMask\n  }\n\n  browserWindow.setAspectRatio = function(aspectRatio /* , extraSize */) {\n    // Reset the behaviour to default if aspect_ratio is set to 0 or less.\n    if (aspectRatio > 0.0) {\n      panel.setAspectRatio(NSMakeSize(aspectRatio, 1.0))\n    } else {\n      panel.setResizeIncrements(NSMakeSize(1.0, 1.0))\n    }\n  }\n\n  browserWindow.setBounds = function(bounds, animate) {\n    if (!bounds) {\n      return\n    }\n\n    // Do nothing if in fullscreen mode.\n    if (browserWindow.isFullscreen()) {\n      return\n    }\n\n    const newBounds = Object.assign(browserWindow.getBounds(), bounds)\n\n    // TODO: Check size constraints since setFrame does not check it.\n    // var size = bounds.size\n    // size.SetToMax(GetMinimumSize());\n    // gfx::Size max_size = GetMaximumSize();\n    // if (!max_size.IsEmpty())\n    //   size.SetToMin(max_size);\n\n    var cocoaBounds = NSMakeRect(\n      newBounds.x,\n      0,\n      newBounds.width,\n      newBounds.height\n    )\n    // Flip Y coordinates based on the primary screen\n    var screen = NSScreen.screens().firstObject()\n    cocoaBounds.origin.y = NSHeight(screen.frame()) - newBounds.y\n\n    panel.setFrame_display_animate(cocoaBounds, true, animate)\n  }\n\n  browserWindow.getBounds = function() {\n    const cocoaBounds = panel.frame()\n    var mainScreenRect = NSScreen.screens()\n      .firstObject()\n      .frame()\n    return {\n      x: cocoaBounds.origin.x,\n      y: Math.round(NSHeight(mainScreenRect) - cocoaBounds.origin.y),\n      width: cocoaBounds.size.width,\n      height: cocoaBounds.size.height,\n    }\n  }\n\n  browserWindow.setContentBounds = function(bounds, animate) {\n    // TODO:\n    browserWindow.setBounds(bounds, animate)\n  }\n\n  browserWindow.getContentBounds = function() {\n    // TODO:\n    return browserWindow.getBounds()\n  }\n\n  browserWindow.setSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setBounds({ width: width, height: height }, animate)\n  }\n\n  browserWindow.getSize = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setContentSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setContentBounds(\n      { width: width, height: height },\n      animate\n    )\n  }\n\n  browserWindow.getContentSize = function() {\n    var bounds = browserWindow.getContentBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setMinimumSize = function(width, height) {\n    const minSize = CGSizeMake(width, height)\n    panel.setContentMinSize(minSize)\n  }\n\n  browserWindow.getMinimumSize = function() {\n    const size = panel.contentMinSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setMaximumSize = function(width, height) {\n    const maxSize = CGSizeMake(width, height)\n    panel.setContentMaxSize(maxSize)\n  }\n\n  browserWindow.getMaximumSize = function() {\n    const size = panel.contentMaxSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setResizable = function(resizable) {\n    return browserWindow._setStyleMask(resizable, NSResizableWindowMask)\n  }\n\n  browserWindow.isResizable = function() {\n    return panel.styleMask() & NSResizableWindowMask\n  }\n\n  browserWindow.setMovable = function(movable) {\n    return panel.setMovable(movable)\n  }\n  browserWindow.isMovable = function() {\n    return panel.isMovable()\n  }\n\n  browserWindow.setMinimizable = function(minimizable) {\n    return browserWindow._setStyleMask(minimizable, NSMiniaturizableWindowMask)\n  }\n\n  browserWindow.isMinimizable = function() {\n    return panel.styleMask() & NSMiniaturizableWindowMask\n  }\n\n  browserWindow.setMaximizable = function(maximizable) {\n    if (panel.standardWindowButton(NSWindowZoomButton)) {\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(maximizable)\n    }\n  }\n\n  browserWindow.isMaximizable = function() {\n    return (\n      panel.standardWindowButton(NSWindowZoomButton) &&\n      panel.standardWindowButton(NSWindowZoomButton).isEnabled()\n    )\n  }\n\n  browserWindow.setFullScreenable = function(fullscreenable) {\n    browserWindow._setCollectionBehavior(\n      fullscreenable,\n      NSWindowCollectionBehaviorFullScreenPrimary\n    )\n    // On EL Capitan this flag is required to hide fullscreen button.\n    browserWindow._setCollectionBehavior(\n      !fullscreenable,\n      NSWindowCollectionBehaviorFullScreenAuxiliary\n    )\n  }\n\n  browserWindow.isFullScreenable = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorFullScreenPrimary\n  }\n\n  browserWindow.setClosable = function(closable) {\n    browserWindow._setStyleMask(closable, NSClosableWindowMask)\n  }\n\n  browserWindow.isClosable = function() {\n    return panel.styleMask() & NSClosableWindowMask\n  }\n\n  browserWindow.setAlwaysOnTop = function(top, level, relativeLevel) {\n    var windowLevel = NSNormalWindowLevel\n    var maxWindowLevel = CGWindowLevelForKey(kCGMaximumWindowLevelKey)\n    var minWindowLevel = CGWindowLevelForKey(kCGMinimumWindowLevelKey)\n\n    if (top) {\n      if (level === 'normal') {\n        windowLevel = NSNormalWindowLevel\n      } else if (level === 'torn-off-menu') {\n        windowLevel = NSTornOffMenuWindowLevel\n      } else if (level === 'modal-panel') {\n        windowLevel = NSModalPanelWindowLevel\n      } else if (level === 'main-menu') {\n        windowLevel = NSMainMenuWindowLevel\n      } else if (level === 'status') {\n        windowLevel = NSStatusWindowLevel\n      } else if (level === 'pop-up-menu') {\n        windowLevel = NSPopUpMenuWindowLevel\n      } else if (level === 'screen-saver') {\n        windowLevel = NSScreenSaverWindowLevel\n      } else if (level === 'dock') {\n        // Deprecated by macOS, but kept for backwards compatibility\n        windowLevel = NSDockWindowLevel\n      } else {\n        windowLevel = NSFloatingWindowLevel\n      }\n    }\n\n    var newLevel = windowLevel + (relativeLevel || 0)\n    if (newLevel >= minWindowLevel && newLevel <= maxWindowLevel) {\n      panel.setLevel(newLevel)\n    } else {\n      throw new Error(\n        'relativeLevel must be between ' +\n          minWindowLevel +\n          ' and ' +\n          maxWindowLevel\n      )\n    }\n  }\n\n  browserWindow.isAlwaysOnTop = function() {\n    return panel.level() !== NSNormalWindowLevel\n  }\n\n  browserWindow.moveTop = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.center = function() {\n    panel.center()\n  }\n\n  browserWindow.setPosition = function(x, y, animate) {\n    return browserWindow.setBounds({ x: x, y: y }, animate)\n  }\n\n  browserWindow.getPosition = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.x, bounds.y]\n  }\n\n  browserWindow.setTitle = function(title) {\n    panel.setTitle(title)\n  }\n\n  browserWindow.getTitle = function() {\n    return String(panel.title())\n  }\n\n  var attentionRequestId = 0\n  browserWindow.flashFrame = function(flash) {\n    if (flash) {\n      attentionRequestId = NSApp.requestUserAttention(NSInformationalRequest)\n    } else {\n      NSApp.cancelUserAttentionRequest(attentionRequestId)\n      attentionRequestId = 0\n    }\n  }\n\n  browserWindow.getNativeWindowHandle = function() {\n    return panel\n  }\n\n  browserWindow.getNativeWebViewHandle = function() {\n    return webview\n  }\n\n  browserWindow.loadURL = function(url) {\n    // When frameLocation is a file, prefix it with the Sketch Resources path\n    if (/^(?!https?|file).*\\.html?$/.test(url)) {\n      if (typeof __command !== 'undefined' && __command.pluginBundle()) {\n        url =\n          'file://' +\n          __command\n            .pluginBundle()\n            .urlForResourceNamed(url)\n            .path()\n      }\n    }\n\n    if (/^file:\\/\\/.*\\.html?$/.test(url)) {\n      // ensure URLs containing spaces are properly handled\n      url = NSString.alloc().initWithString(url)\n      url = url.stringByAddingPercentEncodingWithAllowedCharacters(\n        NSCharacterSet.URLQueryAllowedCharacterSet()\n      )\n      webview.loadFileURL_allowingReadAccessToURL(\n        NSURL.URLWithString(url),\n        NSURL.URLWithString('file:///')\n      )\n      return\n    }\n\n    const properURL = NSURL.URLWithString(url)\n    const urlRequest = NSURLRequest.requestWithURL(properURL)\n\n    webview.loadRequest(urlRequest)\n  }\n\n  browserWindow.reload = function() {\n    webview.reload()\n  }\n\n  browserWindow.setHasShadow = function(hasShadow) {\n    return panel.setHasShadow(hasShadow)\n  }\n\n  browserWindow.hasShadow = function() {\n    return panel.hasShadow()\n  }\n\n  browserWindow.setOpacity = function(opacity) {\n    return panel.setAlphaValue(opacity)\n  }\n\n  browserWindow.getOpacity = function() {\n    return panel.alphaValue()\n  }\n\n  browserWindow.setVisibleOnAllWorkspaces = function(visible) {\n    return browserWindow._setCollectionBehavior(\n      visible,\n      NSWindowCollectionBehaviorCanJoinAllSpaces\n    )\n  }\n\n  browserWindow.isVisibleOnAllWorkspaces = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorCanJoinAllSpaces\n  }\n\n  browserWindow.setIgnoreMouseEvents = function(ignore) {\n    return panel.setIgnoresMouseEvents(ignore)\n  }\n\n  browserWindow.setContentProtection = function(enable) {\n    panel.setSharingType(enable ? NSWindowSharingNone : NSWindowSharingReadOnly)\n  }\n\n  browserWindow.setAutoHideCursor = function(autoHide) {\n    panel.setDisableAutoHideCursor(autoHide)\n  }\n\n  browserWindow.setVibrancy = function(type) {\n    var effectView = browserWindow._vibrantView\n\n    if (!type) {\n      if (effectView == null) {\n        return\n      }\n\n      effectView.removeFromSuperview()\n      panel.setVibrantView(null)\n      return\n    }\n\n    if (effectView == null) {\n      var contentView = panel.contentView()\n      effectView = NSVisualEffectView.alloc().initWithFrame(\n        contentView.bounds()\n      )\n      browserWindow._vibrantView = effectView\n\n      effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n      effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n      effectView.setState(NSVisualEffectStateActive)\n      effectView.setFrame(contentView.bounds())\n      contentView.addSubview_positioned_relativeTo(\n        effectView,\n        NSWindowBelow,\n        null\n      )\n    }\n\n    var vibrancyType = NSVisualEffectMaterialLight\n\n    if (type === 'appearance-based') {\n      vibrancyType = NSVisualEffectMaterialAppearanceBased\n    } else if (type === 'light') {\n      vibrancyType = NSVisualEffectMaterialLight\n    } else if (type === 'dark') {\n      vibrancyType = NSVisualEffectMaterialDark\n    } else if (type === 'titlebar') {\n      vibrancyType = NSVisualEffectMaterialTitlebar\n    } else if (type === 'selection') {\n      vibrancyType = NSVisualEffectMaterialSelection\n    } else if (type === 'menu') {\n      vibrancyType = NSVisualEffectMaterialMenu\n    } else if (type === 'popover') {\n      vibrancyType = NSVisualEffectMaterialPopover\n    } else if (type === 'sidebar') {\n      vibrancyType = NSVisualEffectMaterialSidebar\n    } else if (type === 'medium-light') {\n      vibrancyType = NSVisualEffectMaterialMediumLight\n    } else if (type === 'ultra-dark') {\n      vibrancyType = NSVisualEffectMaterialUltraDark\n    }\n\n    effectView.setMaterial(vibrancyType)\n  }\n\n  browserWindow._setBackgroundColor = function(colorName) {\n    var color = parseHexColor(colorName)\n    webview.setValue_forKey(false, 'drawsBackground')\n    panel.backgroundColor = color\n  }\n\n  browserWindow._invalidate = function() {\n    panel.flushWindow()\n    panel.contentView().setNeedsDisplay(true)\n  }\n\n  browserWindow._setStyleMask = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setStyleMask(panel.styleMask() | flag)\n    } else {\n      panel.setStyleMask(panel.styleMask() & ~flag)\n    }\n    // Change style mask will make the zoom button revert to default, probably\n    // a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._setCollectionBehavior = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setCollectionBehavior(panel.collectionBehavior() | flag)\n    } else {\n      panel.setCollectionBehavior(panel.collectionBehavior() & ~flag)\n    }\n    // Change collectionBehavior will make the zoom button revert to default,\n    // probably a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._showWindowButton = function(button) {\n    var view = panel.standardWindowButton(button)\n    view.superview().addSubview_positioned_relative(view, NSWindowAbove, null)\n  }\n}\n","module.exports = {\n  JS_BRIDGE: '__skpm_sketchBridge',\n  JS_BRIDGE_RESULT_SUCCESS: '__skpm_sketchBridge_success',\n  JS_BRIDGE_RESULT_ERROR: '__skpm_sketchBridge_error',\n  START_MOVING_WINDOW: '__skpm_startMovingWindow',\n  EXECUTE_JAVASCRIPT: '__skpm_executeJS',\n  EXECUTE_JAVASCRIPT_SUCCESS: '__skpm_executeJS_success_',\n  EXECUTE_JAVASCRIPT_ERROR: '__skpm_executeJS_error_',\n}\n","var tagsToFocus =\n  '[\"text\", \"textarea\", \"date\", \"datetime-local\", \"email\", \"number\", \"month\", \"password\", \"search\", \"tel\", \"time\", \"url\", \"week\" ]'\n\nmodule.exports = function(webView, event) {\n  var point = webView.convertPoint_fromView(event.locationInWindow(), null)\n  return (\n    'var el = document.elementFromPoint(' + // get the DOM element that match the event\n    point.x +\n    ', ' +\n    point.y +\n    '); ' +\n    'if (el && el.tagName === \"SELECT\") {' + // select needs special handling\n    '  var event = document.createEvent(\"MouseEvents\");' +\n    '  event.initMouseEvent(\"mousedown\", true, true, window);' +\n    '  el.dispatchEvent(event);' +\n    '} else if (el && ' + // some tags need to be focused instead of clicked\n    tagsToFocus +\n    '.indexOf(el.type) >= 0 && ' +\n    'el.focus' +\n    ') {' +\n    'el.focus();' + // so focus them\n    '} else if (el) {' +\n    'el.dispatchEvent(new Event(\"click\", {bubbles: true}))' + // click the others\n    '}'\n  )\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webview, browserWindow) {\n  function executeJavaScript(script, userGesture, callback) {\n    if (typeof userGesture === 'function') {\n      callback = userGesture\n      userGesture = false\n    }\n    var fiber = coscript.createFiber()\n\n    // if the webview is not ready yet, defer the execution until it is\n    if (\n      webview.navigationDelegate().state &&\n      webview.navigationDelegate().state.wasReady == 0\n    ) {\n      return new Promise(function(resolve, reject) {\n        browserWindow.once('ready-to-show', function() {\n          executeJavaScript(script, userGesture, callback)\n            .then(resolve)\n            .catch(reject)\n          fiber.cleanup()\n        })\n      })\n    }\n\n    return new Promise(function(resolve, reject) {\n      var requestId = Math.random()\n\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS + requestId,\n        function(res) {\n          try {\n            if (callback) {\n              callback(null, res)\n            }\n            resolve(res)\n          } catch (err) {\n            reject(err)\n          }\n          fiber.cleanup()\n        }\n      )\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_ERROR + requestId,\n        function(err) {\n          try {\n            if (callback) {\n              callback(err)\n              resolve()\n            } else {\n              reject(err)\n            }\n          } catch (err2) {\n            reject(err2)\n          }\n          fiber.cleanup()\n        }\n      )\n\n      webview.evaluateJavaScript_completionHandler(\n        module.exports.wrapScript(script, requestId),\n        null\n      )\n    })\n  }\n\n  return executeJavaScript\n}\n\nmodule.exports.wrapScript = function(script, requestId) {\n  return (\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    '(' +\n    requestId +\n    ', ' +\n    JSON.stringify(script) +\n    ')'\n  )\n}\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    ' = function(id, script) {' +\n    '  try {' +\n    '    var res = eval(script);' +\n    '    if (res && typeof res.then === \"function\" && typeof res.catch === \"function\") {' +\n    '      res.then(function (res2) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res2);' +\n    '      })' +\n    '      .catch(function (err) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '      })' +\n    '    } else {' +\n    '      window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res);' +\n    '    }' +\n    '  } catch (err) {' +\n    '    window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '  }' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","function addEdgeConstraint(edge, subview, view, constant) {\n  view.addConstraint(\n    NSLayoutConstraint.constraintWithItem_attribute_relatedBy_toItem_attribute_multiplier_constant(\n      subview,\n      edge,\n      NSLayoutRelationEqual,\n      view,\n      edge,\n      1,\n      constant\n    )\n  )\n}\nmodule.exports = function fitSubviewToView(subview, view, constants) {\n  constants = constants || []\n  subview.setTranslatesAutoresizingMaskIntoConstraints(false)\n\n  addEdgeConstraint(NSLayoutAttributeLeft, subview, view, constants[0] || 0)\n  addEdgeConstraint(NSLayoutAttributeTop, subview, view, constants[1] || 0)\n  addEdgeConstraint(NSLayoutAttributeRight, subview, view, constants[2] || 0)\n  addEdgeConstraint(NSLayoutAttributeBottom, subview, view, constants[3] || 0)\n}\n","/* let's try to match the API from Electron's Browser window\n(https://github.com/electron/electron/blob/master/docs/api/browser-window.md) */\nvar EventEmitter = require('events')\nvar buildBrowserAPI = require('./browser-api')\nvar buildWebAPI = require('./webview-api')\nvar fitSubviewToView = require('./fitSubview')\nvar dispatchFirstClick = require('./dispatch-first-click')\nvar injectClientMessaging = require('./inject-client-messaging')\nvar movableArea = require('./movable-area')\nvar executeJavaScript = require('./execute-javascript')\nvar setDelegates = require('./set-delegates')\n\nfunction BrowserWindow(options) {\n  options = options || {}\n\n  var identifier = options.identifier || NSUUID.UUID().UUIDString()\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  var existingBrowserWindow = BrowserWindow.fromId(identifier)\n\n  // if we already have a window opened, reuse it\n  if (existingBrowserWindow) {\n    return existingBrowserWindow\n  }\n\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (options.modal && !options.parent) {\n    throw new Error('A modal needs to have a parent.')\n  }\n\n  // Long-running script\n  var fiber = coscript.createFiber()\n\n  // Window size\n  var width = options.width || 800\n  var height = options.height || 600\n  var mainScreenRect = NSScreen.screens()\n    .firstObject()\n    .frame()\n  var cocoaBounds = NSMakeRect(\n    typeof options.x !== 'undefined'\n      ? options.x\n      : Math.round((NSWidth(mainScreenRect) - width) / 2),\n    typeof options.y !== 'undefined'\n      ? NSHeight(mainScreenRect) - options.y\n      : Math.round((NSHeight(mainScreenRect) - height) / 2),\n    width,\n    height\n  )\n\n  if (options.titleBarStyle && options.titleBarStyle !== 'default') {\n    options.frame = false\n  }\n\n  var useStandardWindow = options.windowType !== 'textured'\n  var styleMask = NSTitledWindowMask\n\n  // this is commented out because the toolbar doesn't appear otherwise :thinking-face:\n  // if (!useStandardWindow || options.frame === false) {\n  //   styleMask = NSFullSizeContentViewWindowMask\n  // }\n  if (options.minimizable !== false) {\n    styleMask |= NSMiniaturizableWindowMask\n  }\n  if (options.closable !== false) {\n    styleMask |= NSClosableWindowMask\n  }\n  if (options.resizable !== false) {\n    styleMask |= NSResizableWindowMask\n  }\n  if (!useStandardWindow || options.transparent || options.frame === false) {\n    styleMask |= NSTexturedBackgroundWindowMask\n  }\n\n  var panel = NSPanel.alloc().initWithContentRect_styleMask_backing_defer(\n    cocoaBounds,\n    styleMask,\n    NSBackingStoreBuffered,\n    true\n  )\n\n  var wkwebviewConfig = WKWebViewConfiguration.alloc().init()\n  var webView = WKWebView.alloc().initWithFrame_configuration(\n    CGRectMake(0, 0, options.width || 800, options.height || 600),\n    wkwebviewConfig\n  )\n  injectClientMessaging(webView)\n  webView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n  setDelegates(browserWindow, panel, webView, options)\n\n  if (options.windowType === 'desktop') {\n    panel.setLevel(kCGDesktopWindowLevel - 1)\n    // panel.setCanBecomeKeyWindow(false)\n    panel.setCollectionBehavior(\n      NSWindowCollectionBehaviorCanJoinAllSpaces |\n        NSWindowCollectionBehaviorStationary |\n        NSWindowCollectionBehaviorIgnoresCycle\n    )\n  }\n\n  if (\n    typeof options.minWidth !== 'undefined' ||\n    typeof options.minHeight !== 'undefined'\n  ) {\n    browserWindow.setMinimumSize(options.minWidth || 0, options.minHeight || 0)\n  }\n\n  if (\n    typeof options.maxWidth !== 'undefined' ||\n    typeof options.maxHeight !== 'undefined'\n  ) {\n    browserWindow.setMaximumSize(\n      options.maxWidth || 10000,\n      options.maxHeight || 10000\n    )\n  }\n\n  // if (options.focusable === false) {\n  //   panel.setCanBecomeKeyWindow(false)\n  // }\n\n  if (options.transparent || options.frame === false) {\n    panel.titlebarAppearsTransparent = true\n    panel.titleVisibility = NSWindowTitleHidden\n    panel.setOpaque(0)\n    panel.isMovableByWindowBackground = true\n    var toolbar2 = NSToolbar.alloc().initWithIdentifier(\n      'titlebarStylingToolbar'\n    )\n    toolbar2.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar2)\n  }\n\n  if (options.titleBarStyle === 'hiddenInset') {\n    var toolbar = NSToolbar.alloc().initWithIdentifier('titlebarStylingToolbar')\n    toolbar.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar)\n  }\n\n  if (options.frame === false || !options.useContentSize) {\n    browserWindow.setSize(width, height)\n  }\n\n  if (options.center) {\n    browserWindow.center()\n  }\n\n  if (options.alwaysOnTop) {\n    browserWindow.setAlwaysOnTop(true)\n  }\n\n  if (options.fullscreen) {\n    browserWindow.setFullScreen(true)\n  }\n  browserWindow.setFullScreenable(!!options.fullscreenable)\n\n  let title = options.title\n  if (options.frame === false) {\n    title = undefined\n  } else if (\n    typeof title === 'undefined' &&\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle()\n  ) {\n    title = __command.pluginBundle().name()\n  }\n\n  if (title) {\n    browserWindow.setTitle(title)\n  }\n\n  var backgroundColor = options.backgroundColor\n  if (options.transparent) {\n    backgroundColor = NSColor.clearColor()\n  }\n  if (!backgroundColor && options.frame === false && options.vibrancy) {\n    backgroundColor = NSColor.clearColor()\n  }\n\n  browserWindow._setBackgroundColor(\n    backgroundColor || NSColor.windowBackgroundColor()\n  )\n\n  if (options.hasShadow === false) {\n    browserWindow.setHasShadow(false)\n  }\n\n  if (typeof options.opacity !== 'undefined') {\n    browserWindow.setOpacity(options.opacity)\n  }\n\n  options.webPreferences = options.webPreferences || {}\n\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.devTools !== false,\n      'developerExtrasEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.javascript !== false,\n      'javaScriptEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(!!options.webPreferences.plugins, 'plugInsEnabled')\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.minimumFontSize || 0,\n      'minimumFontSize'\n    )\n\n  if (options.webPreferences.zoomFactor) {\n    webView.setMagnification(options.webPreferences.zoomFactor)\n  }\n\n  var contentView = panel.contentView()\n\n  if (options.frame !== false) {\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n  } else {\n    // In OSX 10.10, adding subviews to the root view for the NSView hierarchy\n    // produces warnings. To eliminate the warnings, we resize the contentView\n    // to fill the window, and add subviews to that.\n    // http://crbug.com/380412\n    contentView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    fitSubviewToView(contentView, contentView.superview())\n\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n\n    // The fullscreen button should always be hidden for frameless window.\n    if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n      panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n    }\n\n    if (!options.titleBarStyle || options.titleBarStyle === 'default') {\n      // Hide the window buttons.\n      panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n      panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n      panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n      // Some third-party macOS utilities check the zoom button's enabled state to\n      // determine whether to show custom UI on hover, so we disable it here to\n      // prevent them from doing so in a frameless app window.\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n    }\n  }\n\n  if (options.vibrancy) {\n    browserWindow.setVibrancy(options.vibrancy)\n  }\n\n  // Set maximizable state last to ensure zoom button does not get reset\n  // by calls to other APIs.\n  browserWindow.setMaximizable(options.maximizable !== false)\n\n  panel.setHidesOnDeactivate(options.hidesOnDeactivate !== false)\n\n  if (options.remembersWindowFrame) {\n    panel.setFrameAutosaveName(identifier)\n    panel.setFrameUsingName_force(panel.frameAutosaveName(), false)\n  }\n\n  if (options.acceptsFirstMouse) {\n    browserWindow.on('focus', function(event) {\n      if (event.type() === NSEventTypeLeftMouseDown) {\n        browserWindow.webContents\n          .executeJavaScript(dispatchFirstClick(webView, event))\n          .catch(() => {})\n      }\n    })\n  }\n\n  executeJavaScript.injectScript(webView)\n  movableArea.injectScript(webView)\n  movableArea.setupHandler(browserWindow)\n\n  if (options.show !== false) {\n    browserWindow.show()\n  }\n\n  browserWindow.on('closed', function() {\n    browserWindow._destroyed = true\n    threadDictionary.removeObjectForKey(identifier)\n    var observer = threadDictionary[identifier + '.themeObserver']\n    if (observer) {\n      NSApplication.sharedApplication().removeObserver_forKeyPath(\n        observer,\n        'effectiveAppearance'\n      )\n      threadDictionary.removeObjectForKey(identifier + '.themeObserver')\n    }\n    fiber.cleanup()\n  })\n\n  threadDictionary[identifier] = panel\n\n  fiber.onCleanup(function() {\n    if (!browserWindow._destroyed) {\n      browserWindow.destroy()\n    }\n  })\n\n  return browserWindow\n}\n\nBrowserWindow.fromId = function(identifier) {\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  if (threadDictionary[identifier]) {\n    return BrowserWindow.fromPanel(threadDictionary[identifier], identifier)\n  }\n\n  return undefined\n}\n\nBrowserWindow.fromPanel = function(panel, identifier) {\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (!panel || !panel.contentView) {\n    throw new Error('needs to pass an NSPanel')\n  }\n\n  var webView = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webView &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webView = subviews[i]\n    }\n  }\n\n  if (!webView) {\n    throw new Error('The panel needs to have a webview')\n  }\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n\n  return browserWindow\n}\n\nmodule.exports = BrowserWindow\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webView) {\n  var source =\n    'window.originalPostMessage = window.postMessage;' +\n    'window.postMessage = function(actionName) {' +\n    '  if (!actionName) {' +\n    \"    throw new Error('missing action name')\" +\n    '  }' +\n    '  var id = String(Math.random()).replace(\".\", \"\");' +\n    '    var args = [].slice.call(arguments);' +\n    '    args.unshift(id);' +\n    '  return new Promise(function (resolve, reject) {' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n    '\" + id] = resolve;' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n    '\" + id] = reject;' +\n    '    window.webkit.messageHandlers.' +\n    CONSTANTS.JS_BRIDGE +\n    '.postMessage(JSON.stringify(args));' +\n    '  });' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    '(function () {' +\n    \"document.addEventListener('mousedown', onMouseDown);\" +\n    '' +\n    'function shouldDrag(target) {' +\n    '  if (!target || (target.dataset || {}).appRegion === \"no-drag\") { return false }' +\n    '  if ((target.dataset || {}).appRegion === \"drag\") { return true }' +\n    '  return shouldDrag(target.parentElement)' +\n    '};' +\n    '' +\n    'function onMouseDown(e) {' +\n    '  if (e.button !== 0 || !shouldDrag(e.target)) { return }' +\n    '  window.postMessage(\"' +\n    CONSTANTS.START_MOVING_WINDOW +\n    '\");' +\n    '};' +\n    '})()'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n\nmodule.exports.setupHandler = function(browserWindow) {\n  var initialMouseLocation = null\n  var initialWindowPosition = null\n  var interval = null\n\n  function moveWindow() {\n    // if the user released the button, stop moving the window\n    if (!initialWindowPosition || NSEvent.pressedMouseButtons() !== 1) {\n      clearInterval(interval)\n      initialMouseLocation = null\n      initialWindowPosition = null\n      return\n    }\n\n    var mouse = NSEvent.mouseLocation()\n    browserWindow.setPosition(\n      initialWindowPosition.x + (mouse.x - initialMouseLocation.x),\n      initialWindowPosition.y + (initialMouseLocation.y - mouse.y), // y is inverted\n      false\n    )\n  }\n\n  browserWindow.webContents.on(CONSTANTS.START_MOVING_WINDOW, function() {\n    initialMouseLocation = NSEvent.mouseLocation()\n    var position = browserWindow.getPosition()\n    initialWindowPosition = {\n      x: position[0],\n      y: position[1],\n    }\n\n    interval = setInterval(moveWindow, 1000 / 60) // 60 fps\n  })\n}\n","module.exports = function(webArguments) {\n  var args = null\n  try {\n    args = JSON.parse(webArguments)\n  } catch (e) {\n    // malformed arguments\n  }\n\n  if (\n    !args ||\n    !args.constructor ||\n    args.constructor !== Array ||\n    args.length == 0\n  ) {\n    return null\n  }\n\n  return args\n}\n","var ObjCClass = require('mocha-js-delegate')\nvar parseWebArguments = require('./parseWebArguments')\nvar CONSTANTS = require('./constants')\n\n// We create one ObjC class for ourselves here\nvar WindowDelegateClass\nvar NavigationDelegateClass\nvar WebScriptHandlerClass\nvar ThemeObserverClass\n\n// TODO: events\n// - 'page-favicon-updated'\n// - 'new-window'\n// - 'did-navigate-in-page'\n// - 'will-prevent-unload'\n// - 'crashed'\n// - 'unresponsive'\n// - 'responsive'\n// - 'destroyed'\n// - 'before-input-event'\n// - 'certificate-error'\n// - 'found-in-page'\n// - 'media-started-playing'\n// - 'media-paused'\n// - 'did-change-theme-color'\n// - 'update-target-url'\n// - 'cursor-changed'\n// - 'context-menu'\n// - 'select-bluetooth-device'\n// - 'paint'\n// - 'console-message'\n\nmodule.exports = function(browserWindow, panel, webview, options) {\n  if (!ThemeObserverClass) {\n    ThemeObserverClass = new ObjCClass({\n      utils: null,\n\n      'observeValueForKeyPath:ofObject:change:context:': function() {\n        this.utils.executeJavaScript(\n          \"document.body.classList.remove('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'light'\n              : 'dark') +\n            \"'); document.body.classList.add('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'dark'\n              : 'light') +\n            \"')\"\n        )\n      },\n    })\n  }\n\n  if (!WindowDelegateClass) {\n    WindowDelegateClass = new ObjCClass({\n      utils: null,\n      panel: null,\n\n      'windowDidResize:': function() {\n        this.utils.emit('resize')\n      },\n\n      'windowDidMiniaturize:': function() {\n        this.utils.emit('minimize')\n      },\n\n      'windowDidDeminiaturize:': function() {\n        this.utils.emit('restore')\n      },\n\n      'windowDidEnterFullScreen:': function() {\n        this.utils.emit('enter-full-screen')\n      },\n\n      'windowDidExitFullScreen:': function() {\n        this.utils.emit('leave-full-screen')\n      },\n\n      'windowDidMove:': function() {\n        this.utils.emit('move')\n        this.utils.emit('moved')\n      },\n\n      'windowShouldClose:': function() {\n        var shouldClose = 1\n        this.utils.emit('close', {\n          get defaultPrevented() {\n            return !shouldClose\n          },\n          preventDefault: function() {\n            shouldClose = 0\n          },\n        })\n        return shouldClose\n      },\n\n      'windowWillClose:': function() {\n        this.utils.emit('closed')\n      },\n\n      'windowDidBecomeKey:': function() {\n        this.utils.emit('focus', this.panel.currentEvent())\n      },\n\n      'windowDidResignKey:': function() {\n        this.utils.emit('blur')\n      },\n    })\n  }\n\n  if (!NavigationDelegateClass) {\n    NavigationDelegateClass = new ObjCClass({\n      state: {\n        wasReady: 0,\n      },\n      utils: null,\n\n      // // Called when the web view begins to receive web content.\n      'webView:didCommitNavigation:': function(webView) {\n        this.utils.emit('will-navigate', {}, String(String(webView.URL())))\n      },\n\n      // // Called when web content begins to load in a web view.\n      'webView:didStartProvisionalNavigation:': function() {\n        this.utils.emit('did-start-navigation')\n        this.utils.emit('did-start-loading')\n      },\n\n      // Called when a web view receives a server redirect.\n      'webView:didReceiveServerRedirectForProvisionalNavigation:': function() {\n        this.utils.emit('did-get-redirect-request')\n      },\n\n      // // Called when the web view needs to respond to an authentication challenge.\n      // 'webView:didReceiveAuthenticationChallenge:completionHandler:': function(\n      //   webView,\n      //   challenge,\n      //   completionHandler\n      // ) {\n      //   function callback(username, password) {\n      //     completionHandler(\n      //       0,\n      //       NSURLCredential.credentialWithUser_password_persistence(\n      //         username,\n      //         password,\n      //         1\n      //       )\n      //     )\n      //   }\n      //   var protectionSpace = challenge.protectionSpace()\n      //   this.utils.emit(\n      //     'login',\n      //     {},\n      //     {\n      //       method: String(protectionSpace.authenticationMethod()),\n      //       url: 'not implemented', // TODO:\n      //       referrer: 'not implemented', // TODO:\n      //     },\n      //     {\n      //       isProxy: !!protectionSpace.isProxy(),\n      //       scheme: String(protectionSpace.protocol()),\n      //       host: String(protectionSpace.host()),\n      //       port: Number(protectionSpace.port()),\n      //       realm: String(protectionSpace.realm()),\n      //     },\n      //     callback\n      //   )\n      // },\n\n      // Called when an error occurs during navigation.\n      // 'webView:didFailNavigation:withError:': function(\n      //   webView,\n      //   navigation,\n      //   error\n      // ) {},\n\n      // Called when an error occurs while the web view is loading content.\n      'webView:didFailProvisionalNavigation:withError:': function(\n        webView,\n        navigation,\n        error\n      ) {\n        this.utils.emit('did-fail-load', error)\n      },\n\n      // Called when the navigation is complete.\n      'webView:didFinishNavigation:': function() {\n        if (this.state.wasReady == 0) {\n          this.state.wasReady = 1\n          this.utils.emitBrowserEvent('ready-to-show')\n        }\n        this.utils.emit('did-navigate')\n        this.utils.emit('did-frame-navigate')\n        this.utils.emit('did-stop-loading')\n        this.utils.emit('did-finish-load')\n        this.utils.emit('did-frame-finish-load')\n      },\n\n      // Called when the web views web content process is terminated.\n      'webViewWebContentProcessDidTerminate:': function() {\n        this.utils.emit('dom-ready')\n      },\n\n      // Decides whether to allow or cancel a navigation.\n      // webView:decidePolicyForNavigationAction:decisionHandler:\n\n      // Decides whether to allow or cancel a navigation after its response is known.\n      // webView:decidePolicyForNavigationResponse:decisionHandler:\n    })\n  }\n\n  if (!WebScriptHandlerClass) {\n    WebScriptHandlerClass = new ObjCClass({\n      utils: null,\n      'userContentController:didReceiveScriptMessage:': function(_, message) {\n        var args = this.utils.parseWebArguments(String(message.body()))\n        if (!args) {\n          return\n        }\n        if (!args[0] || typeof args[0] !== 'string') {\n          return\n        }\n        args[0] = String(args[0])\n\n        this.utils.emit.apply(this, args)\n      },\n    })\n  }\n\n  var themeObserver = ThemeObserverClass.new({\n    utils: {\n      executeJavaScript(script) {\n        webview.evaluateJavaScript_completionHandler(script, null)\n      },\n    },\n  })\n\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    \"document.addEventListener('DOMContentLoaded', function() { document.body.classList.add('__skpm-\" +\n      (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n        ? 'dark'\n        : 'light') +\n      \"') }, false)\",\n    0,\n    true\n  )\n  webview\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n\n  NSApplication.sharedApplication().addObserver_forKeyPath_options_context(\n    themeObserver,\n    'effectiveAppearance',\n    NSKeyValueChangeNewKey,\n    null\n  )\n\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n  threadDictionary[browserWindow.id + '.themeObserver'] = themeObserver\n\n  var navigationDelegate = NavigationDelegateClass.new({\n    utils: {\n      setTitle: browserWindow.setTitle.bind(browserWindow),\n      emitBrowserEvent() {\n        try {\n          browserWindow.emit.apply(browserWindow, arguments)\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n    },\n    state: {\n      wasReady: 0,\n    },\n  })\n\n  webview.setNavigationDelegate(navigationDelegate)\n\n  var webScriptHandler = WebScriptHandlerClass.new({\n    utils: {\n      emit(id, type) {\n        if (!type) {\n          webview.evaluateJavaScript_completionHandler(\n            CONSTANTS.JS_BRIDGE_RESULT_SUCCESS + id + '()',\n            null\n          )\n          return\n        }\n\n        var args = []\n        for (var i = 2; i < arguments.length; i += 1) args.push(arguments[i])\n\n        var listeners = browserWindow.webContents.listeners(type)\n\n        Promise.all(\n          listeners.map(function(l) {\n            return Promise.resolve().then(function() {\n              return l.apply(l, args)\n            })\n          })\n        )\n          .then(function(res) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n                id +\n                '(' +\n                JSON.stringify(res) +\n                ')',\n              null\n            )\n          })\n          .catch(function(err) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n                id +\n                '(' +\n                JSON.stringify(err) +\n                ')',\n              null\n            )\n          })\n      },\n      parseWebArguments: parseWebArguments,\n    },\n  })\n\n  webview\n    .configuration()\n    .userContentController()\n    .addScriptMessageHandler_name(webScriptHandler, CONSTANTS.JS_BRIDGE)\n\n  var utils = {\n    emit() {\n      try {\n        browserWindow.emit.apply(browserWindow, arguments)\n      } catch (err) {\n        if (\n          typeof process !== 'undefined' &&\n          process.listenerCount &&\n          process.listenerCount('uncaughtException')\n        ) {\n          process.emit('uncaughtException', err, 'uncaughtException')\n        } else {\n          console.error(err)\n          throw err\n        }\n      }\n    },\n  }\n  if (options.modal) {\n    // find the window of the document\n    var msdocument\n    if (options.parent.type === 'Document') {\n      msdocument = options.parent.sketchObject\n    } else {\n      msdocument = options.parent\n    }\n    if (msdocument && String(msdocument.class()) === 'MSDocumentData') {\n      // we only have an MSDocumentData instead of a MSDocument\n      // let's try to get back to the MSDocument\n      msdocument = msdocument.delegate()\n    }\n    utils.parentWindow = msdocument.windowForSheet()\n  }\n\n  var windowDelegate = WindowDelegateClass.new({\n    utils: utils,\n    panel: panel,\n  })\n\n  panel.setDelegate(windowDelegate)\n}\n","var EventEmitter = require('events')\nvar executeJavaScript = require('./execute-javascript')\n\n// let's try to match https://github.com/electron/electron/blob/master/docs/api/web-contents.md\nmodule.exports = function buildAPI(browserWindow, panel, webview) {\n  var webContents = new EventEmitter()\n\n  webContents.loadURL = browserWindow.loadURL\n\n  webContents.loadFile = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.downloadURL = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.getURL = function() {\n    return String(webview.url())\n  }\n\n  webContents.getTitle = function() {\n    return String(webview.title())\n  }\n\n  webContents.isDestroyed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.focus = browserWindow.focus\n  webContents.isFocused = browserWindow.isFocused\n\n  webContents.isLoading = function() {\n    return !!webview.loading()\n  }\n\n  webContents.isLoadingMainFrame = function() {\n    // TODO:\n    return !!webview.loading()\n  }\n\n  webContents.isWaitingForResponse = function() {\n    return !webview.loading()\n  }\n\n  webContents.stop = function() {\n    webview.stopLoading()\n  }\n  webContents.reload = function() {\n    webview.reload()\n  }\n  webContents.reloadIgnoringCache = function() {\n    webview.reloadFromOrigin()\n  }\n  webContents.canGoBack = function() {\n    return !!webview.canGoBack()\n  }\n  webContents.canGoForward = function() {\n    return !!webview.canGoForward()\n  }\n  webContents.canGoToOffset = function(offset) {\n    return !!webview.backForwardList().itemAtIndex(offset)\n  }\n  webContents.clearHistory = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.goBack = function() {\n    webview.goBack()\n  }\n  webContents.goForward = function() {\n    webview.goForward()\n  }\n  webContents.goToIndex = function(index) {\n    var backForwardList = webview.backForwardList()\n    var backList = backForwardList.backList()\n    var backListLength = backList.count()\n    if (backListLength > index) {\n      webview.loadRequest(NSURLRequest.requestWithURL(backList[index]))\n      return\n    }\n    var forwardList = backForwardList.forwardList()\n    if (forwardList.count() > index - backListLength) {\n      webview.loadRequest(\n        NSURLRequest.requestWithURL(forwardList[index - backListLength])\n      )\n      return\n    }\n    throw new Error('Cannot go to index ' + index)\n  }\n  webContents.goToOffset = function(offset) {\n    if (!webContents.canGoToOffset(offset)) {\n      throw new Error('Cannot go to offset ' + offset)\n    }\n    webview.loadRequest(\n      NSURLRequest.requestWithURL(webview.backForwardList().itemAtIndex(offset))\n    )\n  }\n  webContents.isCrashed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setUserAgent = function(/* userAgent */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.getUserAgent = function() {\n    const userAgent = webview.customUserAgent()\n    return userAgent ? String(userAgent) : undefined\n  }\n  webContents.insertCSS = function(css) {\n    var source =\n      \"var style = document.createElement('style'); style.innerHTML = \" +\n      css.replace(/\"/, '\\\\\"') +\n      '; document.head.appendChild(style);'\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.insertJS = function(source) {\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.executeJavaScript = executeJavaScript(webview, browserWindow)\n  webContents.setIgnoreMenuShortcuts = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setAudioMuted = function(/* muted */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.isAudioMuted = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setZoomFactor = function(factor) {\n    webview.setMagnification_centeredAtPoint(factor, CGPointMake(0, 0))\n  }\n  webContents.getZoomFactor = function(callback) {\n    callback(Number(webview.magnification()))\n  }\n  webContents.setZoomLevel = function(level) {\n    // eslint-disable-next-line no-restricted-properties\n    webContents.setZoomFactor(Math.pow(1.2, level))\n  }\n  webContents.getZoomLevel = function(callback) {\n    // eslint-disable-next-line no-restricted-properties\n    callback(Math.log(Number(webview.magnification())) / Math.log(1.2))\n  }\n  webContents.setVisualZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setLayoutZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  // TODO:\n  // webContents.undo = function() {\n  //   webview.undoManager().undo()\n  // }\n  // webContents.redo = function() {\n  //   webview.undoManager().redo()\n  // }\n  // webContents.cut = webview.cut\n  // webContents.copy = webview.copy\n  // webContents.paste = webview.paste\n  // webContents.pasteAndMatchStyle = webview.pasteAsRichText\n  // webContents.delete = webview.delete\n  // webContents.replace = webview.replaceSelectionWithText\n\n  webContents.send = function() {\n    const script =\n      'window.postMessage({' +\n      'isSketchMessage: true,' +\n      \"origin: '\" +\n      String(__command.identifier()) +\n      \"',\" +\n      'args: ' +\n      JSON.stringify([].slice.call(arguments)) +\n      '}, \"*\")'\n    webview.evaluateJavaScript_completionHandler(script, null)\n  }\n\n  webContents.getNativeWebview = function() {\n    return webview\n  }\n\n  browserWindow.webContents = webContents\n}\n","/* globals NSThread */\nvar threadDictionary = NSThread.mainThread().threadDictionary()\n\nmodule.exports.getWebview = function(identifier) {\n  return require('./lib').fromId(identifier) // eslint-disable-line\n}\n\nmodule.exports.isWebviewPresent = function isWebviewPresent(identifier) {\n  return !!threadDictionary[identifier]\n}\n\nmodule.exports.sendToWebview = function sendToWebview(identifier, evalString) {\n  if (!module.exports.isWebviewPresent(identifier)) {\n    return\n  }\n\n  var panel = threadDictionary[identifier]\n  var webview = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webview &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webview = subviews[i]\n    }\n  }\n\n  if (!webview || !webview.evaluateJavaScript_completionHandler) {\n    throw new Error('Webview ' + identifier + ' not found')\n  }\n\n  webview.evaluateJavaScript_completionHandler(evalString, null)\n}\n","export const getSystemFontsLocation = () => {\n    //@ts-ignore\n    const systemLibrary = NSFileManager.defaultManager().URLsForDirectory_inDomains(NSLibraryDirectory, 8)[0];\n    const systemLibraryPath = systemLibrary ? systemLibrary.absoluteString().replace('file://', '') : null;\n    //@ts-ignore\n    const systemFonts = systemLibraryPath ? NSFileManager.defaultManager().fileExistsAtPath(`${systemLibraryPath}Fonts`) : null;\n    if (systemFonts) {\n        return `${systemLibraryPath}Fonts/`;\n    }\n    else {\n        return null;\n    }\n};\nexport const getUserFontsLocation = () => {\n    //@ts-ignore\n    const userLibrary = NSFileManager.defaultManager().URLsForDirectory_inDomains(NSLibraryDirectory, 1)[0];\n    const userLibraryPath = userLibrary ? userLibrary.absoluteString().replace('file://', '') : null;\n    //@ts-ignore\n    const userFonts = userLibraryPath ? NSFileManager.defaultManager().fileExistsAtPath(`${userLibraryPath}Fonts`) : null;\n    if (userFonts) {\n        return `${userLibraryPath}Fonts/`;\n    }\n    else {\n        return null;\n    }\n};\nexport const getSupplementalFontsLocation = () => {\n    //@ts-ignore\n    const systemLibrary = NSFileManager.defaultManager().URLsForDirectory_inDomains(NSLibraryDirectory, 8)[0];\n    const systemLibraryPath = systemLibrary ? systemLibrary.absoluteString().replace('file://', '') : null;\n    //@ts-ignore\n    const systemFonts = systemLibraryPath ? NSFileManager.defaultManager().fileExistsAtPath(`${systemLibraryPath}Fonts/Supplemental`) : null;\n    if (systemFonts) {\n        return `${systemLibraryPath}Fonts/Supplemental/`;\n    }\n    else {\n        return null;\n    }\n};\nexport const getUserFonts = () => {\n    const userFontsLoc = getUserFontsLocation();\n    if (userFontsLoc) {\n        //@ts-ignore\n        const userFonts = NSFileManager.defaultManager().contentsOfDirectoryAtPath_error(userFontsLoc, nil);\n        return Array.from(userFonts, (item) => { return String(item); });\n    }\n    else {\n        return null;\n    }\n};\nexport const getSystemFonts = () => {\n    const systemFontsLoc = getSystemFontsLocation();\n    if (systemFontsLoc) {\n        //@ts-ignore\n        const systemFonts = NSFileManager.defaultManager().contentsOfDirectoryAtPath_error(systemFontsLoc, nil);\n        return Array.from(systemFonts, (item) => { return String(item); });\n    }\n    else {\n        return null;\n    }\n};\nexport const getSupplimentalFonts = () => {\n    const supplementalFontsLoc = getSupplementalFontsLocation();\n    if (supplementalFontsLoc) {\n        //@ts-ignore\n        const supplementalFonts = NSFileManager.defaultManager().contentsOfDirectoryAtPath_error(supplementalFontsLoc, nil);\n        return Array.from(supplementalFonts, (item) => { return String(item); });\n    }\n    else {\n        return null;\n    }\n};\nexport const getAllFonts = () => {\n    const userFontsLoc = getUserFontsLocation();\n    const systemFontsLoc = getSystemFontsLocation();\n    const supplementalFontsLoc = getSupplementalFontsLocation();\n    const userFonts = getUserFonts();\n    const systemFonts = getSystemFonts();\n    const supplementalFonts = getSupplimentalFonts();\n    const fontLocations = [userFontsLoc, systemFontsLoc, supplementalFontsLoc];\n    const fontLocationContents = [userFonts, systemFonts, supplementalFonts];\n    const availableFontLocations = fontLocations.filter((fontDir) => fontDir !== null);\n    if (availableFontLocations.length > 0) {\n        const allFonts = availableFontLocations.map((fontLocation, index) => {\n            return {\n                location: fontLocation,\n                contents: fontLocationContents[index]\n            };\n        });\n        return allFonts;\n    }\n    else {\n        return null;\n    }\n};\nexport const getRoot = (context) => {\n    return context.scriptPath.stringByDeletingLastPathComponent().stringByDeletingLastPathComponent().stringByDeletingLastPathComponent();\n};\nexport const getFileContent = (filePath) => {\n    //@ts-ignore\n    return NSString.stringWithContentsOfFile_encoding_error(filePath, 4, nil);\n};\nexport const getSavePath = (context) => {\n    let filePath = context.document.fileURL() ? context.document.fileURL().path().stringByDeletingLastPathComponent() : \"~\";\n    let fileName = context.document.displayName().stringByDeletingPathExtension();\n    //@ts-ignore\n    let savePanel = NSSavePanel.savePanel();\n    savePanel.setTitle(\"Export spec\");\n    savePanel.setNameFieldLabel(\"Export to:\");\n    savePanel.setPrompt(\"Export\");\n    savePanel.setCanCreateDirectories(true);\n    savePanel.setNameFieldStringValue(fileName);\n    //@ts-ignore\n    if (savePanel.runModal() != NSOKButton) {\n        return false;\n    }\n    return savePanel.URL().path();\n};\n//@ts-ignore\nexport const writeFile = (options) => {\n    //@ts-ignore\n    let content = NSString.stringWithString(options.content);\n    let savePathName = [];\n    //@ts-ignore\n    NSFileManager.defaultManager().createDirectoryAtPath_withIntermediateDirectories_attributes_error(options.path, true, nil, nil);\n    savePathName.push(options.path, \"/\", options.fileName);\n    savePathName = savePathName.join(\"\");\n    content.writeToFile_atomically_encoding_error(savePathName, false, 4, null);\n};\n//@ts-ignore\nexport const moveImages = (images, savePath) => {\n    const imagesPath = `${savePath}/images`;\n    //@ts-ignore\n    NSFileManager.defaultManager().createDirectoryAtPath_attributes(imagesPath, nil);\n    images.forEach((image) => {\n        //@ts-ignore\n        NSFileManager.defaultManager().moveItemAtPath_toPath_error(image.src[`1x`], `${imagesPath}/${image.id}.png`, nil);\n        //@ts-ignore\n        NSFileManager.defaultManager().moveItemAtPath_toPath_error(image.src[`2x`], `${imagesPath}/${image.id}@2x.png`, nil);\n    });\n};\n//@ts-ignore\nexport const moveSVGs = (svgs, savePath) => {\n    const svgsPath = `${savePath}/svgs`;\n    //@ts-ignore\n    NSFileManager.defaultManager().createDirectoryAtPath_attributes(svgsPath, nil);\n    svgs.forEach((svg) => {\n        //@ts-ignore\n        NSFileManager.defaultManager().moveItemAtPath_toPath_error(svg.src, `${svgsPath}/${svg.id}.svg`, nil);\n    });\n};\nconst getFontNameVariations = (font) => {\n    const noSpace = font.replace(/\\s/g, '');\n    const hyphenCase = font.replace(/\\s/g, '-');\n    return [\n        font,\n        noSpace,\n        hyphenCase\n    ];\n};\nconst containsFontNameVariation = (fontFileName, fontNameVariations) => {\n    let contains = false;\n    const normalizedFileName = fontFileName.toUpperCase();\n    fontNameVariations.forEach((variation) => {\n        const normalizedNameVariant = variation.toUpperCase();\n        if (normalizedFileName.indexOf(normalizedNameVariant) !== -1) {\n            contains = true;\n        }\n    });\n    return contains;\n};\nexport const copyFonts = (fonts, savePath) => {\n    // get user, system, and supplemental fonts\n    const allFonts = getAllFonts();\n    // set font save location\n    const fontsSavePath = `${savePath}/fonts`;\n    // if some font directories exist, move forward\n    if (allFonts) {\n        // create base font directory in spec folder\n        //@ts-ignore\n        NSFileManager.defaultManager().createDirectoryAtPath_attributes(fontsSavePath, nil);\n        // loop through app fonts\n        fonts.forEach((font) => {\n            // loop through font directories\n            allFonts.forEach((fontDir) => {\n                // if directory exists, move forward\n                const fontNameVariations = getFontNameVariations(font);\n                const fontFiles = fontDir.contents.filter((fontFileName) => {\n                    return containsFontNameVariation(fontFileName, fontNameVariations);\n                });\n                if (fontFiles.length > 0) {\n                    //@ts-ignore\n                    NSFileManager.defaultManager().createDirectoryAtPath_attributes(`${fontsSavePath}/${font}`, nil);\n                    fontFiles.forEach((fontFile) => {\n                        //@ts-ignore\n                        NSFileManager.defaultManager().copyItemAtPath_toPath_error(`${fontDir.location}/${fontFile}`, `${fontsSavePath}/${font}/${fontFile}`, nil);\n                    });\n                }\n            });\n        });\n    }\n};\nexport const getFinalStore = (store) => {\n    // copy store, and set final store\n    let finalStore = Object.assign({}, store);\n    // update final store image paths\n    finalStore.images = store.images.map((image) => {\n        return {\n            id: image.id,\n            src: {\n                [`1x`]: `images/${image.id}.png`,\n                [`2x`]: `images/${image.id}@2x.png`\n            }\n        };\n    });\n    // update final store svg paths\n    finalStore.svgs = store.svgs.map((svg) => {\n        return {\n            id: svg.id,\n            src: `svgs/${svg.id}.svg`\n        };\n    });\n    // return strigified final store\n    return JSON.stringify(finalStore);\n};\n","import chroma from 'chroma-js';\nconst checkIfRelevant = (layer, callback) => {\n    switch (layer.type) {\n        case 'Group':\n        case 'Shape':\n        case 'Image':\n        case 'ShapePath':\n        case 'Text':\n        case 'SymbolInstance':\n            callback(layer);\n            break;\n        case 'HotSpot':\n        case 'Slice':\n        case 'Artboard':\n            layer.remove();\n            callback(null);\n            break;\n    }\n};\nconst checkIfHidden = (layer, callback) => {\n    const isHidden = layer.hidden;\n    if (layer && isHidden) {\n        layer.remove();\n        callback(null);\n    }\n    else {\n        callback(layer);\n    }\n};\nconst checkIfSymbol = (layer, callback) => {\n    if (layer && layer.type === 'SymbolInstance') {\n        callback(layer.detach({\n            recursively: true\n        }));\n    }\n    else {\n        callback(layer);\n    }\n};\nconst createMaskLayer = (layer, sketch) => {\n    // duplicate layer and reset styles\n    // layer needs a fill and 100% opacity,\n    // to correctly mimic sketch masking\n    let duplicate = layer.duplicate();\n    // check if layer has active fill\n    const activeFills = duplicate.style.fills.filter((fill) => fill.enabled);\n    const topFill = activeFills ? activeFills[activeFills.length - 1] : null;\n    // if layer has active fill,\n    // return fill at 100% alpha\n    if (topFill) {\n        topFill.color = `${chroma(topFill.color).alpha(1)}`;\n    }\n    else {\n        // if layer has no active fill,\n        // add black fill\n        duplicate.style.fills = [{\n                color: '#000',\n                fillType: 'Color'\n            }];\n    }\n    // reset position and styles\n    duplicate.frame.x = 0;\n    duplicate.frame.y = 0;\n    duplicate.style.borders = [];\n    duplicate.style.shadows = [];\n    duplicate.style.innerShadows = [];\n    duplicate.style.opacity = 1;\n    // flatten shape\n    let shapeBuffer = sketch.export(duplicate, {\n        formats: 'svg',\n        output: false\n    });\n    let shapeGroup = sketch.createLayerFromData(shapeBuffer, 'svg');\n    // get shape in flattened shape group\n    let maskShape = shapeGroup.layers[0];\n    // rename layer\n    maskShape.name = `srm.mask.shape`;\n    // remove duplicate\n    duplicate.remove();\n    // return final mask\n    return maskShape;\n};\nconst getMaskShape = (layer) => {\n    let lastLayer = layer;\n    while (lastLayer.type === 'Group') {\n        lastLayer = lastLayer.layers[0];\n    }\n    return lastLayer;\n};\nconst checkIfMask = (layer, sketch, callback) => {\n    if (layer && layer.sketchObject.hasClippingMask()) {\n        const maskIndex = layer.index;\n        const maskParent = layer.parent;\n        const maskShape = getMaskShape(layer);\n        const flatMaskShape = createMaskLayer(maskShape, sketch);\n        // add offset to group if flat mask shape if slimmer than mask shape\n        const maskGroupOffset = flatMaskShape.frame.width !== maskShape.frame.width\n            ? (maskShape.frame.width - flatMaskShape.frame.width) / 2\n            : maskShape.frame.x;\n        // create new group to mimic mask behavior\n        const maskGroup = new sketch.Group({\n            name: 'srm.mask',\n            frame: Object.assign(Object.assign({}, flatMaskShape.frame), { x: maskGroupOffset }),\n            layers: [flatMaskShape]\n        });\n        // splice in mask group, splice out old mask\n        maskParent.layers.splice(maskIndex, 1, maskGroup);\n        // if mask is a group, push group layers to mask group\n        if (layer.type === 'Group') {\n            layer.layers.forEach((maskedLayer) => {\n                maskGroup.layers.push(maskedLayer);\n            });\n        }\n        // loop through mask parent layers,\n        // any layer with an index higher than the mask will be masked\n        // push masked layers to maskGroup\n        maskGroup.parent.layers.forEach((maskedLayer, index) => {\n            if (index > maskIndex) {\n                maskedLayer.frame.x = maskedLayer.frame.x - maskGroup.frame.x;\n                maskedLayer.frame.y = maskedLayer.frame.y - maskGroup.frame.y;\n                maskGroup.layers.push(maskedLayer);\n            }\n        });\n        callback(layer);\n    }\n    else {\n        callback(layer);\n    }\n};\nconst roundFrameDimensions = (layer, callback) => {\n    if (layer) {\n        layer.frame.x = Math.round(layer.frame.x);\n        layer.frame.y = Math.round(layer.frame.y);\n        layer.frame.width = Math.round(layer.frame.width);\n        layer.frame.height = Math.round(layer.frame.height);\n    }\n    callback(layer);\n};\nconst processLayer = (layer, sketch, callback) => {\n    checkIfRelevant(layer, (rLayer) => {\n        checkIfHidden(rLayer, (hLayer) => {\n            checkIfSymbol(hLayer, (sLayer) => {\n                checkIfMask(sLayer, sketch, (mLayer) => {\n                    roundFrameDimensions(mLayer, (fLayer) => {\n                        callback(fLayer);\n                    });\n                });\n            });\n        });\n    });\n};\nconst processLayers = (layers, sketch) => {\n    if (layers.length > 0) {\n        layers.forEach((layer) => {\n            processLayer(layer, sketch, (layer) => {\n                if (layer && layer.type === 'Group') {\n                    processLayers(layer.layers, sketch);\n                }\n            });\n        });\n    }\n};\nconst getArtboard = (selectedArtboard, sketch) => {\n    // duplicate artboard\n    const artboard = selectedArtboard.duplicate();\n    // reset duplicated artboard position\n    artboard.frame.x = 0;\n    artboard.frame.y = 0;\n    artboard.background.includedInExport = true;\n    // process artboard layers\n    processLayers(artboard.layers, sketch);\n    // return final artboard\n    return artboard;\n};\nexport default getArtboard;\n","const createSvgFromLayer = (page, layer, sketch, id) => {\n    let borderSize = 0;\n    const activeBorders = layer.style.borders.filter((border) => border.enabled);\n    if (activeBorders) {\n        activeBorders.forEach((border) => {\n            if (border.thickness > borderSize) {\n                borderSize = border.thickness;\n            }\n        });\n    }\n    // duplicate layer\n    const layerDuplicate = layer.duplicate();\n    // set parent to page\n    layerDuplicate.parent = page;\n    // opacity and transforms will be applied on the div, not svg\n    layerDuplicate.style.opacity = 1;\n    layerDuplicate.transform.rotation = 0;\n    layerDuplicate.transform.flippedHorizontally = false;\n    layerDuplicate.transform.flippedVertically = false;\n    // export duplicate layer\n    sketch.export(layerDuplicate, {\n        formats: 'svg',\n        // @ts-ignore\n        output: NSTemporaryDirectory(),\n        ['use-id-for-name']: true,\n        overwriting: true\n    });\n    // update layer frame to include bordersize\n    layer.frame.width = Math.round(layer.frame.width + (borderSize * 1.5));\n    layer.frame.height = Math.round(layer.frame.height + (borderSize * 1.5));\n    layer.frame.x = Math.round(layer.frame.x - ((borderSize * 1.5) / 2));\n    layer.frame.y = Math.round(layer.frame.y - ((borderSize * 1.5) / 2));\n    // remove duplicate layer\n    layerDuplicate.remove();\n    // return AppAsset\n    return {\n        id: id ? id : layer.id,\n        // @ts-ignore\n        src: `${NSTemporaryDirectory()}${layerDuplicate.id}.svg`\n    };\n};\nconst createShapeFromLayer = (layer, sketch, name) => {\n    // create new shape\n    const shapeReplacement = new sketch.Shape({\n        name: name ? name : layer.name,\n        frame: layer.frame,\n        style: layer.style,\n        transform: {\n            rotation: layer.transform.rotation,\n            flippedHorizontally: layer.transform.flippedHorizontally,\n            flippedVertically: layer.transform.flippedVertically\n        }\n    });\n    // return new shape\n    return shapeReplacement;\n};\nconst createShapeFromGroup = (layer, sketch, prefix) => {\n    // remove prefix from name\n    const newName = layer.name.substr(prefix.length, layer.name.length - prefix.length).trim();\n    // create new shape\n    const shapeReplacement = createShapeFromLayer(layer, sketch, newName);\n    // return new shape\n    return shapeReplacement;\n};\nconst createImageLayerImage = (page, layer, sketch) => {\n    const layerDuplicate = layer.duplicate();\n    // reset asset position on artboard\n    layerDuplicate.parent = page;\n    // export asset to temp folder\n    sketch.export(layerDuplicate, {\n        scales: '1, 2',\n        formats: 'png',\n        // @ts-ignore\n        output: NSTemporaryDirectory(),\n        ['use-id-for-name']: true,\n        ['save-for-web']: true,\n        overwriting: true\n    });\n    // remove asset artboard from page\n    layerDuplicate.remove();\n    // return AppAsset\n    return {\n        id: layer.image.id,\n        src: {\n            // @ts-ignore\n            [`1x`]: `${NSTemporaryDirectory()}${layerDuplicate.id}.png`,\n            // @ts-ignore\n            [`2x`]: `${NSTemporaryDirectory()}${layerDuplicate.id}@2x.png`\n        },\n    };\n};\nconst createGradientFillImage = (page, layer, sketch) => {\n    // get enabled gradients\n    const activeGradients = layer.style.fills.filter((fill) => {\n        return fill.enabled && fill.fillType === 'Gradient';\n    });\n    // get top gradient fill\n    const topGradient = activeGradients[activeGradients.length - 1];\n    // create new layer with gradient\n    const gradientImage = new sketch.ShapePath({\n        parent: page,\n        frame: layer.frame,\n        style: {\n            fills: [topGradient],\n            borders: []\n        }\n    });\n    // export image to temp dir\n    sketch.export(gradientImage, {\n        scales: '1, 2',\n        formats: 'png',\n        // @ts-ignore\n        output: NSTemporaryDirectory(),\n        ['use-id-for-name']: true,\n        ['save-for-web']: true,\n        overwriting: true\n    });\n    // remove image from page\n    gradientImage.remove();\n    // return final image\n    return {\n        id: layer.id,\n        src: {\n            // @ts-ignore\n            [`1x`]: `${NSTemporaryDirectory()}${gradientImage.id}.png`,\n            // @ts-ignore\n            [`2x`]: `${NSTemporaryDirectory()}${gradientImage.id}@2x.png`,\n        }\n    };\n};\nconst createImageFillImage = (page, image, sketch) => {\n    // get image size\n    const width = image.nsimage.size().width;\n    const height = image.nsimage.size().height;\n    // create image from fill image\n    const fillImage = new sketch.Image({\n        image: image,\n        parent: page,\n        frame: { width, height, x: 0, y: 0 }\n    });\n    // export image to temp dir\n    sketch.export(fillImage, {\n        scales: '1, 2',\n        formats: 'png',\n        // @ts-ignore\n        output: NSTemporaryDirectory(),\n        ['use-id-for-name']: true,\n        ['save-for-web']: true,\n        overwriting: true\n    });\n    // remove image from page\n    fillImage.remove();\n    // return final image\n    return {\n        id: image.id,\n        src: {\n            // @ts-ignore\n            [`1x`]: `${NSTemporaryDirectory()}${fillImage.id}.png`,\n            // @ts-ignore\n            [`2x`]: `${NSTemporaryDirectory()}${fillImage.id}@2x.png`\n        }\n    };\n};\nconst processLayerFills = (page, layer, images, sketch, fillImages = []) => {\n    layer.style.fills.forEach((fill) => {\n        if (fill.pattern.image !== null && fill.enabled && !images.find(image => image.id === fill.pattern.image.id)) {\n            const fillImage = createImageFillImage(page, fill.pattern.image, sketch);\n            fillImages.push(fillImage);\n        }\n        else if (fill.fillType === 'Gradient' && fill.enabled) {\n            const gradientImage = createGradientFillImage(page, layer, sketch);\n            fillImages.push(gradientImage);\n        }\n    });\n    return fillImages;\n};\nconst isComplexShapePath = (layer) => {\n    const hasOpenPath = !layer.closed;\n    const notRectangle = layer.shapeType !== 'Rectangle';\n    const notOval = layer.shapeType !== 'Oval';\n    const isOddShape = notRectangle && notOval;\n    const hasDashPattern = layer.style.borderOptions.dashPattern.length > 0;\n    return hasOpenPath || isOddShape || hasDashPattern;\n};\nconst processShapePath = (page, layer, images, sketch, callback) => {\n    const isComplex = isComplexShapePath(layer);\n    const shapePathFillImages = processLayerFills(page, layer, images, sketch);\n    if (isComplex) {\n        // turn complex shapePaths into shapes\n        // makes things easier when divs are styled later\n        const shapeReplacement = createShapeFromLayer(layer, sketch);\n        const svg = createSvgFromLayer(page, layer, sketch, shapeReplacement.id);\n        layer.parent.layers.splice(layer.index, 1, shapeReplacement);\n        callback(shapePathFillImages, svg);\n    }\n    else {\n        callback(shapePathFillImages, null);\n    }\n};\nconst processShape = (page, layer, images, sketch, callback) => {\n    const shapeFillImages = processLayerFills(page, layer, images, sketch);\n    const svg = createSvgFromLayer(page, layer, sketch);\n    callback(shapeFillImages, svg);\n};\nconst processImage = (page, layer, images, sketch, callback) => {\n    if (!images.find(image => image.id === layer.image.id)) {\n        const image = createImageLayerImage(page, layer, sketch);\n        callback(image);\n    }\n    else {\n        callback(null);\n    }\n};\nconst processGroup = (page, layer, sketch, callback) => {\n    if (layer.name.startsWith('[srm.svg]')) {\n        // create shape to replace group\n        const shapeReplacement = createShapeFromGroup(layer, sketch, '[srm.svg]');\n        // create svg from group\n        const svg = createSvgFromLayer(page, layer, sketch, shapeReplacement.id);\n        // splice in shape replacement, splice out old group\n        layer.parent.layers.splice(layer.index, 1, shapeReplacement);\n        // return callback\n        callback(svg);\n    }\n    else {\n        callback(null);\n    }\n};\nconst processText = (layer, fonts, callback) => {\n    const fontFamily = layer.style.fontFamily;\n    //@ts-ignore\n    const availableFamilies = NSFontManager.sharedFontManager().availableFontFamilies();\n    const availableFamiliesArray = Array.from(availableFamilies, item => String(item));\n    const fontAvailable = availableFamiliesArray.includes(fontFamily);\n    if (fonts && fontAvailable && !fonts.includes(fontFamily)) {\n        callback(fontFamily);\n    }\n    else {\n        callback(null);\n    }\n};\nconst processLayer = (page, layer, sketch, images, svgs, fonts, callback) => {\n    switch (layer.type) {\n        case 'Image':\n            processImage(page, layer, images, sketch, (image) => {\n                if (image) {\n                    images.push(image);\n                }\n            });\n            break;\n        case 'Shape':\n            processShape(page, layer, images, sketch, (shapeImages, shapeSvg) => {\n                images.push(...shapeImages);\n                svgs.push(shapeSvg);\n            });\n            break;\n        case 'ShapePath':\n            processShapePath(page, layer, images, sketch, (shapePathImages, shapePathSvg) => {\n                if (shapePathSvg) {\n                    svgs.push(shapePathSvg);\n                }\n                images.push(...shapePathImages);\n            });\n            break;\n        case 'Text':\n            processText(layer, fonts, (font) => {\n                if (font) {\n                    fonts.push(font);\n                }\n            });\n            break;\n        case 'Group':\n            processGroup(page, layer, sketch, (groupSvg) => {\n                if (groupSvg) {\n                    svgs.push(groupSvg);\n                }\n            });\n            break;\n    }\n    callback({\n        images,\n        svgs,\n        fonts\n    });\n};\nconst processLayers = (page, layers, sketch, images = [], svgs = [], fonts = []) => {\n    if (layers.length > 0) {\n        layers.forEach((layer) => {\n            processLayer(page, layer, sketch, images, svgs, fonts, (newAssets) => {\n                images = newAssets.images;\n                svgs = newAssets.svgs;\n                fonts = newAssets.fonts;\n            });\n            if (layer.type === 'Group') {\n                processLayers(page, layer.layers, sketch, images, svgs, fonts);\n            }\n        });\n    }\n    return {\n        images,\n        svgs,\n        fonts\n    };\n};\nexport const createArtboardImage = (artboard, sketch) => {\n    const buffer = sketch.export(artboard, {\n        scales: '0.10',\n        formats: 'png',\n        output: false,\n        ['save-for-web']: true\n    });\n    // create image from buffer data\n    const bufferImg = new sketch.Image({\n        image: buffer\n    });\n    const base64 = bufferImg.image.nsdata.base64EncodedStringWithOptions(0);\n    return `data:image/png;base64, ${base64}`;\n};\nexport const getAssets = (page, artboard, sketch) => {\n    const artboardAssets = processLayers(page, artboard.layers, sketch);\n    const artboardImage = createArtboardImage(artboard, sketch);\n    return Object.assign(Object.assign({}, artboardAssets), { artboardImage });\n};\nexport default getAssets;\n","import getArtboard from './artboard';\nimport getAssets from './assets';\nconst getStore = (page, selectedArtboard, sketch, callback) => {\n    // get final store items\n    const artboard = getArtboard(selectedArtboard, sketch);\n    const assets = getAssets(page, artboard, sketch);\n    const notes = [];\n    // remove duplicate artboard\n    artboard.remove();\n    // return callback\n    callback(Object.assign(Object.assign({}, assets), { artboard,\n        notes }));\n};\nexport default getStore;\n","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/61788c2fbcc7fdc32186c826617effa2.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/c51dab97c1511095e6fdf42b42923bf2.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/30cc05feaf2b8eb274da7b6fd6b2552e.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/925ae79a722a023b4075f164dd3b2396.css\";","// @ts-ignore\nimport sketch from 'sketch/dom';\n// @ts-ignore\nimport ui from 'sketch/ui';\n// @ts-ignore\nimport BrowserWindow from 'sketch-module-web-view';\n// @ts-ignore\nimport { getWebview } from 'sketch-module-web-view/remote';\nimport getStore from '../resources/store';\nimport * as pluginExport from '../resources/export';\nconst appWindowIdentifier = 'srm.appWindow';\nconst loadingWindowIdentifier = 'srm.loadingWindow';\nexport default (context) => {\n    // close any existing windows\n    const existingAppWindow = getWebview(appWindowIdentifier);\n    const existingLoadingWindow = getWebview(loadingWindowIdentifier);\n    if (existingAppWindow) {\n        existingAppWindow.close();\n    }\n    else if (existingLoadingWindow) {\n        existingLoadingWindow.close();\n    }\n    // get sketch document\n    const document = sketch.getSelectedDocument();\n    // get sketch selected page\n    const page = document.selectedPage;\n    // get sketch selected layers\n    const selectedLayers = document.selectedLayers;\n    // get sketch selected artboard\n    //@ts-ignore\n    const selectedArtboard = selectedLayers.layers.find((layer) => {\n        return layer.type === 'Artboard' && layer.selected;\n    });\n    // if artboard selected, run command\n    if (selectedArtboard) {\n        // set base store\n        let store = null;\n        // set theme\n        const theme = ui.getTheme();\n        // set loading modal window\n        const loadingWindow = new BrowserWindow({\n            identifier: loadingWindowIdentifier,\n            parent: document,\n            modal: true,\n            show: false\n        });\n        // set app window\n        const appWindow = new BrowserWindow({\n            identifier: appWindowIdentifier,\n            width: 1200,\n            height: 900,\n            fullscreenable: false,\n            show: false\n        });\n        // load loading.html in loading modal\n        loadingWindow.loadURL(require(`../resources/ui/loading.html`));\n        // set loading window contents\n        const loadingWebContents = loadingWindow.webContents;\n        // display loading modal when loaded\n        loadingWebContents.on('did-finish-load', () => {\n            // set loading text based on theme\n            loadingWebContents.executeJavaScript(`setLoadingColor('${theme}')`).then(() => {\n                // show loading window after text is styled\n                loadingWindow.show();\n                // load app index\n                appWindow.loadURL(require('../resources/ui/index.html'));\n            });\n        });\n        // make loading window closable\n        loadingWebContents.on('escape', () => {\n            if (!appWebContents.isLoading()) {\n                loadingWindow.close();\n            }\n        });\n        // set app window contents\n        const appWebContents = appWindow.webContents;\n        // wait till app index finished loading\n        appWebContents.on('did-finish-load', () => {\n            // get store when index loads\n            getStore(page, selectedArtboard, sketch, (appStore) => {\n                // update loading text then render app\n                loadingWebContents.executeJavaScript(`setLoadingText('Rendering', 'Building spec')`).then(() => {\n                    // set plugin store\n                    store = appStore;\n                    // render react app\n                    appWebContents.executeJavaScript(`renderApp(\n            ${JSON.stringify(appStore)},\n            ${JSON.stringify(theme)}\n          )`).then(() => {\n                        // after react app renders,\n                        // close loading window and show app window\n                        loadingWindow.close();\n                        // maximize and center app window before showing\n                        appWindow.maximize();\n                        appWindow.center();\n                        appWindow.show();\n                    });\n                });\n            });\n        });\n        // if app failed to load,\n        // close windows and display alert\n        appWebContents.on('did-fail-load', () => {\n            loadingWindow.close();\n            appWindow.close();\n            ui.alert('Error', 'Spec failed to load.');\n        });\n        // open save prompt on save\n        appWebContents.on('save', (params) => {\n            // set save store\n            let saveStore = store;\n            // parse save params\n            let saveParams = JSON.parse(params);\n            // add notes to store\n            saveStore.notes = saveParams.notes;\n            // get final store\n            let finalStore = pluginExport.getFinalStore(saveStore);\n            // get save path\n            let savePath = pluginExport.getSavePath(context);\n            // get plugin root\n            let pluginRoot = pluginExport.getRoot(context);\n            // get js path\n            let scriptPath = `${pluginRoot}/Contents/Resources/resources_ui_spec.js`;\n            // get js map path\n            let scriptSourceMapPath = `${pluginRoot}/Contents/Resources/resources_ui_spec.js.map`;\n            // get css path\n            let stylesPath = require('../resources/ui/style.css').replace('file://', '');\n            // get html spec path\n            let templatePath = require('../resources/ui/spec.html').replace('file://', '');\n            // get css file name\n            // 32 + . + extension\n            let styleName = stylesPath.substr(-36);\n            // get contents of html\n            let template = pluginExport.getFileContent(templatePath);\n            // get contents of css\n            let styles = pluginExport.getFileContent(stylesPath);\n            // get contents of js\n            let script = pluginExport.getFileContent(scriptPath);\n            // add store and theme to js string\n            let scriptWithGlobals = `var SRM_APP_THEME = '${saveParams.theme}'; var SRM_APP_STORE = ${finalStore}; ${script}`;\n            // get contents of js map\n            let scriptSourceMap = pluginExport.getFileContent(scriptSourceMapPath);\n            // create final html\n            pluginExport.writeFile({\n                content: template,\n                path: savePath,\n                fileName: 'spec.html'\n            });\n            // create final css\n            pluginExport.writeFile({\n                content: styles,\n                path: savePath,\n                fileName: styleName\n            });\n            // create final js\n            pluginExport.writeFile({\n                content: scriptWithGlobals,\n                path: savePath,\n                fileName: 'resources_ui_spec.js'\n            });\n            // create final js map\n            pluginExport.writeFile({\n                content: scriptSourceMap,\n                path: savePath,\n                fileName: 'resources_ui_spec.js.map'\n            });\n            // move images from temp folder to spec\n            if (saveStore.images.length > 0) {\n                pluginExport.moveImages(saveStore.images, savePath);\n            }\n            // move svgs from temp folder to spec\n            if (saveStore.svgs.length > 0) {\n                pluginExport.moveSVGs(saveStore.svgs, savePath);\n            }\n            // copy fonts used in spec\n            if (saveStore.fonts.length > 0) {\n                pluginExport.copyFonts(saveStore.fonts, savePath);\n            }\n        });\n    }\n    else {\n        // if artboard not selected, alert user\n        ui.alert('Invalid Selection', 'Select an artboard to export.');\n    }\n};\nexport const onShutdown = () => {\n    const existingAppWindow = getWebview(appWindowIdentifier);\n    const existingLoadingWindow = getWebview(loadingWindowIdentifier);\n    if (existingAppWindow) {\n        existingAppWindow.close();\n    }\n    else if (existingLoadingWindow) {\n        existingLoadingWindow.close();\n    }\n};\n","module.exports = require(\"events\");","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}